<!DOCTYPE html>
<html>
  <head><meta charset="utf-8" />
<meta name="google-site-verification" content="yMFFIOIN7PiAoCbBJmLSutrBWZCfjqM7intNsFjKXew" />
<meta name="robots" content="index,follow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="Gautam Manohar" />
<meta name="copyright" content="Gautam Manohar" />
<meta name="date" content="0001-01-01" />
<meta name="description" content="">
<meta name="keywords" content="emacs, { .Section }}" />
<title>My Emacs Configuration &ndash; Gautam Manohar</title><meta name="msapplication-TileImage"           content="/img/favicons/mstile-144x144.png" />
<meta name="msapplication-config"              content="/img/favicons/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#da532c" />
<meta name="theme-color"             content="#ffffff" />
<link rel="apple-touch-icon"      sizes="180x180" href="/img/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32"   href="/img/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="192x192" href="/img/favicons/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="16x16"   href="/img/favicons/favicon-16x16.png" />
<link rel="manifest"                              href="/img/favicons/manifest.json" />
<link rel="mask-icon"  color="#5bbad5"            href="/img/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon"                         href="/img/favicons/favicon.ico" />

    <link type="text/css" rel="stylesheet" href="https://gautammanohar.com/sass/main.min.2d30e244b49f31a7130938cad7a95c48610b15fae5bbacdcdbd0b7f1c0302080.css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700" rel="stylesheet"><style>
.title .math {
  font-size: 50% !important;
}
</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115904815-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115904815-1');
</script>
</head>
  <body>
    <div class="nav-wrapper">
      <nav id="blog-top" class="fixed">
        <ul>
          <li><a href="https://gautammanohar.com/./">about</a></li>
          <li><a href="https://gautammanohar.com/blog">blog</a></li>
          <li><a href="https://gautammanohar.com/euler">project euler</a></li>
        </ul>
      </nav>
    </div>
<div class="main">
  <article class="article "><header>
  <h1 class="title">
    <a href="https://gautammanohar.com/gmacs/" rel="bookmark" title="Link to My Emacs Configuration">My Emacs Configuration</a>
  </h1>

  <div class="mobile">
    <div class="date">1 January 0001</div>
    <div class="category">

      <a href="https://gautammanohar.com/categories/emacs/" title="Posts under category emacs">emacs</a>&nbsp;

      </div>
   </div>
</header>


<h2 id="starting-up"><span class="section-num">1</span> Starting Up</h2>

<h3 id="early-init">Early Init</h3>

<p>Here&rsquo;s some cutting edge technology. Emacs 27+ introduces <code>early-init.el</code>, which
is run before <code>init.el</code>, before package initialization.</p>

<p>Package initialization occurs automatically, before <code>user-init-file</code> is loaded,
but after <code>early-init-file</code>. As we&rsquo;ll see later, we can handle package
initialization ourselves, so there&rsquo;s no need for Emacs to do it first.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">package-enable-at-startup</span> <span class="no">nil</span><span class="p">)</span></code></pre></div>
<h3 id="fixing-the-ui">Fixing the UI</h3>

<p>Emacs ships with a set of pretty strange defaults. The UI is the first thing we
see when we open Emacs, so it better not look ugly. We&rsquo;re going to configure
part of the UI outside Emacs entirely, by editing the <code>~/.Xresources</code>.</p>

<p>This has the advantage of killing the ugly parts of the UI before they are born.
This is slightly faster than doing it within Emacs, but it comes at the cost of
less flexibility. For example, if Emacs fails to start up properly, you are
possibly left staring at a chimera of an editor, with default font colours but
themed background colours&mdash;because the font is about the same shade as the
background, this makes for some very fun times debugging.</p>

<p>After editing <code>.Xresources</code>, remember to reload it with <code>xrdb merge ~/.Xresources</code>.</p>

<h4 id="bars">Bars</h4>

<p>I never use menu bars, tool bars, or scroll bars in Emacs.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Emacs.menuBar: off
Emacs.toolBar: off
Emacs.verticalScrollBars: off</code></pre></div>
<h4 id="cursor-blinking">Cursor Blinking</h4>

<p>In earlier versions of Emacs, the cursor would blink ten or so times, then
suddenly stop. This got annoying quickly.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Emacs.cursorBlink: off</code></pre></div>
<h4 id="background-colour">Background Colour</h4>

<p>Before a theme is initialized, the default background colour that Emacs displays
is white. However, my default theme is a dark theme (Solarized Dark). If I were
to change the background colour after Emacs starts, the screen would flash as it
changes colour. And so I set the default background colour to be that of
Solarized Dark.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Emacs.background: <span class="c1">#002b36</span></code></pre></div>
<p>The last thing left that is visible throughout startup is the modeline. It
took a bit of Internet sleuthing to figure out how to set this, but here it is.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Emacs.mode-line.attributeForeground: <span class="c1">#93a1a1</span>
Emacs.mode-line.attributeBackground: <span class="c1">#002b36</span>
Emacs.mode-line.attributeBox: <span class="o">(</span>:line-width <span class="m">1</span> :color <span class="s2">&#34;#073642&#34;</span><span class="o">)</span></code></pre></div>
<h4 id="default-font">Default Font</h4>

<p>I often experiment with fonts during an Emacs session, so I set up an easy way
to change that <a href="#font-face">here</a>. On startup, though, I want something neutral, so I go with
DejaVu Sans Mono.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">Emacs.font: DejaVu Sans Mono-10</code></pre></div>
<h3 id="lexical-binding">Lexical Binding</h3>

<p>Enable lexical binding.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; -*- lexical-binding: t -*-</span></code></pre></div>
<h3 id="start-server">Start Server</h3>

<p>Always load up a server when opening Emacs.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">server-start</span><span class="p">)</span></code></pre></div>
<h3 id="initialization-settings">Initialization Settings</h3>

<p>I was inspired to implement these optimizations in GMACS thanks to
<a href="https://github.com/nilcons/emacs-use-package-fast">nilcons/emacs-use-package-fast</a>.</p>

<p>To increase startup speed, we&rsquo;re going to set <code>gc-cons-threshold</code> to a very high
number. This is not ideal when actually using Emacs, so we turn this off when we
finish starting up. If we were to leave this on, we would experience long
garbage collection pauses during use.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">eval-and-compile</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">gc-cons-threshold</span> <span class="mi">402653184</span>
        <span class="nv">gc-cons-percentage</span> <span class="mf">0.6</span><span class="p">))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">gc-cons-threshold</span> <span class="mi">16777216</span>
                                                 <span class="nv">gc-cons-percentage</span> <span class="mf">0.1</span><span class="p">)))</span></code></pre></div>
<p>We increase these so that we don&rsquo;t exceed recursion limits unless there is some
kind of infinite loop.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">max-lisp-eval-depth</span> <span class="mi">50000</span>
      <span class="nv">max-specpdl-size</span> <span class="mi">10000</span><span class="p">)</span></code></pre></div>
<p>Now we prevent loading double buffers. This reduces stuttering.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;default-frame-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">inhibit-double-buffering</span> <span class="o">.</span> <span class="no">t</span><span class="p">))</span></code></pre></div>
<p>Silence some common warnings from the byte-compiler.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">byte-compile-warnings</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">not</span> <span class="nv">free-vars</span> <span class="nv">unresolved</span> <span class="nv">noruntime</span> <span class="nv">lexical</span> <span class="nv">make-local</span><span class="p">))</span></code></pre></div>
<p>Let the user know how quickly GMACS started.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-init-hook</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;GMACS ready in %s with %d garbage collections.&#34;</span>
                     <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%.2f seconds&#34;</span>
                             <span class="p">(</span><span class="nf">float-time</span>
                              <span class="p">(</span><span class="nf">time-subtract</span> <span class="nv">after-init-time</span> <span class="nv">before-init-time</span><span class="p">)))</span>
                     <span class="nv">gcs-done</span><span class="p">)))</span></code></pre></div>
<h3 id="directories">Directories</h3>

<p>We define a few custom directories to satisfy my own wishes for how things
should be named and to speed up the package initialization process by doing it
ourselves, rather than relying on <code>package-initialize</code>. Note that the whole thing
is wrapped in a byte-compile block.</p>

<p>We make the directories if they don&rsquo;t exist by iterating over a list. This
method makes it easy for to extend to more directories if needed.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">eval-and-compile</span>
  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">gmacs-emacs-dir</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="nv">user-emacs-directory</span><span class="p">)</span>
    <span class="s">&#34;The path to the emacs.d directory.&#34;</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">gmacs-packages-dir</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-emacs-dir</span> <span class="s">&#34;packages/&#34;</span><span class="p">)</span>
    <span class="s">&#34;Where package.el and elpa plugins (and their caches) are stored.&#34;</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">gmacs-custom-dir</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-emacs-dir</span> <span class="s">&#34;elisp/&#34;</span><span class="p">)</span>
    <span class="s">&#34;Where custom lisp files are stored&#34;</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">defvar</span> <span class="nv">gmacs-cache-dir</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-emacs-dir</span> <span class="s">&#34;cache/&#34;</span><span class="p">)</span>
    <span class="s">&#34;Where temporary files that could be deleted without anything
</span><span class="s">    terrible happening are stored.&#34;</span><span class="p">)</span>

  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">dir</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">gmacs-packages-dir</span>
                     <span class="nv">gmacs-custom-dir</span>
                     <span class="nv">gmacs-cache-dir</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-directory-p</span> <span class="nv">dir</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">make-directory</span> <span class="nv">dir</span> <span class="no">t</span><span class="p">))))</span></code></pre></div>
<h3 id="add-package-sources">Add Package Sources</h3>

<p>We&rsquo;re going to use a custom package directory, so we need to trick Emacs into
thinking it has initialized packages by setting <code>package--init-file-ensured</code> to <code>t</code>.
Also, we don&rsquo;t enable packages at startup, because we will let <code>use-package</code>
intelligently defer and handle package loading.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">eval-and-compile</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">load-prefer-newer</span> <span class="no">t</span>
        <span class="nv">package-user-dir</span> <span class="nv">gmacs-packages-dir</span>
        <span class="nv">package--init-file-ensured</span> <span class="no">t</span>
        <span class="nv">package-enable-at-startup</span> <span class="no">nil</span><span class="p">))</span></code></pre></div>
<p>Get <code>use-package</code> to always defer loading packages until they are actually needed.
This reduces startup time significantly. We&rsquo;re doing this now, before
<code>use-package</code> is even loaded, because otherwise it won&rsquo;t help us when the code
that loads <code>use-package</code> is evaluated upon byte-compilation.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-defer</span> <span class="no">t</span>
      <span class="nv">use-package-verbose</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<p>We set the <code>load-path</code> ourselves. This will be faster than letting
<code>package-intialize</code> handle it, because we only add directories we know are from
packages. This way, we don&rsquo;t need to search all third party paths every time we
require a file. We&rsquo;ll also store custom or third-party Emacs Lisp files in
<code>gmacs-custom-dir</code>, so we add that to the <code>load-path</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">eval-and-compile</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">load-path</span> <span class="p">(</span><span class="nf">append</span> <span class="nv">load-path</span> <span class="p">(</span><span class="nf">directory-files</span> <span class="nv">package-user-dir</span> <span class="no">t</span> <span class="s">&#34;^[^.]&#34;</span> <span class="no">t</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;load-path</span> <span class="nv">gmacs-custom-dir</span><span class="p">))</span></code></pre></div>
<p>Our next step is to load <code>package.el</code>. We add our package repositories &ldquo;melpa&rdquo; and
&ldquo;gnu,&rdquo; because Emacs&rsquo; default list of packages is so conservative. Then we need
to initialize the packages and make sure that <code>use-package</code> is installed if its
missing. Finally, we tell <code>use-package</code> to always install missing packages.
Otherwise, an error would be thrown when a package is missing.</p>

<p>Note that this whole process only run when the file is byte-compiled. This means
that by the time the code is actually evaluated, the <code>use-package</code> macro has been
expanded, so the package is not needed anymore. As such, we can do all the
expensive and time-consuming work of getting the packages ready before Emacs has
even started, during byte-compilation.If this config has not been manually
byte-compiled, Emacs will initialize packages on startup as usual.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">eval-when-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;package</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">package-archives</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;melpa&#34;</span> <span class="o">.</span> <span class="s">&#34;https://melpa.org/packages/&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;gnu&#34;</span> <span class="o">.</span> <span class="s">&#34;https://elpa.gnu.org/packages/&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;org&#34;</span> <span class="o">.</span> <span class="s">&#34;http://orgmode.org/elpa/&#34;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">package-installed-p</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">package-install</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">package-refresh-contents</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;use-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">use-package-always-ensure</span> <span class="no">t</span><span class="p">))</span></code></pre></div>
<p>We also require <code>diminish</code> and <code>bind</code> because I often use these keywords within
<code>use-package</code> declarations.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;bind-key</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;diminish</span><span class="p">)</span></code></pre></div>
<h3 id="other-elisp-files">Other Elisp Files</h3>

<p>I put custom variables outside of my <code>init.el</code> file.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">custom-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;custom.el&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">custom-file</span><span class="p">)</span> <span class="p">(</span><span class="nf">load</span> <span class="nv">custom-file</span><span class="p">))</span></code></pre></div>
<p>I put my personal information in <code>private.el</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">private-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;private.el&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
<span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">private-file</span><span class="p">)</span> <span class="p">(</span><span class="nf">load</span> <span class="nv">private-file</span><span class="p">))</span></code></pre></div>
<h3 id="common-libraries">Common Libraries</h3>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">async</span> <span class="nb">:commands</span> <span class="p">(</span><span class="nv">async-start</span><span class="p">))</span>
<span class="p">(</span><span class="nb">use-package</span> <span class="nv">s</span> <span class="nb">:demand</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">use-package</span> <span class="nv">dash</span> <span class="nb">:demand</span> <span class="no">t</span> <span class="nb">:config</span> <span class="p">(</span><span class="nv">dash-enable-font-lock</span><span class="p">))</span>
<span class="p">(</span><span class="nb">eval-when-compile</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;cl</span><span class="p">))</span></code></pre></div>
<h2 id="general-configuration"><span class="section-num">2</span> General Configuration</h2>

<h3 id="user-interface">User Interface</h3>

<h4 id="fullscreen">Fullscreen</h4>

<p>Start GMACS in glorious fullscreen.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;default-frame-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">fullscreen</span> <span class="o">.</span> <span class="nv">maximized</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">frame-title-format</span> <span class="s">&#34;GMACS&#34;</span><span class="p">)</span></code></pre></div>
<h4 id="cursor">Cursor</h4>

<p>I prefer a box cursor to a bar cursor. Setting <code>x-stretch-cursor</code> means that this
bar will stretch to the full width of the character it is on. For example, on a
tab (evil tabs!), the cursor will look as wide as a tab.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">display-graphic-p</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">cursor-type</span> <span class="ss">&#39;box</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">x-stretch-cursor</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<ul>
<li><p>Beacon Mode</p>

<p>Never lose your cursor again. This package lights up your cursor when the
screen/cursor position is refactored. It&rsquo;s much more useful than it sounds.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">beacon</span>
  <span class="nb">:defer</span> <span class="mi">2</span>
  <span class="nb">:diminish</span> <span class="p">(</span><span class="nv">beacon-mode</span> <span class="s">&#34; ☀&#34;</span><span class="p">)</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">beacon-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">beacon-color</span> <span class="s">&#34;#b58900&#34;</span><span class="p">))</span></code></pre></div></li>
</ul>

<h4 id="bells">Bells</h4>

<p>Visual, not audible bells.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">ring-bell-function</span> <span class="ss">&#39;ignore</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">visible-bell</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<h4 id="modeline">Modeline</h4>

<p>The <code>smart-mode-line</code> package comes with some useful items on the modeline, as
well as colour coding. Some interesting features (which I set in
<code>sml/replacer-regexp-list</code>) is shortening features. Another useful thing is that
minor modes are displayed.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">smart-mode-line</span>
  <span class="nb">:defer</span> <span class="mi">1</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">sml/setup</span><span class="p">))</span></code></pre></div>
<p>What time is it, Mr. Emacs?</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">display-time-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">display-time-format</span> <span class="s">&#34;%l:%M%p&#34;</span><span class="p">)</span></code></pre></div>
<p><code>line-number-mode</code> mode displays the current line number in the modeline. Except
when there is a line Emacs decides is too long. In that case, all you see in the
modeline is <code>??</code>. See <a href="https://emacs.stackexchange.com/questions/3824/what-piece-of-code-in-emacs-makes-line-number-mode-print-as-line-number-i">this question</a> on Emacs SE for a workaround.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">line-number-display-limit-width</span> <span class="mi">10000</span><span class="p">)</span></code></pre></div>
<p>Given that we&rsquo;re showing the line number in the modeline, it&rsquo;s often nice to
also have the column number.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">column-number-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div>
<h4 id="scrolling">Scrolling</h4>

<p>There are two types of scrolling in Emacs: keyboard scrolling and mouse
scrolling. Both of them are quite jarring out of the box and make the screen
lurch around. Let&rsquo;s fix keyboard scrolling.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">scroll-margin</span> <span class="mi">1</span>
      <span class="nv">scroll-step</span> <span class="mi">1</span>
      <span class="nv">scroll-conservatively</span> <span class="mi">10000</span>
      <span class="nv">scroll-preserve-screen-position</span> <span class="mi">1</span><span class="p">)</span></code></pre></div>
<p>And make mouse scrolling smoother.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">mouse-wheel-scroll-amount</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="p">((</span><span class="nv">shift</span><span class="p">)</span> <span class="o">.</span> <span class="mi">1</span><span class="p">)))</span> <span class="c1">;; one line at a time</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">mouse-wheel-progressive-speed</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; don&#39;t accelerate scrolling</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">mouse-wheel-follow-mouse</span> <span class="no">t</span><span class="p">)</span> <span class="c1">;; scroll window under mouse</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">scroll-step</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">;; keyboard scroll one line at a time</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">scroll-margin</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">;; give the cursor some buffer room before scrolling window</span></code></pre></div>
<h4 id="wrap-indented-lines-sensibly">Wrap Indented Lines Sensibly</h4>

<p>This way, indented lines (such as those visually indented by <code>org-indent-mode</code>)
that are wrapped with <code>visual-line-mode</code> do not begin at character 0, but from
where they are indented.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">adaptive-wrap</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">adaptive-wrap-prefix-mode</span><span class="p">)</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">visual-line-mode</span> <span class="o">.</span> <span class="nv">adaptive-wrap-prefix-mode</span><span class="p">))</span></code></pre></div>
<h4 id="theme">Theme</h4>

<p>I use the popular Solarized Light/Dark themes.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">solarized-theme</span>
  <span class="nb">:demand</span> <span class="no">t</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">load-theme</span> <span class="ss">&#39;solarized-dark</span><span class="p">))</span></code></pre></div>
<p>I switch between the light and dark variants depending on my surroundings. If I
am in a brightly lit room, I prefer to use the light theme, because the dark
theme allows too much screen glare. At night (really, at most times, but in
particular at night) I prefer the dark theme, which, unsurprisingly, spits less
light into my eyes.</p>

<p>The way I switch themes is, admittedly, somewhat hacky. I set a boolean (by
default true) that is true if the active theme is dark, false if light. What can
I say? I prefer the dark side. Then my switch function toggles that value and
changes the theme and the corresponding colours for <code>pdf-view-mode</code>. I like to
view my PDFs not in black and white, but in my theme&rsquo;s colours. To make sure
everything looks right, including the colours in PDFs and the asterisks
for headlines in Org Mode (I hide them with <code>org-bullets-mode</code> but one of them
comes back when I switch themes, for some reason), I refresh all open buffers.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">gm/dark</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/switch-theme</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">togglef</span> <span class="nv">gm/dark</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">gm/dark</span>
      <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nv">load-theme</span> <span class="ss">&#39;solarized-light</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">setq</span> <span class="nv">pdf-view-midnight-colors</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;#839496&#34;</span> <span class="o">.</span> <span class="s">&#34;#fdf6e3&#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">load-theme</span> <span class="ss">&#39;solarized-dark</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">pdf-view-midnight-colors</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;#839496&#34;</span> <span class="o">.</span> <span class="s">&#34;#002b36&#34;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">modi/revert-all-file-buffers</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c t&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/switch-theme</span><span class="p">)</span></code></pre></div>
<ul>
<li><p>Font Face</p>

<p>I change my fonts a lot, so I made it easier to set a font.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/change-font</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">font</span> <span class="p">(</span><span class="nv">ivy-completing-read</span> <span class="s">&#34;Choose a font: &#34;</span>
                                   <span class="p">(</span><span class="nv">delete-dups</span> <span class="p">(</span><span class="nf">font-family-list</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nv">set-face-attribute</span> <span class="ss">&#39;default</span> <span class="no">nil</span> <span class="nb">:font</span> <span class="nv">font</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">set-frame-font</span> <span class="nv">font</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">custom-set-faces</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="nv">variable-pitch</span> <span class="p">((</span><span class="no">t</span> <span class="p">(</span><span class="nb">:family</span> <span class="s">&#34;Source Sans Pro&#34;</span> <span class="nb">:height</span> <span class="mi">115</span><span class="p">)))))</span></code></pre></div></li>

<li><p>Syntax Highlighting</p>

<p>I want syntax highlighting everywhere&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">global-font-lock-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div>
<p>except in massive buffers, where it probably wouldn&rsquo;t be that useful (syntax
highlighting doesn&rsquo;t help you read a CSV file with thousands of lines) and would
definitely slow things down. In such buffers I also remove line numbers.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">buffer-too-big-p</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">buffer-size</span><span class="p">)</span> <span class="p">(</span><span class="nf">*</span> <span class="mi">5000</span> <span class="mi">80</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nv">line-number-at-pos</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span> <span class="mi">5000</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;prog-mode-hook</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
            <span class="c1">;; turn off `nlinum-relative-mode&#39; when there are more than 5000 lines</span>
            <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">buffer-too-big-p</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">nlinum-relative-mode</span> <span class="mi">-1</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">font-lock-mode</span> <span class="mi">-1</span><span class="p">))))</span></code></pre></div>
<p>Normally, I want the opening and closing parentheses highlighted. I used to set
<code>show-paren-style</code> to <code>expression</code>, all that highlighting was not really necessary.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">blink-matching-paren</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nv">show-paren-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">show-paren-delay</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">show-paren-style</span> <span class="ss">&#39;parenthesis</span><span class="p">)</span></code></pre></div>
<p>When I&rsquo;m doing dedicated editing, it&rsquo;s sometimes nice to have more colours,
especially for Lisps such as Emacs Lisp. However, it&rsquo;s too distracting in org
mode source blocks, and it also slows down the point&rsquo;s movement, so I find it
best not to enable it globally.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">rainbow-delimiters</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">emacs-lisp-mode</span> <span class="o">.</span> <span class="nv">rainbow-delimiters-mode</span><span class="p">))</span></code></pre></div>
<p>Finally, <code>rainbow-mode</code> highlights hex-color strings with their colour. Very handy
for choosing colours, especially when editing CSS files.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">rainbow-mode</span>
  <span class="nb">:defer</span> <span class="mi">2</span>
  <span class="nb">:diminish</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">rainbow-mode</span> <span class="mi">1</span><span class="p">))</span></code></pre></div></li>
</ul>

<h3 id="quality-of-life">Quality of Life</h3>

<h4 id="macros">Macros</h4>

<p>Some great macros. <code>after!</code> and <code>lambda!</code> are from the popular DOOM! Emacs
configuration. The documentation on these will be sparse, because the docstrings
do an excellent job of explaining what&rsquo;s going on.</p>

<ul>
<li><p>after!</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">after!</span> <span class="p">(</span><span class="nv">feature</span> <span class="kp">&amp;rest</span> <span class="nv">forms</span><span class="p">)</span>
  <span class="s">&#34;A smart wrapper around </span><span class="ss">`with-eval-after-load&#39;</span><span class="s">. Supresses warnings during
</span><span class="s">compilation.&#34;</span>
  <span class="p">(</span><span class="nb">declare</span> <span class="p">(</span><span class="nv">indent</span> <span class="nb">defun</span><span class="p">)</span> <span class="p">(</span><span class="nv">debug</span> <span class="no">t</span><span class="p">))</span>
  <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">byte-compile-current-file</span><span class="p">))</span>
             <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">symbolp</span> <span class="nv">feature</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">require</span> <span class="nv">feature</span> <span class="no">nil</span> <span class="nb">:no-error</span><span class="p">)</span>
               <span class="p">(</span><span class="nf">load</span> <span class="nv">feature</span> <span class="nb">:no-message</span> <span class="nb">:no-error</span><span class="p">)))</span>
         <span class="nf">#&#39;</span><span class="nb">progn</span>
       <span class="nf">#&#39;</span><span class="nb">with-no-warnings</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-eval-after-load</span> <span class="ss">&#39;,feature</span> <span class="o">,@</span><span class="nv">forms</span><span class="p">)))</span></code></pre></div></li>

<li><p>lambda!</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">lambda!</span> <span class="p">(</span><span class="kp">&amp;rest</span> <span class="nv">body</span><span class="p">)</span>
  <span class="s">&#34;A shortcut for inline interactive lambdas.&#34;</span>
  <span class="p">(</span><span class="nb">declare</span> <span class="p">(</span><span class="nv">doc-string</span> <span class="mi">1</span><span class="p">))</span>
  <span class="o">`</span><span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span> <span class="o">,@</span><span class="nv">body</span><span class="p">))</span></code></pre></div></li>

<li><p>togglef</p>

<p>Simple macro to avoid having to write a variable name twice.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">togglef</span> <span class="p">(</span><span class="nv">place</span><span class="p">)</span>
  <span class="s">&#34;Toggle PLACE.  non-nil becomes nil, nil becomes t.
</span><span class="s">PLACE may be a symbol, or any generalized variable allowed by </span><span class="ss">`setf&#39;</span><span class="s">.
</span><span class="s">The return value is the new value of PLACE.&#34;</span>
  <span class="o">`</span><span class="p">(</span><span class="nb">setf</span> <span class="o">,</span><span class="nv">place</span> <span class="p">(</span><span class="nv">not</span> <span class="o">,</span><span class="nv">place</span><span class="p">)))</span></code></pre></div></li>

<li><p>Conditional Keybindings</p>

<p>Obtained from <a href="http://endlessparentheses.com/define-context-aware-keys-in-emacs.html">Endless Parentheses</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defmacro</span> <span class="nv">define-conditional-key</span> <span class="p">(</span><span class="nv">keymap</span> <span class="nv">key</span> <span class="nv">def</span> <span class="kp">&amp;rest</span> <span class="nv">body</span><span class="p">)</span>
  <span class="s">&#34;In KEYMAP, define key sequence KEY as DEF conditionally.
</span><span class="s">This is like </span><span class="ss">`define-key&#39;</span><span class="s">, except the definition
</span><span class="s">\&#34;disappears\&#34; whenever BODY evaluates to nil.&#34;</span>
  <span class="p">(</span><span class="nb">declare</span> <span class="p">(</span><span class="nv">indent</span> <span class="mi">3</span><span class="p">)</span>
           <span class="p">(</span><span class="nv">debug</span> <span class="p">(</span><span class="nv">form</span> <span class="nv">form</span> <span class="nv">form</span> <span class="kp">&amp;rest</span> <span class="nv">sexp</span><span class="p">)))</span>
  <span class="o">`</span><span class="p">(</span><span class="nf">define-key</span> <span class="o">,</span><span class="nv">keymap</span> <span class="o">,</span><span class="nv">key</span>
     <span class="o">&#39;</span><span class="p">(</span><span class="nv">menu-item</span>
       <span class="o">,</span><span class="p">(</span><span class="nf">format</span> <span class="s">&#34;maybe-%s&#34;</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nf">cdr-safe</span> <span class="nv">def</span><span class="p">))</span> <span class="nv">def</span><span class="p">))</span>
       <span class="no">nil</span>
       <span class="nb">:filter</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">_</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">when</span> <span class="o">,</span><span class="p">(</span><span class="nv">macroexp-progn</span> <span class="nv">body</span><span class="p">)</span>
                   <span class="o">,</span><span class="nv">def</span><span class="p">)))))</span></code></pre></div></li>
</ul>

<h4 id="better-defaults">Better Defaults</h4>

<p>All the things (perhaps they seem little) that just make sense to have.</p>

<ul>
<li><p>From Yes/No to y/n</p>

<p>This makes things so much simpler. There&rsquo;s not any ambiguity to begin with. And
it&rsquo;s two less characters to type.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">fset</span> <span class="ss">&#39;yes-or-no-p</span> <span class="ss">&#39;y-or-n-p</span><span class="p">)</span></code></pre></div></li>

<li><p>Stop Cursor Going into Minibuffer Prompt</p>

<p>Sometimes when going back in the minibuffer by using backspace or the left arrow
key, the cursor will move right back into the prompt, and when you start to type
again, Emacs will display the annoying message that the minibuffer text is read
only. This prevents you from manually having to move the cursor out of the
prompt and then back, or pressing <code>C-g</code> and starting over.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">customize-set-variable</span>
 <span class="ss">&#39;minibuffer-prompt-properties</span>
 <span class="p">(</span><span class="nb">quote</span> <span class="p">(</span><span class="nv">read-only</span> <span class="no">t</span> <span class="nv">cursor-intangible</span> <span class="no">t</span> <span class="nv">face</span> <span class="nf">minibuffer-prompt</span><span class="p">)))</span></code></pre></div></li>

<li><p>Keystroke Echo Timeout</p>

<p>This is one of those things that I didn&rsquo;t think would be useful until I tried
it. When you type a keybinding, the key sequence shows up in the echo area. But
the default timeout, one second, is a bit too long for me.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">echo-keystrokes</span> <span class="mf">0.5</span><span class="p">)</span></code></pre></div></li>

<li><p>Split Vertically by Default</p>

<p>Gotta maximize that vertical screen space. Besides, I always have 80 character
limits on my lines. To be honest, I have no idea how it works, but it seems to
make Emacs prefer splitting vertically.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">split-height-threshold</span> <span class="no">nil</span>
      <span class="nv">split-width-threshold</span> <span class="mi">0</span><span class="p">)</span></code></pre></div></li>

<li><p>Transient Mark Mode</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">transient-mark-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div></li>

<li><p>Electric Pairs Mode</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">electric-pair-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">electric-pair-pairs</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="sc">?\(</span> <span class="o">.</span> <span class="sc">?\)</span><span class="p">)</span>
        <span class="p">(</span><span class="sc">?\&#34;</span> <span class="o">.</span> <span class="sc">?\&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="sc">?\{</span> <span class="o">.</span> <span class="sc">?\}</span><span class="p">)))</span></code></pre></div></li>

<li><p>Uniquify</p>

<p>Make two buffers with the same file name distinguishable. This isn&rsquo;t strictly
necessary because I use <code>smart-mode-line</code>, but the default style puts brackets
around the non-unique buffer names, and I prefer a less confusing style.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">uniquify-buffer-name-style</span> <span class="ss">&#39;forward</span><span class="p">)</span></code></pre></div></li>

<li><p>Beginning of Line</p>

<p><a href="https://emacsredux.com/blog/2013/05/22/smarter-navigation-to-the-beginning-of-a-line/">This article</a> argues that it&rsquo;s usually more useful for <code>C-a</code> to take you to the
beginning of the indentation of the line (that is, the logical/contextual
beginning of the line) as opposed to the literal beginning of the line. I tend
to agree. If you do want to go to the actual beginning of the line, then just
press <code>C-a</code> again.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">smarter-move-beginning-of-line</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="s">&#34;Move point back to indentation of beginning of line.
</span><span class="s">
</span><span class="s">Move point to the first non-whitespace character on this line.
</span><span class="s">If point is already there, move to the beginning of the line.
</span><span class="s">Effectively toggle between the first non-whitespace character and
</span><span class="s">the beginning of the line.
</span><span class="s">
</span><span class="s">If ARG is not nil or 1, move forward ARG - 1 lines first.  If
</span><span class="s">point reaches the beginning or end of the buffer, stop there.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;^p&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">arg</span> <span class="p">(</span><span class="nb">or</span> <span class="nv">arg</span> <span class="mi">1</span><span class="p">))</span>

  <span class="c1">;; Move lines first</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">/=</span> <span class="nv">arg</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">line-move-visual</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">forward-line</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">arg</span><span class="p">))))</span>

  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">orig-point</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">back-to-indentation</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">orig-point</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">move-beginning-of-line</span> <span class="mi">1</span><span class="p">))))</span>

<span class="c1">;; remap C-a to `smarter-move-beginning-of-line&#39;</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">remap</span> <span class="nv">move-beginning-of-line</span><span class="p">]</span> <span class="ss">&#39;smarter-move-beginning-of-line</span><span class="p">)</span>
<span class="p">(</span><span class="nv">global-set-key</span> <span class="p">[</span><span class="nv">remap</span> <span class="nv">org-beginning-of-line</span><span class="p">]</span>  <span class="ss">&#39;smarter-move-beginning-of-line</span><span class="p">)</span></code></pre></div></li>

<li><p>Faster Pop-to-mark</p>

<p><a href="http://endlessparentheses.com/faster-pop-to-mark-command.html">Endless Parentheses</a> shows us this modification to <code>pop-to-mark</code> (bound to <code>C-u
C-t</code>). Now we can pop the mark multiple times by pressing <code>C-t</code> again, rather than
having to type both keystrokes again.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">modi/multi-pop-to-mark</span> <span class="p">(</span><span class="nv">orig-fun</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="s">&#34;Call ORIG-FUN until the cursor moves.
</span><span class="s">Try the repeated popping up to 10 times.&#34;</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">p</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">p</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">apply</span> <span class="nv">orig-fun</span> <span class="nv">args</span><span class="p">)))))</span>

<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;pop-to-mark-command</span> <span class="nb">:around</span> <span class="nf">#&#39;</span><span class="nv">modi/multi-pop-to-mark</span><span class="p">)</span></code></pre></div></li>

<li><p>Integrate Clipboard and Kill Ring</p>

<p>If you copy something into your clipboard from, say, Firefox, then you can paste
it into Emacs. That&rsquo;s all well and good. But if you kill something in Emacs
after copying something to the clipboard, what you had in the clipboard is lost.
That is, the clipboard cannot make use of the power that comes with the multiple
entries in the kill ring. Let&rsquo;s fix that by adding the system clipboard&rsquo;s
contents to the kill ring.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">save-interprogram-paste-before-kill</span> <span class="no">t</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="work-with-protected-files">Work with Protected Files</h4>

<p>Authorize actions.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;auth-source-pass</span><span class="p">)</span>
<span class="p">(</span><span class="nv">auth-source-pass-enable</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">auth-sources</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;~/.authinfo.gpg&#34;</span><span class="p">))</span></code></pre></div>
<h4 id="persistent-scratch-buffer">Persistent Scratch Buffer</h4>

<p>The <code>*scratch*</code> buffer has come in handy for me many times when I want to quickly
test out some Elisp. It would be nice to have it saved; I could clear it easily if
I wanted to. Luckily, there&rsquo;s a package that does just that.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">persistent-scratch</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">persistent-scratch-setup-default</span><span class="p">))</span></code></pre></div>
<h4 id="backups">Backups</h4>

<p>Keep backups in a dedicated spot and not in the current directory: this saves a
lot clutter.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">backup-directory-alist</span> <span class="o">`</span><span class="p">((</span><span class="s">&#34;.&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-cache-dir</span> <span class="s">&#34;backups&#34;</span><span class="p">)))))</span></code></pre></div>
<p>I have lots of disk space, and not so much patience when I lose an important
file. So I save lots.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">delete-old-versions</span> <span class="mi">-1</span>
      <span class="nv">version-control</span> <span class="no">t</span>
      <span class="nv">vc-make-backup-files</span> <span class="no">t</span>
      <span class="nv">create-lockfiles</span> <span class="no">nil</span><span class="p">)</span></code></pre></div>
<ul>
<li><p>Autosave</p>

<p>I want to move the autosaved stuff into the cache dir: let&rsquo;s keep everything
nice and neat.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">auto-save-file-name-transforms</span> <span class="o">`</span><span class="p">((</span><span class="s">&#34;.*&#34;</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-cache-dir</span> <span class="s">&#34;auto-save&#34;</span><span class="p">))</span> <span class="no">t</span><span class="p">))</span>
      <span class="nv">auto-save-list-file-name</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">gmacs-cache-dir</span> <span class="s">&#34;auto-save/.saves~&#34;</span><span class="p">)))</span></code></pre></div>
<p>However, Emacs prints a lot of messages to the echo area telling you that a file
has been autosaved. This is unnecessary, so I use <a href="http://pragmaticemacs.com/emacs/make-emacs-a-bit-quieter/">this hack</a> from Pragmatic Emacs
to quiet down the autosave. Essentially, we replace the default autosave
function with our own silent version.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">auto-save-timeout</span> <span class="mi">99999</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defvar</span> <span class="nv">bjm/auto-save-timer</span> <span class="no">nil</span>
  <span class="s">&#34;Timer to run </span><span class="ss">`bjm/auto-save-silent&#39;</span><span class="s">&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defvar</span> <span class="nv">bjm/auto-save-interval</span> <span class="mi">5</span>
  <span class="s">&#34;How often in seconds of idle time to auto-save with
</span><span class="s"></span><span class="ss">`bjm/auto-save-silent&#39;</span><span class="s">&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/auto-save-silent</span> <span class="p">()</span>
  <span class="s">&#34;Auto-save all buffers silently&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">do-auto-save</span> <span class="no">t</span><span class="p">))</span>

<span class="p">(</span><span class="nb">setq</span> <span class="nv">bjm/auto-save-timer</span>
      <span class="p">(</span><span class="nv">run-with-idle-timer</span> <span class="mi">0</span> <span class="nv">bjm/auto-save-interval</span> <span class="ss">&#39;bjm/auto-save-silent</span><span class="p">))</span></code></pre></div></li>

<li><p>History</p>

<p>It&rsquo;s nice to have a history of commands and other things so that you can get
right to work when you open a new Emacs instance, you can get right to work.
Without this, <code>*table--cell-backward-kill-paragraph</code> is the default command,
because they are sorted alphabetically. If this has ever been the first command
you wanted to execute after opening Emacs, please let me know.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">savehist-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;savehist&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">)</span>
      <span class="nv">save-place-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;saveplaces&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">)</span>
      <span class="nv">recentf-save-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;recentf&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">)</span>
      <span class="nv">transient-history-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;transient-history.el&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">)</span>
      <span class="nv">bookmark-default-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;bookmarks&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">))</span></code></pre></div>
<p>Now we specify what to save.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">savehist-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">history-length</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">history-delete-duplicates</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">savehist-save-minibuffer-history</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">savehist-additional-variables</span>
      <span class="o">&#39;</span><span class="p">(</span><span class="nv">kill-ring</span>
        <span class="nv">search-ring</span>
        <span class="nv">regexp-search-ring</span><span class="p">))</span></code></pre></div></li>
</ul>

<h4 id="reloading">Reloading</h4>

<p>As I am an avid Emacs hacker, it became clear to me very quickly that reloading
Emacs is very useful when testing something out. There are three fronts on which
reloading is useful.</p>

<p>When a file is changed on the disk, I want the content in my Emacs buffer to
reflect that. The only problem with this is that you could lose data if you&rsquo;re
not careful but I autosave almost too often, so this is not a concern for me.
And so I enable <code>auto-revert-mode</code> globally. Given this, I silence the messages
that a buffer has been reverted.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">auto-revert-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">auto-revert-verbose</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;auto-revert-mode</span><span class="p">)</span></code></pre></div>
<p>Sometimes, however, there are other cases in which we want to reload a buffer.
The change have been not in the file&rsquo;s contents, but in an Emacs setting, such
as the colours of the theme. Or the buffer might not have been representing a
file at all. In these cases, it&rsquo;s usually easiest to revert every open buffer.
This might be a problem for you if you&rsquo;re one of those people who keeps hundreds
of buffers open at a time, but I like to close my buffers liberally with the
knowledge that <code>recentf</code> will remember where I&rsquo;ve been for me. I obtained the
following function from <a href="https://emacs.stackexchange.com/questions/24459/revert-all-open-buffers-and-ignore-errors">Emacs Stack Exchange</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">modi/revert-all-file-buffers</span> <span class="p">()</span>
  <span class="s">&#34;Refresh all open file buffers without confirmation.
</span><span class="s">Buffers in modified (not yet saved) state in emacs will not be reverted. They
</span><span class="s">will be reverted though if they were modified outside emacs.
</span><span class="s">Buffers visiting files which do not exist any more or are no longer readable
</span><span class="s">will be killed.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">buf</span> <span class="p">(</span><span class="nf">buffer-list</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">filename</span> <span class="p">(</span><span class="nf">buffer-file-name</span> <span class="nv">buf</span><span class="p">)))</span>
      <span class="c1">;; Revert only buffers containing files, which are not modified;</span>
      <span class="c1">;; do not try to revert non-file buffers like *Messages*.</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">filename</span>
                 <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">buffer-modified-p</span> <span class="nv">buf</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">file-readable-p</span> <span class="nv">filename</span><span class="p">)</span>
            <span class="c1">;; If the file exists and is readable, revert the buffer.</span>
            <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="nv">buf</span>
              <span class="p">(</span><span class="nv">revert-buffer</span> <span class="no">t</span> <span class="no">t</span><span class="p">))</span>
          <span class="c1">;; Otherwise, kill the buffer.</span>
          <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">kill-buffer-query-functions</span><span class="p">)</span> <span class="c1">; No query done when killing buffer</span>
            <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">buf</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Killed non-existing/unreadable file buffer: %s&#34;</span> <span class="nv">filename</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Finished reverting buffers.&#34;</span><span class="p">))</span></code></pre></div>
<p>Other times, we need to reload Emacs fully. To completely reload Emacs, we just
run the procedure of <code>init.el</code> again. Usually, we want to load the byte-compiled
version, but for those cases where we just want to load the uncompiled <code>.el</code> file,
a prefix argument does the job. I disable <code>after-save-hook</code> because I set up
asynchronous tangling and byte-compilation <a href="#tangle-async">here</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/reload</span> <span class="p">(</span><span class="nv">p</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">after-save-hook</span> <span class="no">nil</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gmacs.org&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">el</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gmacs.el&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">elc</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gmacs.elc&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">init</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;init.el&#34;</span> <span class="nv">gmacs-emacs-dir</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="nv">p</span>
        <span class="p">(</span><span class="nv">org-babel-load-file</span> <span class="nv">org</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">save-buffer</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">elc</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">file-newer-than-file-p</span> <span class="nv">org</span> <span class="nv">elc</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">org-babel-tangle-file</span> <span class="nv">org</span> <span class="nv">el</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">byte-compile-file</span> <span class="nv">el</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">load-file</span> <span class="nv">init</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">run-hooks</span> <span class="ss">&#39;after-init-hook</span><span class="p">))))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c r&#34;</span> <span class="ss">&#39;gm/reload</span><span class="p">)</span></code></pre></div>
<p>Finally, I hope it doesn&rsquo;t come to this too often, but sometimes we must close
Emacs entirely and start a new session. I know, I can feel the agony. <code>C-x C-c</code>,
then move your mouse to click Emacs again! Luckily, there&rsquo;s a package for that.
This kills Emacs and starts a new session.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">restart-emacs</span>
  <span class="nb">:commands</span> <span class="nv">restart-emacs</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c R&#34;</span> <span class="o">.</span> <span class="nv">restart-emacs</span><span class="p">)))</span></code></pre></div>
<h4 id="abbreviations">Abbreviations</h4>

<p>Abbrevs are a pretty common and useful feature in editors. You can define
abbrevs, which are strings. When you type space after an abbrev, it is expanded
to whatever you want. Saves a lot of keystrokes.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">abbrev-file-name</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;abbrevs.el&#34;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
<span class="p">(</span><span class="nb">setq-default</span> <span class="nv">abbrev-mode</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">save-abbrevs</span> <span class="ss">&#39;silently</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;abbrev-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c M a&#34;</span> <span class="nf">#&#39;</span><span class="nv">abbrev-mode</span><span class="p">)</span></code></pre></div>
<h4 id="async-without-results-window">Async Without Results Window</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">async-shell-command-no-window</span> <span class="p">(</span><span class="nv">command</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">display-buffer-alist</span>
        <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">cons</span> <span class="s">&#34;\\*Async Shell Command\\*.*&#34;</span>
          <span class="p">(</span><span class="nf">cons</span> <span class="nf">#&#39;</span><span class="nv">display-buffer-no-window</span> <span class="no">nil</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nv">async-shell-command</span>
     <span class="nv">command</span><span class="p">)))</span></code></pre></div>
<h4 id="insert-key-sequence">Insert Key Sequence</h4>

<p>This command takes a key sequence and inserts it into the buffer. This is
surprisingly much easier than typing it in manually. I got it from <a href="http://endlessparentheses.com/inserting-the-kbd-tag-in-org-mode.html">this article</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/insert-key</span> <span class="p">(</span><span class="nv">key</span><span class="p">)</span>
  <span class="s">&#34;Ask for a key then insert its description.
</span><span class="s">Will work on both org-mode and any mode that accepts plain html.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;kType key sequence: &#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">orgp</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;org-mode</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">tag</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">orgp</span> <span class="s">&#34;=%s=&#34;</span> <span class="s">&#34;&lt;kbd&gt;%s&lt;/kbd&gt;&#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">null</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">key</span> <span class="s">&#34;\C-m&#34;</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">insert</span>
         <span class="p">(</span><span class="nf">format</span> <span class="nv">tag</span> <span class="p">(</span><span class="nv">help-key-description</span> <span class="nv">key</span> <span class="no">nil</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">format</span> <span class="nv">tag</span> <span class="s">&#34;&#34;</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">forward-char</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">orgp</span> <span class="mi">-1</span> <span class="mi">-6</span><span class="p">)))))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;C-c k&#34;</span> <span class="o">.</span> <span class="nv">endless/insert-key</span><span class="p">)</span></code></pre></div>
<h4 id="transpose-windows">Transpose Windows</h4>

<p>Every now and then, you&rsquo;ll want to switch the order of the buffers in Emacs.
This usually happens to me if I have something I&rsquo;m reading in one buffer (code
reference, PDF) and something I&rsquo;m writing in the other. I got this from
<a href="https://github.com/bbatsov/crux">bbatsov/crux</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/transpose-windows</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="s">&#34;Transpose the buffers shown in two windows.
</span><span class="s">Prefix ARG determines if the current windows buffer is swapped
</span><span class="s">with the next or previous window, and the number of
</span><span class="s">transpositions to execute in sequence.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;p&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">selector</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span> <span class="ss">&#39;next-window</span> <span class="ss">&#39;previous-window</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">/=</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">this-win</span> <span class="p">(</span><span class="nf">window-buffer</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">next-win</span> <span class="p">(</span><span class="nf">window-buffer</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">selector</span><span class="p">))))</span>
        <span class="p">(</span><span class="nf">set-window-buffer</span> <span class="p">(</span><span class="nf">selected-window</span><span class="p">)</span> <span class="nv">next-win</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">set-window-buffer</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">selector</span><span class="p">)</span> <span class="nv">this-win</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">select-window</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">selector</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">arg</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">arg</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">arg</span><span class="p">)</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">arg</span><span class="p">))))))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x 4 t&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/transpose-windows</span><span class="p">)</span></code></pre></div>
<h4 id="tangle-async">Tangle Config File</h4>

<p>I used to have my <code>init.el</code> set up so that, if <code>gmacs.elc</code> did not exist, it would
tangle <code>gmacs.org</code>. This unfortunately means that when I clear out the
byte-compiled file, Emacs takes a long time to start up (about 6 seconds). To
solve this, I tangle this very file on save.</p>

<p>First, we set up a function to do the tangling. We have to, for example, refer
to <code>user-emacs-directory</code> and not <code>gmacs-emacs-directory</code>, and run <code>(require
'ob-tangle)</code> because the function is run in its own subprocess (this is what
allows it to be asynchronous).</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/tangle-gmacs-helper</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">src</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gmacs.org&#34;</span> <span class="nv">user-emacs-directory</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">dst</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gmacs.el&#34;</span> <span class="nv">user-emacs-directory</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ob-tangle</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-babel-tangle-file</span> <span class="nv">src</span> <span class="nv">dst</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">byte-compile-file</span> <span class="nv">dst</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span> <span class="nv">byte-compile-log-buffer</span>
      <span class="p">(</span><span class="nf">buffer-string</span><span class="p">))))</span></code></pre></div>
<p>Then, we wrap this in an asynchronous process. I only really want to know about
this process if it failed.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/tangle-gmacs</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">async-start</span> <span class="p">(</span><span class="nf">symbol-function</span> <span class="nf">#&#39;</span><span class="nv">gm/tangle-gmacs-helper</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">result</span><span class="p">)</span>
                 <span class="p">(</span><span class="nb">unless</span> <span class="nv">result</span>
                   <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;GMACS unsuccessfully tangled: %s&#34;</span> <span class="nv">result</span><span class="p">)))))</span></code></pre></div>
<p>Finally. we wrap this in a function that checks whether we&rsquo;re in the right file.
It would be inefficient to tangle the configuration file a different file was
edited and saved.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/tangle-if-config</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">string-suffix-p</span> <span class="s">&#34;gmacs.org&#34;</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">gm/tangle-gmacs</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;after-save-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/tangle-if-config</span><span class="p">)</span></code></pre></div>
<h4 id="profile-startup-time">Profile Startup Time</h4>

<p>If I introduce a new feature that increases my startup time, I can test things
out quantitatively with <code>esup</code>, a built-in feature.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;esup</span> <span class="s">&#34;esup&#34;</span><span class="p">)</span></code></pre></div>
<h3 id="wordsmithing">Wordsmithing</h3>

<h4 id="basic-configuration">Basic Configuration</h4>

<ul>
<li><p>Sentences End With a Single Space</p>

<p>This is necessary to make sentence navigation commands work for me. I also don&rsquo;t
live in the typewriter days where the</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">sentence-end-double-space</span> <span class="no">nil</span><span class="p">)</span></code></pre></div></li>

<li><p>Delete Selection</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">delete-selection-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div></li>

<li><p>Don&rsquo;t Adjust Point When Pasting by Mouse</p>

<p>Pasting into Emacs by middle-clicking can be nice, but I don&rsquo;t want the click to
change the location of the point and then paste there instead of where the point
originally was.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">mouse-yank-at-point</span> <span class="no">t</span><span class="p">)</span></code></pre></div></li>

<li><p>Ban Whitespace</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;before-save-hook</span> <span class="nf">#&#39;</span><span class="nv">delete-trailing-whitespace</span><span class="p">)</span></code></pre></div></li>

<li><p>Autofill</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">global-visual-line-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;visual-line-mode</span><span class="p">)</span></code></pre></div>
<p>Nicely wrap lines for text mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;text-mode-hook</span> <span class="ss">&#39;auto-fill-mode</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;change-log-mode-hook</span> <span class="ss">&#39;turn-on-auto-fill</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;auto-fill-function</span><span class="p">)</span></code></pre></div>
<p>Default wrap at 80 characters.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">fill-column</span> <span class="mi">80</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="utilities">Utilities</h4>

<ul>
<li><p>Dictionary</p>

<p>See this <a href="http://jsomers.net/blog/dictionary">beautiful post</a> by James Somers on why you should use this dictionary.
It&rsquo;s Webster&rsquo;s original, his magnum opus.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;sdcv-search</span> <span class="s">&#34;sdcv-mode&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c d&#34;</span> <span class="ss">&#39;sdcv-search</span><span class="p">)</span></code></pre></div></li>

<li><p>Highlighting/Comments</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;ov-highlight/body</span> <span class="s">&#34;ov-highlight&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c h&#34;</span> <span class="ss">&#39;ov-highlight/body</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c C-h&#34;</span> <span class="ss">&#39;ov-highlight/body</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="spelling">Spelling</h4>

<ul>
<li><p>Setup</p>

<p>The article <a href="https://joelkuiper.eu/spellcheck%5Femacs">Spell checking in Emacs</a> helped me out in setting up spellchecking in
my own Emacs configuration.</p>

<p>We automatically spellcheck text buffers using <code>flyspell</code>. The only mode I write
prose in is Org Mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">flyspell</span>
  <span class="nb">:diminish</span>
  <span class="nb">:commands</span> <span class="nv">flyspell-mode</span>
  <span class="nb">:init</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">hook</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">text-mode-hook</span> <span class="nv">org-mode-hook</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-hook</span> <span class="nv">hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">flyspell-mode</span> <span class="mi">1</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">hook</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">change-log-mode-hook</span> <span class="nv">log-edit-mode-hook</span> <span class="nv">org-agenda-mode-hook</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-hook</span> <span class="nv">hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">flyspell-mode</span> <span class="mi">-1</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">ispell-program-name</span> <span class="s">&#34;hunspell&#34;</span>
        <span class="nv">ispell-local-dictionary</span> <span class="s">&#34;en_CA&#34;</span>
        <span class="nv">ispell-hunspell-dictionary-alist</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;en_CA&#34;</span> <span class="s">&#34;[[:alpha:]]&#34;</span> <span class="s">&#34;[^[:alpha:]]&#34;</span> <span class="s">&#34;[&#39;]&#34;</span> <span class="no">nil</span> <span class="p">(</span><span class="s">&#34;-d&#34;</span> <span class="s">&#34;en_CA&#34;</span><span class="p">)</span> <span class="no">nil</span> <span class="nv">utf-8</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq-default</span> <span class="nv">flyspell-issue-message-flag</span> <span class="no">nil</span>
                <span class="nv">flyspell-issue-welcome-flag</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">flyspell-abbrev-p</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">frog-menu-flyspell-correct</span> <span class="p">(</span><span class="nv">candidates</span> <span class="nv">word</span><span class="p">)</span>
    <span class="s">&#34;Run </span><span class="ss">`frog-menu-read&#39;</span><span class="s"> for the given CANDIDATES.
</span><span class="s">
</span><span class="s">  List of CANDIDATES is given by flyspell for the WORD.
</span><span class="s">
</span><span class="s">  Return selected word to use as a replacement or a tuple
</span><span class="s">  of (command . word) to be used by </span><span class="ss">`flyspell-do-correct&#39;</span><span class="s">.&#34;</span>
    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">corrects</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">flyspell-sort-corrections</span>
                         <span class="p">(</span><span class="nf">sort</span> <span class="nv">candidates</span> <span class="ss">&#39;string&lt;</span><span class="p">)</span>
                       <span class="nv">candidates</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">actions</span> <span class="o">`</span><span class="p">((</span><span class="s">&#34;C-s&#34;</span> <span class="s">&#34;Save word&#34;</span>         <span class="p">(</span><span class="nv">save</span>    <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                      <span class="p">(</span><span class="s">&#34;C-a&#34;</span> <span class="s">&#34;Accept (session)&#34;</span>  <span class="p">(</span><span class="nv">session</span> <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                      <span class="p">(</span><span class="s">&#34;C-b&#34;</span> <span class="s">&#34;Accept (buffer)&#34;</span>   <span class="p">(</span><span class="nv">buffer</span>  <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                      <span class="p">(</span><span class="s">&#34;C-c&#34;</span> <span class="s">&#34;Skip&#34;</span>              <span class="p">(</span><span class="nv">skip</span>    <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))))</span>
           <span class="p">(</span><span class="nv">prompt</span>   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;Dictionary: [%s]&#34;</span>  <span class="p">(</span><span class="nb">or</span> <span class="nv">ispell-local-dictionary</span>
                                                     <span class="nv">ispell-dictionary</span>
                                                     <span class="s">&#34;default&#34;</span><span class="p">)))</span>
           <span class="p">(</span><span class="nv">res</span>      <span class="p">(</span><span class="nv">frog-menu-read</span> <span class="nv">prompt</span> <span class="nv">corrects</span> <span class="nv">actions</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="nv">res</span>
        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Quit&#34;</span><span class="p">))</span>
      <span class="nv">res</span><span class="p">))</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;frog-menu-read</span> <span class="s">&#34;frog-menu&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">flyspell-correct</span>
    <span class="nb">:commands</span> <span class="nv">flyspell-correct-wrapper</span>
    <span class="nb">:custom</span>
    <span class="p">(</span><span class="nv">flyspell-correct-interface</span> <span class="nf">#&#39;</span><span class="nv">frog-menu-flyspell-correct</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="p">[</span><span class="nv">remap</span> <span class="nv">flyspell-auto-correct-previous-word</span><span class="p">]</span>
            <span class="nf">#&#39;</span><span class="nv">flyspell-correct-wrapper</span> <span class="nv">flyspell-mode-map</span><span class="p">))</span></code></pre></div>
<p>Set up spellchecking using <code>ispell</code> and the dictionary <code>hunspell</code>. We set the
locally used dictionary to Canadian English, and we set up the list of valid
dictionaries.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">ispell-program-name</span> <span class="s">&#34;hunspell&#34;</span>
      <span class="nv">ispell-local-dictionary</span> <span class="s">&#34;en_CA&#34;</span>
      <span class="nv">ispell-hunspell-dictionary-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;en_CA&#34;</span> <span class="s">&#34;[[:alpha:]]&#34;</span> <span class="s">&#34;[^[:alpha:]]&#34;</span> <span class="s">&#34;[&#39;]&#34;</span> <span class="no">nil</span> <span class="p">(</span><span class="s">&#34;-d&#34;</span> <span class="s">&#34;en_CA&#34;</span><span class="p">)</span> <span class="no">nil</span> <span class="nv">utf-8</span><span class="p">)))</span></code></pre></div>
<p>As suggested by the Emacs wiki, I supress messages, which slows down
performance when checking the entire buffer.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">flyspell-issue-message-flag</span> <span class="no">nil</span>
              <span class="nv">flyspell-issue-welcome-flag</span> <span class="no">nil</span><span class="p">)</span></code></pre></div>
<p>Spellchecking should not occur inside certain parts of Org Mode buffers like
property drawers and code source blocks. From <a href="http://endlessparentheses.com/ispell-and-org-mode.html?source=rss">Making Ispell work with org-mode
in Emacs</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/org-ispell</span> <span class="p">()</span>
  <span class="s">&#34;Configure </span><span class="ss">`ispell-skip-region-alist&#39;</span><span class="s"> for </span><span class="ss">`org-mode&#39;</span><span class="s">.&#34;</span>
  <span class="p">(</span><span class="nf">make-local-variable</span> <span class="ss">&#39;ispell-skip-region-alist</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">org-property-drawer-re</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;^#\+.*$&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;~&#34;</span> <span class="s">&#34;~&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;=&#34;</span> <span class="s">&#34;=&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;ispell-skip-region-alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;^#\\+BEGIN_SRC&#34;</span> <span class="o">.</span> <span class="s">&#34;^#\\+END_SRC&#34;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">endless/org-ispell</span><span class="p">)</span></code></pre></div></li>

<li><p>Autocorrect and Abbreviations and Avy Selection</p>

<p>We want to be able to go to the previous error and correct it, then add it to
our global abbreviation list. As long as we spell the word incorrectly the same
way, we&rsquo;ll never make that typo again. I used to use code I took and modified
from <a href="http://endlessparentheses.com/ispell-and-abbrev-the-perfect-auto-correct.html">Artur Malabarba</a> and Howard Abrams, but now I just set this variable built
into <code>flyspell</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">flyspell-abbrev-p</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<p>However, I&rsquo;m not a fan of the default interface for selecting spelling
corrections. Many forces in Emacs fight for window space, from expanded
minibuffers to popup windows. Both have their disadvantages. The minibuffer is
away from the action and requires you to look to a different place on the
screen. Popup windows can easily cause a jarring change in the way content is
displayed on the buffer. The solution is a <a href="https://github.com/alphapapa/frog-menu">frog menu</a>.</p>

<p>Its role is not fixed, but ad hoc; it pops up at the right moment in the right
place, just as the frog&rsquo;s tongue pouncing on the fly.</p>

<p>We use the <code>flyspell-correct</code> package to implement such an interface. It uses <code>avy</code>
for selection.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;frog-menu-read</span> <span class="s">&#34;frog-menu&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">use-package</span> <span class="nv">flyspell-correct</span>
  <span class="nb">:commands</span> <span class="nv">flyspell-correct-wrapper</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">flyspell-correct-interface</span> <span class="nf">#&#39;</span><span class="nv">frog-menu-flyspell-correct</span><span class="p">))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">frog-menu-flyspell-correct</span> <span class="p">(</span><span class="nv">candidates</span> <span class="nv">word</span><span class="p">)</span>
  <span class="s">&#34;Run </span><span class="ss">`frog-menu-read&#39;</span><span class="s"> for the given CANDIDATES.
</span><span class="s">
</span><span class="s">List of CANDIDATES is given by flyspell for the WORD.
</span><span class="s">
</span><span class="s">Return selected word to use as a replacement or a tuple
</span><span class="s">of (command . word) to be used by </span><span class="ss">`flyspell-do-correct&#39;</span><span class="s">.&#34;</span>
  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">corrects</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">flyspell-sort-corrections</span>
                       <span class="p">(</span><span class="nf">sort</span> <span class="nv">candidates</span> <span class="ss">&#39;string&lt;</span><span class="p">)</span>
                     <span class="nv">candidates</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">actions</span> <span class="o">`</span><span class="p">((</span><span class="s">&#34;C-s&#34;</span> <span class="s">&#34;Save word&#34;</span>         <span class="p">(</span><span class="nv">save</span>    <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                    <span class="p">(</span><span class="s">&#34;C-a&#34;</span> <span class="s">&#34;Accept (session)&#34;</span>  <span class="p">(</span><span class="nv">session</span> <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                    <span class="p">(</span><span class="s">&#34;C-b&#34;</span> <span class="s">&#34;Accept (buffer)&#34;</span>   <span class="p">(</span><span class="nv">buffer</span>  <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))</span>
                    <span class="p">(</span><span class="s">&#34;C-c&#34;</span> <span class="s">&#34;Skip&#34;</span>              <span class="p">(</span><span class="nv">skip</span>    <span class="o">.</span> <span class="o">,</span><span class="nv">word</span><span class="p">))))</span>
         <span class="p">(</span><span class="nv">prompt</span>   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;Dictionary: [%s]&#34;</span>  <span class="p">(</span><span class="nb">or</span> <span class="nv">ispell-local-dictionary</span>
                                                   <span class="nv">ispell-dictionary</span>
                                                   <span class="s">&#34;default&#34;</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">res</span>      <span class="p">(</span><span class="nv">frog-menu-read</span> <span class="nv">prompt</span> <span class="nv">corrects</span> <span class="nv">actions</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="nv">res</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Quit&#34;</span><span class="p">))</span>
    <span class="nv">res</span><span class="p">))</span></code></pre></div>
<p><a href="http://pragmaticemacs.com/emacs/jump-back-to-previous-typo/">This article</a> thinks that going to the previous error is more useful than going
to the next one. This is usually true, and aligns with the default behaviour
<code>flyspell-correct-wrapper</code>. The default binding on <code>C-;</code> is <code>flyspell</code>&rsquo;s built-in
autocorrect function. However, its suggestions are often not so useful, and
we&rsquo;ve subsumed its role with <code>flyspell-correct</code> anyway.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="p">[</span><span class="nv">remap</span> <span class="nv">flyspell-auto-correct-previous-word</span><span class="p">]</span>
          <span class="nf">#&#39;</span><span class="nv">flyspell-correct-wrapper</span> <span class="nv">flyspell-mode-map</span><span class="p">)</span></code></pre></div></li>

<li><p>Correct Double Capitals</p>

<p>Taken from <a href="https://emacs.stackexchange.com/questions/13970/fixing-double-capitals-as-i-type/13975#13975">Stack Exchange</a>. It&rsquo;s a piece of code with a great impact to
complexity ratio. Whenever you&rsquo;re a bit slow in releasing the Shift key and type
something like &ldquo;THis,&rdquo; <code>dubcaps-mode</code> converts it to &ldquo;This&rdquo; for you automatically.
This isn&rsquo;t really a hindrance, because if I actually want two capital letters in
a row, I almost never want a lowercase letter to follow.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/dcaps-to-scaps</span> <span class="p">()</span>
  <span class="s">&#34;Convert word in DOuble CApitals to Single Capitals.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">=</span> <span class="sc">?w</span> <span class="p">(</span><span class="nf">char-syntax</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)))</span>
       <span class="p">(</span><span class="nb">save-excursion</span>
         <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">called-interactively-p</span> <span class="ss">&#39;interactive</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">skip-syntax-backward</span> <span class="s">&#34;w&#34;</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">=</span> <span class="mi">-3</span> <span class="p">(</span><span class="nf">skip-syntax-backward</span> <span class="s">&#34;w&#34;</span><span class="p">)))</span>
              <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">case-fold-search</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;\\b[[:upper:]]\\{2\\}[[:lower:]]&#34;</span><span class="p">))</span>
              <span class="p">(</span><span class="nf">capitalize-word</span> <span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">define-minor-mode</span> <span class="nv">gm/dubcaps-mode</span>
  <span class="s">&#34;Toggle </span><span class="ss">`gm/dubcaps-mode&#39;</span><span class="s">.  Converts words in DOuble CApitals to
</span><span class="s">Single Capitals as you type.&#34;</span>
  <span class="nb">:init-value</span> <span class="no">nil</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">gm/dubcaps-mode</span>
      <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;post-self-insert-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/dcaps-to-scaps</span> <span class="no">nil</span> <span class="ss">&#39;local</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;post-self-insert-hook</span> <span class="nf">#&#39;</span><span class="nv">g/dcaps-to-scaps</span> <span class="ss">&#39;local</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;text-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/dubcaps-mode</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="text-manipulation">Text Manipulation</h4>

<ul>
<li><p>Cut/Paste</p>

<p>From the infamous Xah Lee.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">xah-cut-line-or-region</span> <span class="p">()</span>
  <span class="s">&#34;Cut current line, or text selection.
</span><span class="s">When </span><span class="ss">`universal-argument&#39;</span><span class="s"> is called first, cut whole buffer (respects </span><span class="ss">`narrow-to-region&#39;</span><span class="s">).
</span><span class="s">URL </span><span class="ss">`http://ergoemacs.org/emacs/emacs_copy_cut_current_line.html&#39;</span><span class="s">
</span><span class="s">Version 2015-06-10&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">progn</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">use-region-p</span><span class="p">)</span>
               <span class="p">(</span><span class="nv">kill-region</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
             <span class="p">(</span><span class="nv">kill-region</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-beginning-position</span> <span class="mi">2</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">xah-copy-line-or-region</span> <span class="p">()</span>
  <span class="s">&#34;Copy current line, or text selection.
</span><span class="s">When called repeatedly, append copy subsequent lines.
</span><span class="s">When </span><span class="ss">`universal-argument&#39;</span><span class="s"> is called first, copy whole buffer (respects </span><span class="ss">`narrow-to-region&#39;</span><span class="s">).
</span><span class="s">
</span><span class="s">URL </span><span class="ss">`http://ergoemacs.org/emacs/emacs_copy_cut_current_line.html&#39;</span><span class="s">
</span><span class="s">Version 2018-09-10&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">current-prefix-arg</span>
      <span class="p">(</span><span class="nb">progn</span>
        <span class="p">(</span><span class="nv">copy-region-as-kill</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">use-region-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">progn</span>
          <span class="p">(</span><span class="nv">copy-region-as-kill</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">last-command</span> <span class="nv">this-command</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">progn</span> <span class="p">)</span>
            <span class="p">(</span><span class="nb">progn</span>
              <span class="p">(</span><span class="nv">kill-append</span> <span class="s">&#34;\n&#34;</span> <span class="no">nil</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">kill-append</span>
               <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span>
               <span class="no">nil</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">progn</span>
                <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
                <span class="p">(</span><span class="nf">forward-char</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)</span> <span class="mi">10</span> <span class="p">)</span>
                <span class="p">(</span><span class="nb">progn</span> <span class="p">)</span>
              <span class="p">(</span><span class="nb">progn</span>
                <span class="p">(</span><span class="nv">copy-region-as-kill</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span>
                <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)))</span>
          <span class="p">(</span><span class="nb">progn</span>
            <span class="p">(</span><span class="nv">copy-region-as-kill</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">forward-char</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-k&#34;</span> <span class="ss">&#39;xah-cut-line-or-region</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-w&#34;</span> <span class="ss">&#39;xah-copy-line-or-region</span><span class="p">)</span></code></pre></div>
<p>Org Mode rebinds <code>C-k</code> to its own kill line function, so we set up another binding
here.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-k&#34;</span> <span class="nf">#&#39;</span><span class="nv">xah-cut-line-or-region</span> <span class="nv">org-mode-map</span><span class="p">)</span></code></pre></div></li>

<li><p>Paragraph Navigation</p>

<p>Keep blank lines as paragraph delimiters, no matter the major mode. From <a href="http://endlessparentheses.com/meta-binds-part-2-a-peeve-with-paragraphs.html">Meta
Binds Part 2: A peeve with paragraphs</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-p&#34;</span> <span class="ss">&#39;endless/backward-paragraph</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-n&#34;</span> <span class="ss">&#39;endless/forward-paragraph</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/forward-paragraph</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">n</span><span class="p">)</span>
  <span class="s">&#34;Advance just past next blank line.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;p&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">para-commands</span>
         <span class="o">&#39;</span><span class="p">(</span><span class="nv">endless/forward-paragraph</span> <span class="nv">endless/backward-paragraph</span><span class="p">)))</span>
    <span class="c1">;; Only push mark if it&#39;s not active and we&#39;re not repeating.</span>
    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">use-region-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">member</span> <span class="nv">this-command</span> <span class="nv">para-commands</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">member</span> <span class="nv">last-command</span> <span class="nv">para-commands</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">push-mark</span><span class="p">))</span>
    <span class="c1">;; The actual movement.</span>
    <span class="p">(</span><span class="nb">dotimes</span> <span class="p">(</span><span class="nv">_</span> <span class="p">(</span><span class="nf">abs</span> <span class="nv">n</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">skip-chars-forward</span> <span class="s">&#34;\n[:blank:]&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">skip-chars-backward</span> <span class="s">&#34;\n[:blank:]&#34;</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">search-forward-regexp</span>
           <span class="s">&#34;\n[[:blank:]]*\n[[:blank:]]*&#34;</span> <span class="no">nil</span> <span class="no">t</span> <span class="p">(</span><span class="nv">cl-signum</span> <span class="nv">n</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">n</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">endless/backward-paragraph</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">n</span><span class="p">)</span>
  <span class="s">&#34;Go back up to previous blank line.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;p&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">endless/forward-paragraph</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">n</span><span class="p">)))</span></code></pre></div>
<p>But Org Mode messes this up. So we setup a binding using the <code>:bind</code> keyword from
<code>use-package</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;M-n&#34;</span> <span class="o">.</span> <span class="nv">forward-paragraph</span><span class="p">)</span>
<span class="p">(</span><span class="s">&#34;M-p&#34;</span> <span class="o">.</span> <span class="nv">backward-paragraph</span><span class="p">)</span></code></pre></div></li>

<li><p>Transpose Elements</p>

<p>Add aliases to do this easily.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;ts</span> <span class="ss">&#39;transpose-sentences</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defalias</span> <span class="ss">&#39;tp</span> <span class="ss">&#39;transpose-paragraphs</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-r&#34;</span> <span class="ss">&#39;transpose-chars</span><span class="p">)</span></code></pre></div></li>

<li><p>Capitalize Word</p>

<p>The default behaviour, that pressing <code>M-c</code> here (with the cursor at <code>|</code>) <code>capit|alize</code>
produces <code>capitAlize</code> is silly; I can&rsquo;t think of a situation where I would want to
capitalize just the following character if the cursor is in the middle of a
word.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-c&#34;</span> <span class="nf">#&#39;</span><span class="nv">captialize-dwim</span><span class="p">)</span></code></pre></div></li>

<li><p>Expand Region</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">expand-region</span>
  <span class="nb">:commands</span> <span class="nv">er/expand-region</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-=&#34;</span> <span class="o">.</span> <span class="nv">er/expand-region</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;M-2&#34;</span> <span class="o">.</span> <span class="nv">er/expand-region</span><span class="p">)))</span></code></pre></div></li>
</ul>

<h3 id="programming">Programming</h3>

<p>The age old debate: tabs or spaces? I say spaces.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">indent-tabs-mode</span> <span class="no">nil</span>
              <span class="nv">tab-width</span> <span class="mi">2</span><span class="p">)</span></code></pre></div>
<p>Make <code>TAB</code> indent first then perform completion, if any.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">tab-always-indent</span> <span class="ss">&#39;complete</span><span class="p">)</span></code></pre></div>
<p>Set up <code>flycheck</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">flycheck</span>
  <span class="nb">:commands</span> <span class="nv">flycheck-mode</span>
  <span class="nb">:diminish</span> <span class="p">(</span><span class="nv">flycheck-mode</span> <span class="s">&#34; Ψ&#34;</span><span class="p">)</span>
  <span class="nb">:custom</span> <span class="p">(</span><span class="nv">flycheck-display-errors-delay</span> <span class="mf">.3</span><span class="p">)</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">prog-mode</span> <span class="o">.</span> <span class="nv">flycheck-mode</span><span class="p">))</span></code></pre></div>
<p>Relative line numbers, useful for Vim-like navigation with God Mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">nlinum-relative</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">prog-mode</span> <span class="o">.</span> <span class="nv">nlinum-relative-mode</span><span class="p">))</span></code></pre></div>
<h4 id="flycheck-hydra">Flycheck Hydra</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-flycheck</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
  <span class="s">&#34;
</span><span class="s">  ^
</span><span class="s">  ^Flycheck^          ^Errors^            ^Checker^
</span><span class="s">  ^────────^──────────^──────^────────────^───────^─────
</span><span class="s">  _q_ quit            _&lt;_ previous        _?_ describe
</span><span class="s">  _M_ manual          _&gt;_ next            _d_ disable
</span><span class="s">  _v_ verify setup    _f_ check           _m_ mode
</span><span class="s">  ^^                  _l_ list            _s_ select
</span><span class="s">  ^^                  ^^                  ^^
</span><span class="s">  &#34;</span>
  <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="no">nil</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;&lt;&#34;</span> <span class="nv">flycheck-previous-error</span> <span class="nb">:color</span> <span class="nv">pink</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;&gt;&#34;</span> <span class="nv">flycheck-next-error</span> <span class="nb">:color</span> <span class="nv">pink</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;?&#34;</span> <span class="nv">flycheck-describe-checker</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;M&#34;</span> <span class="nv">flycheck-manual</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="nv">flycheck-disable-checker</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="nv">flycheck-buffer</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="nv">flycheck-list-errors</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="nv">flycheck-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="nv">flycheck-select-checker</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;v&#34;</span> <span class="nv">flycheck-verify-setup</span><span class="p">))</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c f&#34;</span> <span class="nf">#&#39;</span><span class="nv">hydra-flycheck/body</span><span class="p">)</span></code></pre></div>
<h4 id="python">Python</h4>

<p>Indent with 4 spaces.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">python-indent-offset</span> <span class="mi">4</span><span class="p">)</span></code></pre></div>
<p>Turn Emacs into basically a Python IDE.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">elpy</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">py-autopep8</span>
    <span class="nb">:hook</span> <span class="p">(</span><span class="nv">elpy-mode</span> <span class="o">.</span> <span class="nv">py-autopep8-enable-on-save</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">elpy-modules</span> <span class="p">(</span><span class="nf">delq</span> <span class="ss">&#39;elpy-module-flymake</span> <span class="nv">elpy-modules</span><span class="p">))</span>
  <span class="nb">:hook</span>
  <span class="p">(</span><span class="nv">python-mode</span> <span class="o">.</span> <span class="nv">elpy-enable</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">python-mode</span> <span class="o">.</span> <span class="nv">elpy-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elpy-mode</span> <span class="o">.</span> <span class="nv">flycheck-mode</span><span class="p">))</span></code></pre></div>
<h4 id="lisp">Lisp</h4>

<p>Because <code>use-package</code> is never actually evaluated/loaded if we byte-compile
<code>gmacs.el</code>, it is not automatically syntax-highlighted as a macro.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="ss">&#39;emacs-lisp-mode</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;use-package &#34;</span> <span class="o">.</span> <span class="nv">font-lock-keyword-face</span><span class="p">)))</span></code></pre></div>
<p>We don&rsquo;t want annoying comments about having, for example, <code>;;; package ---
summary</code> at the top of an Emacs Lisp file.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq-default</span> <span class="nv">flycheck-disabled-checkers</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">emacs-lisp-checkdoc</span><span class="p">))</span></code></pre></div>
<p>Sexps are everything in Lisp. The default bindings to traverse them forwards and
backwards are clunky: <code>C-M-f</code>, <code>C-M-b</code>. Since I&rsquo;ve already taken my <code>M-digit</code>
<a href="#window-management">bindings</a>, I&rsquo;m willing to do it again.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-9&#34;</span> <span class="nf">#&#39;</span><span class="nv">backward-sexp</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-0&#34;</span> <span class="nf">#&#39;</span><span class="nv">forward-sexp</span><span class="p">)</span></code></pre></div>
<h3 id="packages">Packages</h3>

<h4 id="helpful">Helpful</h4>

<p>This package is a more informative alternative to the default Emacs
documentation/help feature. The <a href="https://github.com/Wilfred/helpful">author&rsquo;s pictures</a> explain it better than I
could.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">helpful</span>
  <span class="nb">:bind</span>
  <span class="p">((</span><span class="s">&#34;C-h f&#34;</span> <span class="o">.</span> <span class="nv">helpful-callable</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&#34;C-h v&#34;</span> <span class="o">.</span> <span class="nv">helpful-variable</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&#34;C-h k&#34;</span> <span class="o">.</span> <span class="nv">helpful-key</span><span class="p">)</span>
   <span class="p">(</span><span class="s">&#34;C-h F&#34;</span> <span class="o">.</span> <span class="nv">helpful-function</span><span class="p">)</span>       <span class="c1">; no macros</span>
   <span class="p">(</span><span class="s">&#34;C-h C&#34;</span> <span class="o">.</span> <span class="nv">helpful-command</span><span class="p">)</span>        <span class="c1">; only interactive functions</span>
  <span class="p">)</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">helpful-callable</span>
             <span class="nv">helpful-variable</span>
             <span class="nv">helpful-key</span>
             <span class="nv">helpful-function</span>
             <span class="nv">helpful-command</span><span class="p">))</span></code></pre></div>
<h4 id="paradox">Paradox</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">paradox</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">package-initialize</span><span class="p">)</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">paradox-enable</span><span class="p">))</span></code></pre></div>
<h4 id="key-frequency">Key Frequency</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">keyfreq</span>
  <span class="nb">:defer</span> <span class="mi">2</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">keyfreq-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">keyfreq-autosave-mode</span> <span class="mi">1</span><span class="p">))</span></code></pre></div>
<h4 id="tramp">Tramp</h4>

<p>Make sure to keep backups locally and not remotely.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">tramp-backup-directory-alist</span> <span class="nv">backup-directory-alist</span><span class="p">)</span></code></pre></div>
<p>Set tramp connection history location.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">tramp-cache</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">tramp-persistency-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;tramp&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">)))</span></code></pre></div>
<h4 id="magit">Magit</h4>

<p>Magit, the magical Git client, is an amazing porcelain for Git inside of Emacs.
Seriously, I&rsquo;ve forgotten how tedious using Git on the command line is, and
every time I have to is a pain. Emacs is worth using for this package alone. We
only load it from the entry points given in <code>:commands</code>. We also define a
quick-bind to quit the current Magit session and return to the previous window
configuration. This way, we can let Magit take up the full real estate on the
screen, and once we&rsquo;re done, we can get right back to where we left off.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">magit</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">magit-status</span> <span class="nv">magit-blame</span> <span class="nv">magit-log-buffer-file</span> <span class="nv">magit-log-all</span><span class="p">)</span>
  <span class="nb">:init</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">magit-quit-session</span> <span class="p">()</span>
    <span class="s">&#34;Restores the previous window configuration and kills the magit buffer&#34;</span>
    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">kill-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">jump-to-register</span> <span class="nb">:magit-fullscreen</span><span class="p">))</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nb">defadvice</span> <span class="nv">magit-status</span> <span class="p">(</span><span class="nv">around</span> <span class="nv">magit-fullscreen</span> <span class="nv">activate</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">window-configuration-to-register</span> <span class="nb">:magit-fullscreen</span><span class="p">)</span>
    <span class="nv">ad-do-it</span>
    <span class="p">(</span><span class="nv">delete-other-windows</span><span class="p">))</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-x g&#34;</span> <span class="o">.</span> <span class="nv">magit-status</span><span class="p">)</span>
         <span class="nb">:map</span> <span class="nv">magit-status-mode-map</span>
              <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="o">.</span> <span class="nv">magit-quit-session</span><span class="p">)))</span></code></pre></div>
<h4 id="dired">Dired</h4>

<ul>
<li><p>Async</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;dired-async-mode</span> <span class="s">&#34;dired-async.el&#34;</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">dired-async-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div></li>

<li><p>Revert Buffer</p>

<p>Have the most up-to-date version of the buffer when using Dired.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;dired-mode-hook</span> <span class="ss">&#39;auto-revert-mode</span><span class="p">)</span></code></pre></div></li>

<li><p>Declutter</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/dired-mode-setup</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">dired-hide-details-mode</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;dired-mode-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/dired-mode-setup</span><span class="p">)</span></code></pre></div></li>

<li><p>Copy and Delete</p>

<p>Allow Dired to recursively copy and delete directories. <code>always</code> ensures that no
confirmation dialog comes up, and <code>top</code> does it only once.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">dired-recursive-copies</span> <span class="ss">&#39;always</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">dired-recursive-deletes</span> <span class="ss">&#39;top</span><span class="p">)</span></code></pre></div></li>

<li><p>Speed Sorting</p>

<p>Easily sort based on a lot of options such as name, time, size, and
extension. Use <code>S</code> to use in a Dired buffer.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">dired-quick-sort</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">dired-quick-sort-setup</span><span class="p">))</span></code></pre></div></li>

<li><p>Sudo</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">sudo-edit</span>
  <span class="nb">:commands</span> <span class="nv">sudo-edit</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-c C-x r&#34;</span> <span class="o">.</span> <span class="nv">sudo-edit</span><span class="p">)))</span></code></pre></div></li>
</ul>

<h4 id="ivy">Ivy</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ivy</span>
  <span class="nb">:diminish</span>
  <span class="nb">:demand</span> <span class="no">t</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">ivy-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">flx</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">smex</span>
    <span class="nb">:commands</span> <span class="p">(</span><span class="nv">counsel-M-x</span><span class="p">)</span>
    <span class="nb">:custom</span>
    <span class="p">(</span><span class="nv">smex-save-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;smex&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">smex-history-length</span> <span class="mi">50</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">swiper</span>
    <span class="nb">:commands</span> <span class="p">(</span><span class="nv">swiper</span> <span class="nv">swiper-all</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">counsel</span>
    <span class="nb">:demand</span> <span class="no">t</span>
    <span class="nb">:bind</span>
    <span class="p">([</span><span class="nv">remap</span> <span class="nv">execute-extended-command</span><span class="p">]</span> <span class="o">.</span> <span class="nv">counsel-M-x</span><span class="p">)</span>
    <span class="p">([</span><span class="nv">remap</span> <span class="nv">org-goto</span><span class="p">]</span> <span class="o">.</span> <span class="nv">counsel-org-goto</span><span class="p">)</span>
    <span class="p">([</span><span class="nv">remap</span> <span class="nv">find-file</span><span class="p">]</span> <span class="o">.</span> <span class="nv">counsel-find-file</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;C-s&#34;</span> <span class="o">.</span> <span class="nv">counsel-grep-or-swiper</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">:map</span> <span class="nv">ivy-minibuffer-map</span>
          <span class="p">([</span><span class="nv">remap</span> <span class="nv">hungry-delete-backward</span><span class="p">]</span> <span class="o">.</span> <span class="no">nil</span><span class="p">))</span>
    <span class="nb">:custom</span>
    <span class="p">(</span><span class="nv">counsel-grep-base-command</span>
          <span class="s">&#34;rg -i -M 120 --color auto --line-number %s %s&#34;</span><span class="p">))</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">ivy-re-builders-alist</span>
   <span class="o">&#39;</span><span class="p">((</span><span class="nv">swiper</span> <span class="o">.</span> <span class="nv">ivy--regex-plus</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">ivy-switch-buffer</span> <span class="o">.</span> <span class="nv">ivy--regex-plus</span><span class="p">)</span>
     <span class="p">(</span><span class="no">t</span> <span class="o">.</span> <span class="nv">ivy--regex-fuzzy</span><span class="p">)))</span>
  <span class="p">(</span><span class="nv">ivy-use-virtual-buffers</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-display-style</span> <span class="ss">&#39;fancy</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">ivy-initial-inputs-alist</span> <span class="no">nil</span><span class="p">))</span></code></pre></div>
<p>I want to ignore certain file extensions when searching for a file, so I add
them to the regexp in <code>counsel-find-file-ignore-regexp</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defconst</span> <span class="nv">gm/find-file-ignore-extensions</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;aux&#34;</span> <span class="s">&#34;bbl&#34;</span> <span class="s">&#34;blg&#34;</span> <span class="s">&#34;exe&#34;</span> <span class="s">&#34;log&#34;</span> <span class="s">&#34;meta&#34;</span> <span class="s">&#34;out&#34;</span> <span class="s">&#34;fls&#34;</span> <span class="s">&#34;tdo&#34;</span> <span class="s">&#34;toc&#34;</span>
    <span class="s">&#34;synctex.gz&#34;</span> <span class="s">&#34;fdb_latexmk&#34;</span>
    <span class="s">&#34;desktop&#34;</span> <span class="s">&#34;elc&#34;</span>
    <span class="s">&#34;pyc&#34;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defconst</span> <span class="nv">gm/find-file-ignore-dirs</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;cache/&#34;</span> <span class="s">&#34;auto/&#34;</span> <span class="s">&#34;ltximg/&#34;</span>
    <span class="s">&#34;.git/&#34;</span><span class="p">))</span>

<span class="p">(</span><span class="nb">setq</span> <span class="nv">counsel-find-file-ignore-regexp</span>
      <span class="p">(</span><span class="nv">s-join</span> <span class="s">&#34;\\|&#34;</span> <span class="p">(</span><span class="nf">list</span> <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nv">regexp-opt</span>
                       <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;.&#34;</span> <span class="nv">it</span><span class="p">)</span> <span class="nv">gm/find-file-ignore-extensions</span><span class="p">))</span>
                      <span class="s">&#34;\\&#39;&#34;</span><span class="p">)</span>            <span class="c1">; make sure we only match end of filename</span>
              <span class="p">(</span><span class="nv">regexp-opt</span>
               <span class="nv">gm/find-file-ignore-dirs</span><span class="p">))))</span></code></pre></div>
<p><a href="http://pragmaticemacs.com/page/6/">This post</a> explains the pitfalls of the default behaviour of <code>ivy-yank-word</code> and
how to fix them. Now we can easily search for the word at point using <code>swiper</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="c1">;; version of ivy-yank-word to yank from start of word</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/ivy-yank-whole-word</span> <span class="p">()</span>
  <span class="s">&#34;Pull next word from buffer into search string.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">(</span><span class="nv">amend</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">with-ivy-window</span>
      <span class="c1">;;move to last word boundary</span>
      <span class="p">(</span><span class="nf">re-search-backward</span> <span class="s">&#34;\\b&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">pt</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">le</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">forward-word</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="nv">le</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">pt</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setq</span> <span class="nv">amend</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="nv">pt</span> <span class="p">(</span><span class="nf">point</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="nv">amend</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;  +&#34;</span> <span class="s">&#34; &#34;</span> <span class="nv">amend</span><span class="p">)))))</span>

<span class="c1">;; bind it to M-j</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">ivy-minibuffer-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;M-j&#34;</span><span class="p">)</span> <span class="ss">&#39;bjm/ivy-yank-whole-word</span><span class="p">)</span></code></pre></div>
<h4 id="god-mode">God Mode</h4>

<p>In <code>god-mode</code>, all keypresses are interpreted as if preceded by <code>C-</code> (as in
&ldquo;Control&rdquo;). For example, the sequence <code>2 n x s</code> goes down two lines then saves the
buffer.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">god-mode</span>
 <span class="nb">:commands</span> <span class="p">(</span><span class="nv">god-local-mode</span> <span class="nv">god-mode-all</span><span class="p">))</span></code></pre></div>
<p>Easily enter God Mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">key-chord</span>
  <span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;jk&#34;</span> <span class="ss">&#39;god-mode-all</span><span class="p">))</span></code></pre></div>
<p>Indicate whether we&rsquo;re in God mode with the cursor colour. I&rsquo;ve seen other
people do this by having a bar cursor in &ldquo;insert mode&rdquo; (to borrow some
terminology from Vim) and a block cursor in &ldquo;command mode&rdquo; (in our case, God
Mode).</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/god-mode-indicator</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">(</span><span class="nv">god-local-mode</span>
         <span class="p">(</span><span class="nv">set-cursor-color</span> <span class="s">&#34;#dc322f&#34;</span><span class="p">))</span>
        <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">set-cursor-color</span> <span class="s">&#34;#657b83&#34;</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;god-mode-enabled-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/god-mode-indicator</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;god-mode-disabled-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/god-mode-indicator</span><span class="p">)</span></code></pre></div>
<h4 id="pdf-tools">PDF Tools</h4>

<p>Basic configuration.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">pdf-tools</span>
  <span class="nb">:mode</span> <span class="p">((</span><span class="s">&#34;\\.pdf\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">pdf-view-mode</span><span class="p">))</span>
  <span class="nb">:commands</span> <span class="nv">pdf-view-mode</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">pdf-annot-activate-created-annotations</span> <span class="no">t</span><span class="p">)</span>
  <span class="nb">:diminish</span> <span class="nv">pdf-view-midnight-minor-mode</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">pdf-view-mode-map</span>
              <span class="p">(</span><span class="s">&#34;C-s&#34;</span> <span class="o">.</span> <span class="nv">counsel-grep-or-swiper</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;h&#34;</span> <span class="o">.</span> <span class="nv">pdf-annot-add-highlight-markup-annotation</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="o">.</span> <span class="nv">pdf-annot-add-text-annotation</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;D&#34;</span><span class="o">.</span> <span class="nv">pdf-annot-delete</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="o">.</span> <span class="nv">pdf-view--rotate</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="o">.</span> <span class="nv">pdf-view-next-line-or-next-page</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-n&#34;</span> <span class="o">.</span> <span class="nv">pdf-view-next-page-command</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="o">.</span> <span class="nv">pdf-view-previous-line-or-previous-page</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-p&#34;</span> <span class="o">.</span> <span class="nv">pdf-view-previous-page-command</span><span class="p">))</span>
  <span class="nb">:hook</span>
  <span class="p">(</span><span class="nv">pdf-view-mode</span> <span class="o">.</span> <span class="nv">pdf-view-midnight-minor-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">pdf-view-mode</span> <span class="o">.</span> <span class="nv">pdf-view-fit-width-to-window</span><span class="p">))</span>
<span class="p">(</span><span class="nb">eval-when-compile</span> <span class="p">(</span><span class="nv">pdf-tools-install</span><span class="p">))</span></code></pre></div>
<p>Allow rotation.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">pdf-view--rotate</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">counterclockwise-p</span> <span class="nv">page-p</span><span class="p">)</span>
  <span class="s">&#34;Rotate PDF 90 degrees.  Requires pdftk to work.\n
</span><span class="s">Clockwise rotation is the default; set COUNTERCLOCKWISE-P to
</span><span class="s">non-nil for the other direction.  Rotate the whole document by
</span><span class="s">default; set PAGE-P to non-nil to rotate only the current page.
</span><span class="s">\nWARNING: overwrites the original file, so be careful!&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="c1">;; error out when pdftk is not installed</span>
  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">null</span> <span class="p">(</span><span class="nv">executable-find</span> <span class="s">&#34;pdftk&#34;</span><span class="p">))</span>
      <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Rotation requires pdftk&#34;</span><span class="p">)</span>
    <span class="c1">;; only rotate in pdf-view-mode</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;pdf-view-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">rotate</span> <span class="p">(</span><span class="nb">if</span> <span class="nv">counterclockwise-p</span> <span class="s">&#34;left&#34;</span> <span class="s">&#34;right&#34;</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">file</span>   <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\&#34;%s\&#34;&#34;</span> <span class="p">(</span><span class="nv">pdf-view-buffer-file-name</span><span class="p">)))</span>
             <span class="p">(</span><span class="nv">page</span>   <span class="p">(</span><span class="nv">pdf-view-current-page</span><span class="p">))</span>
             <span class="p">(</span><span class="nv">pages</span>  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nv">not</span> <span class="nv">page-p</span><span class="p">)</span>                        <span class="c1">; whole doc?</span>
                            <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;1-end%s&#34;</span> <span class="nv">rotate</span><span class="p">))</span>
                           <span class="p">((</span><span class="nf">=</span> <span class="nv">page</span> <span class="mi">1</span><span class="p">)</span>                          <span class="c1">; first page?</span>
                            <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%d%s %d-end&#34;</span>
                                    <span class="nv">page</span> <span class="nv">rotate</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">page</span><span class="p">)))</span>
                           <span class="p">((</span><span class="nf">=</span> <span class="nv">page</span> <span class="p">(</span><span class="nv">pdf-info-number-of-pages</span><span class="p">))</span> <span class="c1">; last page?</span>
                            <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;1-%d %d%s&#34;</span>
                                    <span class="p">(</span><span class="nf">1-</span> <span class="nv">page</span><span class="p">)</span> <span class="nv">page</span> <span class="nv">rotate</span><span class="p">))</span>
                           <span class="p">(</span><span class="no">t</span>                                   <span class="c1">; interior page?</span>
                            <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;1-%d %d%s %d-end&#34;</span>
                                    <span class="p">(</span><span class="nf">1-</span> <span class="nv">page</span><span class="p">)</span> <span class="nv">page</span> <span class="nv">rotate</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">page</span><span class="p">))))))</span>
        <span class="c1">;; empty string if it worked</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;&#34;</span> <span class="p">(</span><span class="nv">shell-command-to-string</span>
                         <span class="p">(</span><span class="nf">format</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;pdftk %s cat %s &#34;</span>
                                         <span class="s">&#34;output %s.NEW &#34;</span>
                                         <span class="s">&#34;&amp;&amp; mv %s.NEW %s&#34;</span><span class="p">)</span>
                                 <span class="nv">file</span> <span class="nv">pages</span> <span class="nv">file</span> <span class="nv">file</span> <span class="nv">file</span><span class="p">)))</span>
            <span class="p">(</span><span class="nv">pdf-view-revert-buffer</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Rotation error!&#34;</span><span class="p">))))))</span></code></pre></div>
<h4 id="tex">TeX</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">auctex</span><span class="p">)</span></code></pre></div>
<h4 id="webmode">Webmode</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">web-mode</span>
  <span class="nb">:mode</span> <span class="p">(</span><span class="s">&#34;\\.scss\\&#39;&#34;</span> <span class="o">.</span> <span class="nv">web-mode</span><span class="p">)</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">web-mode-markup-indent-offset</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">web-mode-css-indent-offset</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">web-mode-code-indent-offset</span> <span class="mi">2</span><span class="p">))</span></code></pre></div>
<h4 id="screencast">Screencast</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;gif-screencast</span> <span class="s">&#34;gif-screencast&#34;</span> <span class="s">&#34;Start GIF Screencast&#34;</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;keycast-mode</span> <span class="s">&#34;keycast&#34;</span> <span class="s">&#34;Start </span><span class="ss">`keycast-mode&#39;</span><span class="s">&#34;</span> <span class="no">t</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/begin-screencast</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">gif-screencast</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">keycast-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">keycast-mode</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/end-screencast</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">gif-screencast-stop</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">keycast-mode</span><span class="p">)</span> <span class="p">(</span><span class="nv">keycast-mode</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;&lt;f8&gt;&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/begin-screencast</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;&lt;f9&gt;&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/end-screencast</span><span class="p">)</span></code></pre></div>
<h4 id="hydra">Hydra</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">hydra</span>
  <span class="nb">:defer</span> <span class="mi">3</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-flycheck</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
    <span class="s">&#34;
</span><span class="s">    ^
</span><span class="s">    ^Flycheck^          ^Errors^            ^Checker^
</span><span class="s">    ^────────^──────────^──────^────────────^───────^─────
</span><span class="s">    _q_ quit            _&lt;_ previous        _?_ describe
</span><span class="s">    _M_ manual          _&gt;_ next            _d_ disable
</span><span class="s">    _v_ verify setup    _f_ check           _m_ mode
</span><span class="s">    ^^                  _l_ list            _s_ select
</span><span class="s">    ^^                  ^^                  ^^
</span><span class="s">    &#34;</span>
    <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;&lt;&#34;</span> <span class="nv">flycheck-previous-error</span> <span class="nb">:color</span> <span class="nv">pink</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;&gt;&#34;</span> <span class="nv">flycheck-next-error</span> <span class="nb">:color</span> <span class="nv">pink</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;?&#34;</span> <span class="nv">flycheck-describe-checker</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;M&#34;</span> <span class="nv">flycheck-manual</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="nv">flycheck-disable-checker</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="nv">flycheck-buffer</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="nv">flycheck-list-errors</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="nv">flycheck-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="nv">flycheck-select-checker</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;v&#34;</span> <span class="nv">flycheck-verify-setup</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c f&#34;</span> <span class="nf">#&#39;</span><span class="nv">hydra-flycheck/body</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">gm/elfeed-hydra</span> <span class="p">()</span>
    <span class="s">&#34;filter&#34;</span>
    <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago&#34;</span><span class="p">)</span> <span class="s">&#34;All&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;c&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +cs&#34;</span><span class="p">)</span> <span class="s">&#34;CS&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +emacs&#34;</span><span class="p">)</span> <span class="s">&#34;Emacs&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;*&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +starred&#34;</span><span class="p">)</span> <span class="s">&#34;Starred&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@1-day-ago&#34;</span><span class="p">)</span> <span class="s">&#34;Today&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;M&#34;</span> <span class="nv">gm/elfeed-toggle-star</span> <span class="s">&#34;Mark&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;Q&#34;</span> <span class="nv">bjm/elfeed-save-db-and-bury</span> <span class="s">&#34;Quit Elfeed&#34;</span> <span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="no">nil</span> <span class="s">&#34;quit&#34;</span> <span class="nb">:color</span> <span class="nv">blue</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-semicolon-a</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:idle</span> <span class="mf">1.0</span> <span class="nb">:columns</span> <span class="mi">8</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;;&#34;</span> <span class="nv">hydra-semicolon-b/body</span> <span class="s">&#34;Level 2&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;SPC&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;; &#34;</span><span class="p">)</span> <span class="s">&#34;;&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\alpha&#34;</span><span class="p">)</span> <span class="s">&#34;α&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\forall &#34;</span><span class="p">)</span> <span class="s">&#34;∀&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\beta&#34;</span><span class="p">)</span> <span class="s">&#34;β&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;C&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{C}&#34;</span><span class="p">)</span> <span class="s">&#34;ℂ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\delta&#34;</span><span class="p">)</span> <span class="s">&#34;δ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;D&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Delta&#34;</span><span class="p">)</span> <span class="s">&#34;Δ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\epsilon&#34;</span><span class="p">)</span> <span class="s">&#34;ε&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;E&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\exists &#34;</span><span class="p">)</span> <span class="s">&#34;∃&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varphi&#34;</span><span class="p">)</span> <span class="s">&#34;φ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;F&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Phi&#34;</span><span class="p">)</span> <span class="s">&#34;Φ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\gamma&#34;</span><span class="p">)</span> <span class="s">&#34;γ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;G&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Gamma&#34;</span><span class="p">)</span> <span class="s">&#34;Γ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;h&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\eta&#34;</span><span class="p">)</span> <span class="s">&#34;η&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\kappa&#34;</span><span class="p">)</span> <span class="s">&#34;κ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\lambda&#34;</span><span class="p">)</span> <span class="s">&#34;λ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;L&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Lambda&#34;</span><span class="p">)</span> <span class="s">&#34;Λ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mu&#34;</span><span class="p">)</span> <span class="s">&#34;µ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\nu&#34;</span><span class="p">)</span> <span class="s">&#34;ν&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;N&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\nabla &#34;</span><span class="p">)</span> <span class="s">&#34;∇&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;o&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\omega&#34;</span><span class="p">)</span> <span class="s">&#34;ω&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;O&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Omega&#34;</span><span class="p">)</span> <span class="s">&#34;Ω&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\pi&#34;</span><span class="p">)</span> <span class="s">&#34;π&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;P&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Pi&#34;</span><span class="p">)</span> <span class="s">&#34;Π&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\theta&#34;</span><span class="p">)</span> <span class="s">&#34;θ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;Q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{Q}&#34;</span><span class="p">)</span> <span class="s">&#34;ℚ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\rho&#34;</span><span class="p">)</span> <span class="s">&#34;ρ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;R&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{R}&#34;</span><span class="p">)</span> <span class="s">&#34;ℝ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\sigma&#34;</span><span class="p">)</span> <span class="s">&#34;σ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\tau&#34;</span><span class="p">)</span> <span class="s">&#34;τ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\upsilon&#34;</span><span class="p">)</span> <span class="s">&#34;υ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;U&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cup &#34;</span><span class="p">)</span> <span class="s">&#34;∪&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;v&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\vec &#34;</span><span class="p">)</span> <span class="s">&#34;v&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;w&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\xi&#34;</span><span class="p">)</span> <span class="s">&#34;ξ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;W&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Xi&#34;</span><span class="p">)</span> <span class="s">&#34;Ξ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;x&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\chi&#34;</span><span class="p">)</span> <span class="s">&#34;χ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;y&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\psi&#34;</span><span class="p">)</span> <span class="s">&#34;ψ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;Y&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Psi&#34;</span><span class="p">)</span> <span class="s">&#34;Ψ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;z&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\zeta&#34;</span><span class="p">)</span> <span class="s">&#34;ζ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;Z&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{Z}&#34;</span><span class="p">)</span> <span class="s">&#34;ℤ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;0&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\emptyset&#34;</span><span class="p">)</span> <span class="s">&#34;∅&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;8&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\infinity&#34;</span><span class="p">)</span> <span class="s">&#34;∞&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;!&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\neg&#34;</span><span class="p">)</span> <span class="s">&#34;¬&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;*&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\star&#34;</span><span class="p">)</span> <span class="s">&#34;⋆&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;\\&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\setminus &#34;</span><span class="p">)</span> <span class="s">&#34;∖&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;&#39;&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\prime &#34;</span><span class="p">)</span> <span class="s">&#34;′&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;,&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;,\\ldots,&#34;</span><span class="p">)</span> <span class="s">&#34;.&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cdot &#34;</span><span class="p">)</span> <span class="s">&#34;·&#34;</span><span class="p">))</span>

  <span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-semicolon-b</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:idle</span> <span class="mf">1.0</span> <span class="nb">:columns</span> <span class="mi">8</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;;&#34;</span> <span class="nv">hydra-semicolon-a/body</span> <span class="s">&#34;base&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34; &#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;; &#34;</span> <span class="s">&#34;semicolon&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\aleph&#34;</span><span class="p">)</span> <span class="s">&#34;ℵ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varepsilon&#34;</span><span class="p">)</span> <span class="s">&#34;ε&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\phi&#34;</span><span class="p">)</span> <span class="s">&#34;φ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;F&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{F}&#34;</span><span class="p">)</span> <span class="s">&#34;𝔽&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\ell&#34;</span><span class="p">)</span> <span class="s">&#34;ℓ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Theta&#34;</span><span class="p">)</span> <span class="s">&#34;Θ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varrho&#34;</span><span class="p">)</span> <span class="s">&#34;ρ&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;U&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\cap &#34;</span><span class="p">)</span> <span class="s">&#34;∩&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;x&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\times &#34;</span><span class="p">)</span> <span class="s">&#34;×&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cdots &#34;</span><span class="p">)</span> <span class="s">&#34;···&#34;</span><span class="p">)))</span></code></pre></div>
<h4 id="window-management">Window Management</h4>

<p>I don&rsquo;t like the default Emacs functionality of splitting windows but not
switching to the new window. I find myself pressing <code>M-3 C-x 0</code> pretty much every
time I split the window.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/split-window-below-and-switch</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">split-window-below</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/split-window-right-and-switch</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">split-window-right</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">other-window</span> <span class="mi">1</span><span class="p">))</span></code></pre></div>
<p>To manage my windows. I use <code>ace-window</code>. The nice thing about this is that when
you use the equivalent of <code>other-window</code>, you don&rsquo;t have to remember which window
the &ldquo;other one&rdquo; is. Instead, you select the window with a number.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">ace-window</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">ace-window</span>
             <span class="nv">delete-window</span>
             <span class="nv">delete-other-windows</span>
             <span class="nv">gm/split-window-right-and-switch</span>
             <span class="nv">gm/split-window-below-and-switch</span><span class="p">)</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;C-x o&#34;</span> <span class="o">.</span> <span class="nv">ace-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;M-o&#34;</span> <span class="o">.</span> <span class="nv">ace-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;C-x 0&#34;</span> <span class="o">.</span> <span class="nv">delete-window</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;M-1&#34;</span> <span class="o">.</span> <span class="nv">delete-other-windows</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;M-3&#34;</span> <span class="o">.</span> <span class="nv">gm/split-window-right-and-switch</span><span class="p">)</span>
         <span class="p">(</span><span class="s">&#34;M-4&#34;</span> <span class="o">.</span> <span class="nv">gm/split-window-below-and-switch</span><span class="p">)))</span></code></pre></div>
<h4 id="avy">Avy</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">avy</span>
  <span class="nb">:ensure</span> <span class="no">t</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;M-g&#34;</span> <span class="o">.</span> <span class="nv">avy-goto-word-1</span><span class="p">)))</span></code></pre></div>
<h4 id="company">Company</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">company</span><span class="p">)</span></code></pre></div>
<h4 id="which-key-mode">Which Key Mode</h4>

<p>Helpful when you want to see completion for a certain sequence of prefix keys.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">which-key</span>
  <span class="nb">:defer</span> <span class="mi">10</span>
  <span class="nb">:diminish</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">which-key-mode</span><span class="p">))</span></code></pre></div>
<h4 id="projectile">Projectile</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">projectile</span><span class="p">)</span></code></pre></div>
<h2 id="keybindings"><span class="section-num">3</span> Keybindings</h2>

<h3 id="better-defaults-1">Better Defaults</h3>

<p>These are what I think are better bindings for or better versions of the default
commands.</p>

<h4 id="easy-m-x">Easy M-x</h4>

<p>Alt is simply too hard to hit for such a commonly used command.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-SPC&#34;</span> <span class="nf">#&#39;</span><span class="nv">execute-extended-command</span><span class="p">)</span></code></pre></div>
<h4 id="set-mark">Set Mark</h4>

<p>Need a replacement because we rebound <code>C-SPC</code> above. And I know, I know, everyone
loves <code>transpose-chars</code>, but I don&rsquo;t see myself using it that much.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-t&#34;</span> <span class="ss">&#39;set-mark-command</span><span class="p">)</span></code></pre></div>
<h4 id="shell-kill-word">Shell Kill Word</h4>

<p>Use the standard Unix shell binding for deleting the previous word. As a result,
it&rsquo;s fine to remove the default Emacs bindings for this. In fact,
<code>C-&lt;backspace&gt;</code> in particular can get in the way.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-w&#34;</span> <span class="ss">&#39;backward-kill-word</span><span class="p">)</span>
<span class="p">(</span><span class="nv">unbind-key</span> <span class="s">&#34;C-&lt;backspace&gt;&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">unbind-key</span> <span class="s">&#34;M-DEL&#34;</span><span class="p">)</span></code></pre></div>
<h4 id="kill-paragraph">Kill Paragraph</h4>

<p>This binding takes after the default <code>M-k</code> binding for <code>kill-sentence</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-K&#34;</span> <span class="nf">#&#39;</span><span class="nv">kill-paragraph</span><span class="p">)</span></code></pre></div>
<h4 id="browse-kill-ring">Browse Kill Ring</h4>

<p>This used to be a feature of Emacs.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">browse-kill-ring</span>
  <span class="nb">:commands</span> <span class="nv">browse-kill-ring</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="s">&#34;M-y&#34;</span> <span class="o">.</span> <span class="nv">browse-kill-ring</span><span class="p">)</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">browse-kill-ring-default-keybindings</span><span class="p">))</span></code></pre></div>
<h4 id="unfill-paragraph">Unfill Paragraph</h4>

<p>I used to <code>[remap fill-paragraph]</code> to <code>gm/fill-unfill</code>, a function that used the
<code>unfill</code> package to toggle the paragraph from filled to unfilled with a single
key. It turned out this was not best for my use case, as I usually double-tapped
<code>M-q</code> because I just wanted to refill the paragraph. However, unfilling is
sometimes useful, so I kept the package around.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">unfill</span>
  <span class="nb">:commands</span> <span class="nv">unfill-paragraph</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="s">&#34;M-Q&#34;</span> <span class="o">.</span> <span class="nv">unfill-paragraph</span><span class="p">))</span></code></pre></div>
<h4 id="join-line">Join Line</h4>

<p>This allows me to combine text over multiple lines into one line.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-j&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">(</span><span class="nv">join-line</span> <span class="mi">-1</span><span class="p">)))</span></code></pre></div>
<h4 id="normal-undo-binding">Normal Undo Binding</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-z&#34;</span> <span class="ss">&#39;undo</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x C-u&#34;</span> <span class="ss">&#39;undo</span><span class="p">)</span></code></pre></div>
<h4 id="better-narrowing">Better Narrowing</h4>

<p>From <a href="http://endlessparentheses.com/emacs-narrow-or-widen-dwim.html">Emacs narrow-or-widen-dwim</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">narrow-or-widen-dwim</span> <span class="p">(</span><span class="nv">p</span><span class="p">)</span>
  <span class="s">&#34;Widen if buffer is narrowed, narrow-dwim otherwise.
</span><span class="s">Dwim means: region, org-src-block, org-subtree, or
</span><span class="s">defun, whichever applies first. Narrowing to
</span><span class="s">org-src-block actually calls </span><span class="ss">`org-edit-src-code&#39;</span><span class="s">.
</span><span class="s">
</span><span class="s">With prefix P, don&#39;t widen, just narrow even if buffer
</span><span class="s">is already narrowed.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">declare</span> <span class="p">(</span><span class="nv">interactive-only</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nv">buffer-narrowed-p</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="nv">p</span><span class="p">))</span> <span class="p">(</span><span class="nf">widen</span><span class="p">))</span>
        <span class="p">((</span><span class="nv">region-active-p</span><span class="p">)</span>
         <span class="p">(</span><span class="nf">narrow-to-region</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span>
                           <span class="p">(</span><span class="nf">region-end</span><span class="p">)))</span>
        <span class="p">((</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;org-mode</span><span class="p">)</span>
         <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">org-edit-src-code</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
                <span class="p">(</span><span class="nv">delete-other-windows</span><span class="p">))</span>
               <span class="p">((</span><span class="nb">ignore-errors</span> <span class="p">(</span><span class="nv">org-narrow-to-block</span><span class="p">)</span> <span class="no">t</span><span class="p">))</span>
               <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">org-narrow-to-subtree</span><span class="p">))))</span>
        <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">narrow-to-defun</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;n&#34;</span> <span class="nf">#&#39;</span><span class="nv">narrow-or-widen-dwim</span> <span class="nv">ctl-x-map</span><span class="p">)</span></code></pre></div>
<p>Then we can use <code>narrow-or-widen-dwim</code> to easily edit org <code>src</code> blocks.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">org-src</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x C-s&#34;</span> <span class="nf">#&#39;</span><span class="nv">org-edit-src-exit</span> <span class="nv">org-src-mode-map</span><span class="p">))</span></code></pre></div>
<h4 id="delete-better">Delete Better</h4>

<p>When using <code>C-d</code> or <code>Backspace</code>, delete all white space in a certain direction, and
not just one.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">hungry-delete</span>
  <span class="nb">:commands</span> <span class="nv">hungry-delete-mode</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">text-mode</span> <span class="o">.</span> <span class="nv">hungry-delete-mode</span><span class="p">))</span></code></pre></div>
<h4 id="better-buffers">Better Buffers</h4>

<p>Kill better.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/kill-this-buffer</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">kill-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x k&#34;</span> <span class="ss">&#39;bjm/kill-this-buffer</span><span class="p">)</span></code></pre></div>
<p>Exterminate better.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">delete-current-buffer-file</span> <span class="p">()</span>
  <span class="s">&#34;Removes file connected to current buffer and kills buffer.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">filename</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">filename</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">filename</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">buffer</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">yes-or-no-p</span> <span class="s">&#34;Are you sure you want to remove this file? &#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">delete-file</span> <span class="nv">filename</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">kill-buffer</span> <span class="nv">buffer</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;File &#39;%s&#39; successfully removed&#34;</span> <span class="nv">filename</span><span class="p">)))))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x C-k&#34;</span> <span class="nf">#&#39;</span><span class="nv">delete-current-buffer-file</span><span class="p">)</span></code></pre></div>
<p>Rename better (from Magnar Sveen).</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">rename-current-buffer-file</span> <span class="p">()</span>
  <span class="s">&#34;Renames current buffer and file it is visiting.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">name</span> <span class="p">(</span><span class="nf">buffer-name</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">filename</span> <span class="p">(</span><span class="nf">buffer-file-name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">filename</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">filename</span><span class="p">)))</span>
        <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;Buffer &#39;%s&#39; is not visiting a file.&#34;</span> <span class="nv">name</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">new-name</span> <span class="p">(</span><span class="nv">read-file-name</span> <span class="s">&#34;New name: &#34;</span> <span class="nv">filename</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">get-buffer</span> <span class="nv">new-name</span><span class="p">)</span>
            <span class="p">(</span><span class="ne">error</span> <span class="s">&#34;A buffer named &#39;%s&#39; already exists!&#34;</span> <span class="nv">new-name</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">rename-file</span> <span class="nv">filename</span> <span class="nv">new-name</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">rename-buffer</span> <span class="nv">new-name</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">set-visited-file-name</span> <span class="nv">new-name</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">set-buffer-modified-p</span> <span class="no">nil</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;File &#39;%s&#39; successfully renamed to &#39;%s&#39;&#34;</span>
                   <span class="nv">name</span> <span class="p">(</span><span class="nf">file-name-nondirectory</span> <span class="nv">new-name</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x C-r&#34;</span> <span class="nf">#&#39;</span><span class="nv">rename-current-buffer-file</span><span class="p">)</span></code></pre></div>
<p>Switch better.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="p">[</span><span class="nv">remap</span> <span class="nv">switch-buffer</span><span class="p">]</span> <span class="nf">#&#39;</span><span class="nv">ivy-switch-buffer</span><span class="p">)</span></code></pre></div>
<p>Use <code>ibuffer</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;ibuffer</span> <span class="s">&#34;ibuffer&#34;</span> <span class="s">&#34;List buffers.&#34;</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x C-b&#34;</span> <span class="ss">&#39;ibuffer</span><span class="p">)</span></code></pre></div>
<h4 id="unbind-fill-column">Unbind Fill Column</h4>

<p>I never use this command but keep accidentally hitting it instead of <code>C-x C-f</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">unbind-key</span> <span class="s">&#34;C-x f&#34;</span><span class="p">)</span></code></pre></div>
<h4 id="delete-frame">Delete Frame</h4>

<p>The default <code>C-x 5 0</code> is too clunky for this.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-x w&#34;</span> <span class="nf">#&#39;delete-frame</span><span class="p">)</span></code></pre></div>
<h4 id="comment-dwim">Comment Dwim</h4>

<p>Pretty straightforward. A better version of the built-in <code>comment-dwim</code> from
<a href="https://github.com/remyferre/comment-dwim-2">remyferre/comment-dwim-2</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">comment-dwim-2</span>
  <span class="nb">:commands</span> <span class="nv">comment-dwim-2</span>
  <span class="nb">:bind</span> <span class="p">((</span><span class="s">&#34;M-;&#34;</span> <span class="o">.</span> <span class="nv">comment-dwim-2</span><span class="p">)))</span></code></pre></div>
<h3 id="open-shell">Open Shell</h3>

<p>I have started to use <code>eshell</code> as my primary shell. However, I sometimes want to
use my default <code>zsh</code> shell, which I access with <code>deepin-terminal</code> as a frontend.
This command ensures that <code>eshell</code> is opened next to, not instead of, my current
buffer.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">eshell-other-window</span> <span class="p">()</span>
  <span class="s">&#34;Open a </span><span class="ss">`eshell&#39;</span><span class="s"> in a new window.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">buf</span> <span class="p">(</span><span class="nv">eshell</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">switch-to-buffer</span> <span class="p">(</span><span class="nf">other-buffer</span> <span class="nv">buf</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">switch-to-buffer-other-window</span> <span class="nv">buf</span><span class="p">)))</span></code></pre></div>
<p>I rebind the redundant help binding (there is already a more convenient prefix
map at <code>C-h</code>). I would use <code>C-M-t</code> to open a normal terminal, rebinding the Ubuntu
default, but I&rsquo;m not sure how to make this Emacs command override the system
default.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;&lt;f1&gt;&#34;</span> <span class="nf">#&#39;</span><span class="nv">eshell-other-window</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-M-s&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">(</span><span class="nv">shell-command</span> <span class="s">&#34;deepin-terminal&#34;</span><span class="p">)))</span></code></pre></div>
<h3 id="find-inbox">Find Inbox</h3>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c o&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">(</span><span class="nv">find-file</span> <span class="s">&#34;~/org/inbox.org&#34;</span><span class="p">)))</span></code></pre></div>
<h3 id="keychord">Keychord</h3>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;key-chord</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-mode</span> <span class="mi">1</span><span class="p">)</span></code></pre></div>
<h4 id="number-symbols">Number Symbols</h4>

<p>Eliminate the shift key for inputting symbols. The dollar sign ($) keychord is
especially useful when typing LaTeX.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;1q&#34;</span> <span class="s">&#34;!&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;2w&#34;</span> <span class="s">&#34;@&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;3e&#34;</span> <span class="s">&#34;#&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;4r&#34;</span> <span class="s">&#34;$&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;5t&#34;</span> <span class="s">&#34;%&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;6y&#34;</span> <span class="s">&#34;^&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;6t&#34;</span> <span class="s">&#34;^&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;7y&#34;</span> <span class="s">&#34;&amp;&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;8u&#34;</span> <span class="s">&#34;*&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;9i&#34;</span> <span class="s">&#34;(&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;0o&#34;</span> <span class="s">&#34;)&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">key-chord-define-global</span> <span class="s">&#34;-p&#34;</span> <span class="s">&#34;_&#34;</span><span class="p">)</span></code></pre></div>
<h2 id="org-mode"><span class="section-num">4</span> Org Mode</h2>

<p>We have to require the entire <code>org.el</code> file to get <code>ox-hugo</code> to work properly.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org</span>
  <span class="nb">:init</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ox-latex</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ox-hugo</span><span class="p">)</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">org-mode-map</span>
              <span class="p">(</span><span class="s">&#34;C-c k&#34;</span> <span class="o">.</span> <span class="nv">endless/insert-key</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;M-n&#34;</span> <span class="o">.</span> <span class="nv">forward-paragraph</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;M-p&#34;</span> <span class="o">.</span> <span class="nv">backward-paragraph</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;RET&#34;</span> <span class="o">.</span> <span class="nf">#&#39;</span><span class="nv">gm/org-return</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-c c&#34;</span> <span class="o">.</span> <span class="nv">org-capture</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-c a&#34;</span> <span class="o">.</span> <span class="nv">org-agenda</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-c l&#34;</span> <span class="o">.</span> <span class="nv">org-store-link</span><span class="p">)</span>
              <span class="p">(</span><span class="s">&#34;C-c b&#34;</span> <span class="o">.</span> <span class="nv">gm/org-latex-export</span><span class="p">))</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-k&#34;</span> <span class="nf">#&#39;</span><span class="nv">xah-cut-line-or-region</span> <span class="nv">org-mode-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-return</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">ignore</span><span class="p">)</span>
    <span class="s">&#34;Add new list item, heading or table row with RET.
</span><span class="s">  A double return on an empty element deletes it.
</span><span class="s">  Use a prefix arg to get regular RET. &#34;</span>
    <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">if</span> <span class="nv">ignore</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cond</span>
       <span class="p">((</span><span class="nf">eq</span> <span class="ss">&#39;link</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">))</span>
       <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nv">org-in-item-p</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:contents-begin</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">org-insert-item</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nf">buffer-substring</span>
                 <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-return</span><span class="p">)))</span>
       <span class="p">((</span><span class="nv">org-at-heading-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">))</span>
       <span class="p">((</span><span class="nv">org-at-table-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">-any?</span>
             <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;&#34;</span> <span class="nv">x</span><span class="p">)))</span>
             <span class="p">(</span><span class="nf">nth</span>
              <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nv">org-table-current-dline</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">org-table-to-lisp</span><span class="p">)))</span>
            <span class="p">(</span><span class="nv">org-return</span><span class="p">)</span>
          <span class="c1">;; empty row</span>
          <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nf">buffer-substring</span>
                 <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-return</span><span class="p">)))</span>
       <span class="p">((</span><span class="nv">org-in-src-block-p</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">newline-and-indent</span><span class="p">))</span>
       <span class="p">(</span><span class="no">t</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-directory</span> <span class="s">&#34;~/org/&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-default-notes-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;inbox.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
        <span class="nv">org-agenda-files</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;inbox.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                           <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;todo.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                           <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;notes.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                           <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gcal.org&#34;</span> <span class="nv">org-directory</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-targets</span> <span class="o">`</span><span class="p">((</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;todo.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>
                             <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;notes.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-protocol</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-protocol-capture-html</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/square-to-round-brackets</span> <span class="p">(</span><span class="nv">string-to-transform</span><span class="p">)</span>
    <span class="s">&#34;Transforms [ into ( and ] into ), other chars left unchanged.&#34;</span>
    <span class="p">(</span><span class="nf">concat</span>
    <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">it</span> <span class="sc">?[</span><span class="p">)</span> <span class="sc">?\(</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">it</span> <span class="sc">?]</span><span class="p">)</span> <span class="sc">?\)</span> <span class="nv">it</span><span class="p">))</span>
     <span class="nv">string-to-transform</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-capture-templates</span>
        <span class="o">`</span><span class="p">((</span><span class="s">&#34;a&#34;</span> <span class="s">&#34;Appointment&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gcal.org&#34;</span> <span class="nv">org-directory</span><span class="p">))</span>
           <span class="s">&#34;* %i%? \n%^T\n&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="s">&#34;Todo&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
           <span class="s">&#34;* TODO %^{Title}\n:PROPERTIES:\n:CREATED: %U\n:END:\n%i%?&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;Note&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
           <span class="s">&#34;* %^{Title}\n:PROPERTIES:\n:CREATED: %U\n:END:\n%i%?&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="s">&#34;Journal&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file+olp+datetree</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;journal.org&#34;</span> <span class="nv">org-directory</span><span class="p">))</span>
           <span class="s">&#34;** %^{Heading}\n:PROPERTIES:\n:CREATED: %U\n:END:&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="s">&#34;euler&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file+headline</span> <span class="s">&#34;~/website/content-org/blog.org&#34;</span> <span class="s">&#34;Euler&#34;</span><span class="p">)</span>
           <span class="s">&#34;** Project Euler %^{Problem Number}: %^{Problem Name} %^g
</span><span class="s">  :PROPERTIES:
</span><span class="s">  :EXPORT_FILE_NAME: %\\1
</span><span class="s">  :EXPORT_DATE: %u
</span><span class="s">  :EXPORT_DESCRIPTION: My solution to problem %\\1 of Project Euler.
</span><span class="s">  :END:\n*** Problem Statement\n%?\n*** My Algorithm&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="s">&#34;Org Protocol&#34;</span> <span class="nv">entry</span>
           <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
           <span class="s">&#34;* [[%:link][%(gm/square-to-round-brackets \&#34;%:description\&#34;)]]\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?\n%(gm/quote-if-non-empty \&#34;%i\&#34;)&#34;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keywords</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="nv">sequence</span> <span class="s">&#34;TODO(t)&#34;</span> <span class="s">&#34;WAITING(w)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d)&#34;</span> <span class="s">&#34;CANCELLED(c)&#34;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-state-tags-triggers</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;CANCELLED&#34;</span> <span class="p">(</span><span class="s">&#34;ARCHIVE&#34;</span> <span class="o">.</span> <span class="no">t</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">myorg-update-parent-cookie</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">major-mode</span> <span class="ss">&#39;org-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">save-excursion</span>
        <span class="p">(</span><span class="nb">ignore-errors</span>
          <span class="p">(</span><span class="nv">org-back-to-heading</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-update-parent-todo-statistics</span><span class="p">)))))</span>

  <span class="p">(</span><span class="nb">defadvice</span> <span class="nv">org-archive-subtree</span> <span class="p">(</span><span class="nv">after</span> <span class="nv">fix-cookies</span> <span class="nv">activate</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">myorg-update-parent-cookie</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-return-follows-link</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-cliplink</span>
    <span class="nb">:commands</span> <span class="nv">org-cliplink</span>
    <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="s">&#34;C-c y&#34;</span> <span class="o">.</span> <span class="nv">org-cliplink</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-wc</span>
    <span class="nb">:commands</span> <span class="nv">org-wc-display</span>
    <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="s">&#34;C-c w&#34;</span> <span class="o">.</span> <span class="nv">gm/wc-display-current-subtree</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-bullets</span>
      <span class="nb">:commands</span> <span class="nv">org-bullets-mode</span>
      <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">org-bullets-mode</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-hide-emphasis-markers</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="ss">&#39;org-mode</span>
                          <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;^ *\\([-]\\) &#34;</span>
                             <span class="p">(</span><span class="mi">0</span> <span class="p">(</span><span class="nb">prog1</span> <span class="p">()</span> <span class="p">(</span><span class="nv">compose-region</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&#34;•&#34;</span><span class="p">))))))</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">org-src-font-lock-fontify-block</span> <span class="p">(</span><span class="nv">lang</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span>
    <span class="s">&#34;Fontify code block.
</span><span class="s">  This function is called by emacs automatic fontification, as long
</span><span class="s">  as </span><span class="ss">`org-src-fontify-natively&#39;</span><span class="s"> is non-nil.&#34;</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">lang-mode</span> <span class="p">(</span><span class="nv">org-src--get-lang-mode</span> <span class="nv">lang</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="nv">lang-mode</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nf">string</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">modified</span> <span class="p">(</span><span class="nf">buffer-modified-p</span><span class="p">))</span> <span class="p">(</span><span class="nv">org-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">remove-text-properties</span> <span class="nv">start</span> <span class="nv">end</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="no">nil</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">with-current-buffer</span>
          <span class="p">(</span><span class="nf">get-buffer-create</span>
           <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34; org-src-fontification:&#34;</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="nv">lang-mode</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">delete-region</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">insert</span> <span class="nf">string</span> <span class="s">&#34; &#34;</span><span class="p">)</span> <span class="c1">;; so there&#39;s a final property change</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="nv">lang-mode</span><span class="p">)</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">lang-mode</span><span class="p">))</span>
        <span class="c1">;; Avoid `font-lock-ensure&#39;, which does not display fonts in</span>
        <span class="c1">;; source block.</span>
        <span class="p">(</span><span class="nf">call-interactively</span> <span class="nf">#&#39;</span><span class="nv">font-lock-fontify-buffer</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nf">next-single-property-change</span> <span class="nv">pos</span> <span class="ss">&#39;face</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">put-text-property</span>
           <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="nv">next</span><span class="p">))</span> <span class="ss">&#39;face</span>
           <span class="p">(</span><span class="nf">get-text-property</span> <span class="nv">pos</span> <span class="ss">&#39;face</span><span class="p">)</span> <span class="nv">org-buffer</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">))</span>
        <span class="c1">;; Addition: also copy &#39;composition info for prettified symbols</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nf">next-single-property-change</span> <span class="nv">pos</span> <span class="ss">&#39;composition</span><span class="p">))</span>
          <span class="p">(</span><span class="nf">put-text-property</span>
           <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="nv">next</span><span class="p">))</span> <span class="ss">&#39;composition</span>
           <span class="p">(</span><span class="nf">get-text-property</span> <span class="nv">pos</span> <span class="ss">&#39;composition</span><span class="p">)</span> <span class="nv">org-buffer</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">))</span>
        <span class="c1">;; End addition</span>
        <span class="p">)</span>
      <span class="p">(</span><span class="nf">add-text-properties</span>
       <span class="nv">start</span> <span class="nv">end</span>
       <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-fontified</span> <span class="no">t</span> <span class="nv">fontified</span> <span class="no">t</span> <span class="nv">font-lock-multiline</span> <span class="no">t</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">set-buffer-modified-p</span> <span class="nv">modified</span><span class="p">)))))</span>
  <span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
        <span class="ss">&#39;org-babel-load-languages</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">python</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nv">latex</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
                                    <span class="p">(</span><span class="nv">shell</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))</span>

  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-babel-python-command</span> <span class="s">&#34;python3.6&#34;</span>
        <span class="nv">org-babel-latex-command</span> <span class="s">&#34;pdflatex&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-src-fontify-natively</span> <span class="no">t</span>
        <span class="nv">org-src-tab-acts-natively</span> <span class="no">t</span>
        <span class="nv">org-edit-src-content-indentation</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-highlight-latex-and-related</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">latex</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-format-latex-options</span> <span class="p">(</span><span class="nf">plist-put</span> <span class="nv">org-format-latex-options</span> <span class="nb">:scale</span> <span class="mf">2.75</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-preview-latex-image-directory</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;cache/ltximg/&#34;</span>
                                                            <span class="nv">gmacs-emacs-dir</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-export-with-smart-quotes</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-packages-alist</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;&#34;</span> <span class="s">&#34;gm-math&#34;</span> <span class="no">t</span><span class="p">))))</span></code></pre></div>
<h3 id="configuration">Configuration</h3>

<p>A better return for Org mode. If in a list, we want to add a new item.
If we&rsquo;re in a heading, we want to go the end of the line, then return. This is
because I never want to split the heading in half. If we&rsquo;re in a table, we add a
new row. If we are in a source block, we want to indent. Inspired by <a href="http://kitchingroup.cheme.cmu.edu/blog/2017/04/09/A-better-return-in-org-mode/">John Kitchin</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-return</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">ignore</span><span class="p">)</span>
  <span class="s">&#34;Add new list item, heading or table row with RET.
</span><span class="s">A double return on an empty element deletes it.
</span><span class="s">Use a prefix arg to get regular RET. &#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">ignore</span>
      <span class="p">(</span><span class="nv">org-return</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">cond</span>
     <span class="p">((</span><span class="nf">eq</span> <span class="ss">&#39;link</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">)))</span>
      <span class="p">(</span><span class="nv">org-return</span><span class="p">))</span>
     <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nv">org-in-item-p</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:contents-begin</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">))</span>
          <span class="p">(</span><span class="nv">org-insert-item</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nf">buffer-substring</span>
               <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">)))</span>
     <span class="p">((</span><span class="nv">org-at-heading-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">org-return</span><span class="p">))</span>
     <span class="p">((</span><span class="nv">org-at-table-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">-any?</span>
           <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;&#34;</span> <span class="nv">x</span><span class="p">)))</span>
           <span class="p">(</span><span class="nf">nth</span>
            <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nv">org-table-current-dline</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">org-table-to-lisp</span><span class="p">)))</span>
          <span class="p">(</span><span class="nv">org-return</span><span class="p">)</span>
        <span class="c1">;; empty row</span>
        <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nf">buffer-substring</span>
               <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span> <span class="s">&#34;&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-return</span><span class="p">)))</span>
     <span class="p">((</span><span class="nv">org-in-src-block-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">newline-and-indent</span><span class="p">))</span>
     <span class="p">(</span><span class="no">t</span>
      <span class="p">(</span><span class="nv">org-return</span><span class="p">)))))</span></code></pre></div>
<p>We replace the normal return.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;RET&#34;</span> <span class="o">.</span> <span class="nf">#&#39;</span><span class="nv">gm/org-return</span><span class="p">)</span></code></pre></div>
<h3 id="utilities-1">Utilities</h3>

<h4 id="file-locations">File Locations</h4>

<p>We need a place where Org files go by default. Org Mode uses this to, for
example, decide where to put the result of an Org Capture.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-directory</span> <span class="s">&#34;~/org/&#34;</span><span class="p">)</span></code></pre></div>
<p>We similarly decide other default locations.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-default-notes-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;inbox.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
      <span class="nv">org-agenda-files</span> <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;inbox.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                         <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;todo.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                         <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;notes.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span>
                         <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gcal.org&#34;</span> <span class="nv">org-directory</span><span class="p">)))</span></code></pre></div>
<p>Keeping my refile locations minimal makes refiling faster; besides, my primary
use case for refiling is to stow something away in its proper place for later
use. and we just set our &ldquo;proper places.&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-refile-targets</span> <span class="o">`</span><span class="p">((</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;todo.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">3</span><span class="p">)</span>
                           <span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;notes.org&#34;</span> <span class="nv">org-directory</span><span class="p">)</span> <span class="nb">:maxlevel</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)))</span></code></pre></div>
<h4 id="capture">Capture</h4>

<p>Org Capture is one of the best features of Org Mode. I use it to organize my
todo list, take note of ideas I think of, and kickstart blog posts.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;C-c c&#34;</span> <span class="o">.</span> <span class="nv">org-capture</span><span class="p">)</span></code></pre></div>
<p>The two applications I spend the most time in are Emacs and Firefox. It would be
very nice if I could use Org Capture from within the web browser. In particular,
I want to be able to rely on the functionality of Org Mode to manage my
bookmarks (see <a href="https://karl-voit.at/2014/08/10/bookmarks-with-orgmode/">Karl Volt&rsquo;s method</a>), rather than rely on Firefox. Also, I often
come across quotes or excerpts that I&rsquo;d love to file away for later. The
built-in <code>org-protocol</code> lets us intercept calls to <code>emacsclient</code> from a web browser
and apply functions to it, like <code>org-capture</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-protocol</span><span class="p">)</span></code></pre></div>
<p>However, this only lets us manipulate the selection in the browser as plain
text. Pretty much every browser has the ability to copy text as HTML. So we
leverage the power of <code>pandoc</code> to convert this HTML to Org Mode syntax using some
code by <a href="https://github.com/alphapapa/org-protocol-capture-html">alphapapa</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-protocol-capture-html</span><span class="p">)</span></code></pre></div>
<p>So how do we actually get data from Firefox to Emacs? You can read the <a href="https://orgmode.org/worg/org-contrib/org-protocol.html">Org Mode
wiki</a> for the basics.</p>

<p>The meat of the following snippet is in the function that turns the browser
selection into HTML (after <code>&amp;body=</code>). It was sourced from <a href="https://stackoverflow.com/questions/5643635/how-to-get-selected-html-text-with-javascript/6668159#6668159">StackOverflow</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">javascript</span><span class="o">:</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s1">&#39;org-protocol://capture-html?template=p&amp;url=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&amp;title=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="s2">&#34;[untitled page]&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&amp;body=&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span><span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getSelection</span> <span class="o">!=</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span><span class="kd">var</span> <span class="nx">sel</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">();</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sel</span><span class="p">.</span><span class="nx">rangeCount</span><span class="p">)</span> <span class="p">{</span><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">);</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">sel</span><span class="p">.</span><span class="nx">rangeCount</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span><span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">sel</span><span class="p">.</span><span class="nx">getRangeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">cloneContents</span><span class="p">());}</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;}}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">document</span><span class="p">.</span><span class="nx">selection</span> <span class="o">!=</span> <span class="s2">&#34;undefined&#34;</span><span class="p">)</span> <span class="p">{</span><span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&#34;Text&#34;</span><span class="p">)</span> <span class="p">{</span><span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">selection</span><span class="p">.</span><span class="nx">createRange</span><span class="p">().</span><span class="nx">htmlText</span><span class="p">;}}</span> <span class="kd">var</span> <span class="nx">relToAbs</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">href</span><span class="p">)</span> <span class="p">{</span><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">);</span> <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">href</span><span class="p">;</span> <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s2">&#34;//&#34;</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">search</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span> <span class="k">return</span> <span class="nx">abs</span><span class="p">;};</span> <span class="kd">var</span> <span class="nx">elementTypes</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;href&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">,</span> <span class="s1">&#39;src&#39;</span><span class="p">]];</span> <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span> <span class="nx">elementTypes</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">elementType</span><span class="p">)</span> <span class="p">{</span><span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">elementType</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">elementType</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">relToAbs</span><span class="p">(</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">elementType</span><span class="p">[</span><span class="mi">1</span><span class="p">])));}});</span> <span class="k">return</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;}());</span>
</code></pre></div>
<p>A convenient way to activate this from Firefox is to use the extension
<a href="https://github.com/mikecrittenden/shortkeys">ShortKeys</a>. With it, I bind the above to <code>c b</code>, for &ldquo;capture bookmark.&rdquo; One thing to
note is that the user interface for this extension, at least on Firefox, kinda
sucks. You have to scroll horizontally to save your keybindings, and it took me
a while to figure that out. I&rsquo;ve also set up many other bindings, like <code>n</code> and <code>p</code>
for next and previous tab, but that&rsquo;s another story.</p>

<p>We send the data from <code>org-protocol</code> into the following template.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="s">&#34;Org Protocol&#34;</span> <span class="nv">entry</span>
 <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
 <span class="s">&#34;* [[%:link][%(gm/square-to-round-brackets \&#34;%:description\&#34;)]]\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?\n%(gm/quote-if-non-empty \&#34;%i\&#34;)&#34;</span><span class="p">)</span></code></pre></div>
<p>Because Org links are constructed with square brackets, any URL whose title
contains square brackets (I&rsquo;m looking at you, arXiv) would break a normal
implementation of the this template. Thankfully, <a href="https://github.com/vincent-picaud">Vincent Picaud</a> wrote a function
to fix that up,</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/square-to-round-brackets</span> <span class="p">(</span><span class="nv">string-to-transform</span><span class="p">)</span>
  <span class="s">&#34;Transforms [ into ( and ] into ), other chars left unchanged.&#34;</span>
  <span class="p">(</span><span class="nf">concat</span>
  <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">it</span> <span class="sc">?[</span><span class="p">)</span> <span class="sc">?\(</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">it</span> <span class="sc">?]</span><span class="p">)</span> <span class="sc">?\)</span> <span class="nv">it</span><span class="p">))</span>
   <span class="nv">string-to-transform</span><span class="p">)))</span></code></pre></div>
<p>Also, I want to wrap the excerpt in an Org quote block, but not if there is no
excerpt.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/quote-if-non-empty</span> <span class="p">(</span><span class="nv">str</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">string-blank-p</span> <span class="nv">str</span><span class="p">)</span>
              <span class="c1">; dont quote things with headings or org blocks</span>
              <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;^\\(\*+\\)\\|\\(#\+BEGIN\_\\)&#34;</span> <span class="nv">str</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">str</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;#+BEGIN_QUOTE\n%s\n#+END_QUOTE&#34;</span> <span class="p">(</span><span class="nv">s-trim</span> <span class="nv">str</span><span class="p">))))</span>
  <span class="p">(</span><span class="nv">s-trim</span> <span class="nv">str</span><span class="p">))</span></code></pre></div>
<p>I also bind <code>c l</code> to store the URL of the current page as an Org link.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">javascript</span><span class="o">:</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;org-protocol://store-link:?url=&#39;</span><span class="o">+</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span>
</code></pre></div>
<p>Finally, I have a general purpose binding on <code>c n</code> for capturing any notes or
thoughts that come to me while browsing.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">javascript</span><span class="o">:</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;org-protocol://capture?template=n&#39;</span>
</code></pre></div>
<p>Here are my capture templates.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-capture-templates</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;a&#34;</span> <span class="s">&#34;Appointment&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;gcal.org&#34;</span> <span class="nv">org-directory</span><span class="p">))</span>
         <span class="s">&#34;* %i%? \n%^T\n&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="s">&#34;Todo&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
         <span class="s">&#34;* TODO %^{Title}\n:PROPERTIES:\n:CREATED: %U\n:END:\n%i%?&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="s">&#34;Note&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
         <span class="s">&#34;* %^{Title}\n:PROPERTIES:\n:CREATED: %U\n:END:\n%i%?&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;j&#34;</span> <span class="s">&#34;Journal&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file+olp+datetree</span> <span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;journal.org&#34;</span> <span class="nv">org-directory</span><span class="p">))</span>
         <span class="s">&#34;** %^{Heading}\n:PROPERTIES:\n:CREATED: %U\n:END:&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="s">&#34;euler&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file+headline</span> <span class="s">&#34;~/website/content-org/blog.org&#34;</span> <span class="s">&#34;Euler&#34;</span><span class="p">)</span>
         <span class="s">&#34;** Project Euler %^{Problem Number}: %^{Problem Name} %^g
</span><span class="s">:PROPERTIES:
</span><span class="s">:EXPORT_FILE_NAME: %\\1
</span><span class="s">:EXPORT_DATE: %u
</span><span class="s">:EXPORT_DESCRIPTION: My solution to problem %\\1 of Project Euler.
</span><span class="s">:END:\n*** Problem Statement\n%?\n*** My Algorithm&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="s">&#34;Org Protocol&#34;</span> <span class="nv">entry</span>
         <span class="p">(</span><span class="nv">file</span> <span class="nv">org-default-notes-file</span><span class="p">)</span>
         <span class="s">&#34;* [[%:link][%(gm/square-to-round-brackets \&#34;%:description\&#34;)]]\n:PROPERTIES:\n:CREATED: %U\n:END:\n%?\n%(gm/quote-if-non-empty \&#34;%i\&#34;)&#34;</span><span class="p">)))</span></code></pre></div>
<h4 id="todo-lists">Todo Lists</h4>

<p>I like the following set of <code>TODO</code> words. This is what appears
before an Org headline when a todo state is activated.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-keywords</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="nv">sequence</span> <span class="s">&#34;TODO(t)&#34;</span> <span class="s">&#34;WAITING(w)&#34;</span> <span class="s">&#34;|&#34;</span> <span class="s">&#34;DONE(d)&#34;</span> <span class="s">&#34;CANCELLED(c)&#34;</span><span class="p">)))</span></code></pre></div>
<p>Automatically archive cancelled tasks.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-todo-state-tags-triggers</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;CANCELLED&#34;</span> <span class="p">(</span><span class="s">&#34;ARCHIVE&#34;</span> <span class="o">.</span> <span class="no">t</span><span class="p">))))</span></code></pre></div>
<p>I would rather the progress in a todo list (for example, <code>[<sup>4</sup>&frasl;<sub>5</sub>]</code>) be automatically
updated when I archive a subtree.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">myorg-update-parent-cookie</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">major-mode</span> <span class="ss">&#39;org-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">save-excursion</span>
      <span class="p">(</span><span class="nb">ignore-errors</span>
        <span class="p">(</span><span class="nv">org-back-to-heading</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">org-update-parent-todo-statistics</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">defadvice</span> <span class="nv">org-archive-subtree</span> <span class="p">(</span><span class="nv">after</span> <span class="nv">fix-cookies</span> <span class="nv">activate</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">myorg-update-parent-cookie</span><span class="p">))</span></code></pre></div>
<h4 id="google-calendar">Google Calendar</h4>

<p>I manage deadlines with Org Agenda.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;C-c a&#34;</span> <span class="o">.</span> <span class="nv">org-agenda</span><span class="p">)</span></code></pre></div>
<p>However, that&rsquo;s not quite enough, because when I&rsquo;m out and about, I want whatever
I have in my Org Agenda to be able to alert me on my phone. I also want to be
able to enter new events on the go. The best solution I&rsquo;ve found for this is to
integrate Org Mode with Google Calendar. The setup is contained in the file for
my personal settings, <code>private.el</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-gcal</span>
  <span class="nb">:after</span> <span class="nv">org</span>
  <span class="nb">:commands</span> <span class="nv">org-gcal-sync</span>
  <span class="nb">:init</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">package-check-signature</span> <span class="no">nil</span><span class="p">)</span>
  <span class="nb">:custom</span> <span class="p">(</span><span class="nv">org-gcal-dir</span> <span class="nv">gmacs-cache-dir</span><span class="p">)</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-agenda-mode</span> <span class="o">.</span> <span class="nv">org-gcal-sync</span><span class="p">))</span></code></pre></div>
<h4 id="links">Links</h4>

<p>I often use links to easily navigate to a relevant file in cases where I would
rather not use <code>org-attach</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;C-c l&#34;</span> <span class="o">.</span> <span class="nv">org-store-link</span><span class="p">)</span></code></pre></div>
<p>Follow links using return rather than <code>C-c C-o</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-return-follows-link</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<p>I can use <code>org-cliplink</code> to paste in a website&rsquo;s URL with the link&rsquo;s description
being the title of that website.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-cliplink</span>
  <span class="nb">:commands</span> <span class="nv">org-cliplink</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="s">&#34;C-c y&#34;</span> <span class="o">.</span> <span class="nv">org-cliplink</span><span class="p">)))</span></code></pre></div>
<h4 id="word-count">Word Count</h4>

<p>It&rsquo;s very useful to be able to see the word count of a subtree when I am writing
a paper for school.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-wc</span>
  <span class="nb">:commands</span> <span class="nv">org-wc-display</span>
  <span class="nb">:bind</span> <span class="p">(</span><span class="nb">:map</span> <span class="nv">org-mode-map</span> <span class="p">(</span><span class="s">&#34;C-c w&#34;</span> <span class="o">.</span> <span class="nv">gm/wc-display-current-subtree</span><span class="p">)))</span></code></pre></div>
<p>I narrow to subtree by default because displaying the count for every subtree in
the file is (usually) unnecessary and (always) too slow.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/wc-display-current-subtree</span> <span class="p">(</span><span class="nv">arg</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;P&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">arg</span>
      <span class="p">(</span><span class="nv">org-wc-display</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">save-restriction</span>
      <span class="p">(</span><span class="nv">org-narrow-to-subtree</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">org-wc-display</span> <span class="no">nil</span><span class="p">))))</span></code></pre></div>
<h3 id="prettifying">Prettifying</h3>

<h4 id="headlines">Headlines</h4>

<p>Let&rsquo;s make our headings look a bit nicer. The package <code>org-bullet-mode</code> replaces the
asterisks that define an Org heading with pretty symbols, like stylized bullet
points.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">org-bullets</span>
    <span class="nb">:commands</span> <span class="nv">org-bullets-mode</span>
    <span class="nb">:hook</span> <span class="p">(</span><span class="nv">org-mode</span> <span class="o">.</span> <span class="nv">org-bullets-mode</span><span class="p">))</span></code></pre></div>
<p>In a similar vein, it helps the visual hierarchy to have text indented in
accordance with the level of the heading, so I always use <code>org-indent-mode</code>.
Because it&rsquo;s always active, it&rsquo;s best to diminish it.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-startup-indented</span> <span class="no">t</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;org-indent-mode</span><span class="p">)</span></code></pre></div>
<h4 id="emphasis-markers">Emphasis Markers</h4>

<p>It looks much cleaner if we omit emphasis markers such as the <code>*</code> asterisks that
make something bold. It is enough to just display the argument as bold.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-hide-emphasis-markers</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<h4 id="lists">Lists</h4>

<p>Have lists begun by, for example, <code>-</code> look like a bullet list.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">font-lock-add-keywords</span> <span class="ss">&#39;org-mode</span>
                        <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;^ *\\([-]\\) &#34;</span>
                           <span class="p">(</span><span class="mi">0</span> <span class="p">(</span><span class="nb">prog1</span> <span class="p">()</span> <span class="p">(</span><span class="nv">compose-region</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">1</span><span class="p">)</span> <span class="s">&#34;•&#34;</span><span class="p">))))))</span></code></pre></div>
<p>This doesn&rsquo;t change anything in the buffer, which is nice.</p>

<h4 id="pretty-symbols-in-source-blocks">Pretty Symbols in Source Blocks</h4>

<p>I do a lot of programming in Org Mode source blocks, and I want to have features
like <code>prettify-symbols-mode</code> for <code>lambda</code> functions in Elisp. However, this mode is
buffer local, so if I were to turn it on, I would have to display the string
&ldquo;lambda&rdquo; as &ldquo;λ&rdquo; throughout the buffer, even in paragraphs and the source blocks
of other languages. This is obviously undesirable.</p>

<p>We add hooks to particular languages to activate pretty symbols. In this case I
don&rsquo;t add the lambda fontification, just activate <code>pretty-symbols-mode</code>, because
the default variable <code>lisp-prettify-symbols-mode</code> already has this pair.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;emacs-lisp-mode-hook</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nb">setq</span> <span class="nv">prettify-symbols-alist</span>
                  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;lambda&#34;</span> <span class="o">.</span> <span class="sc">?λ</span><span class="p">)</span>
                    <span class="p">(</span><span class="s">&#34;lambda!&#34;</span> <span class="o">.</span> <span class="p">(</span><span class="sc">?λ</span> <span class="p">(</span><span class="nv">Br</span> <span class="o">.</span> <span class="nv">Bl</span><span class="p">)</span> <span class="sc">?!</span><span class="p">))))</span>
            <span class="p">(</span><span class="nv">prettify-symbols-mode</span><span class="p">)))</span></code></pre></div>
<p>Then, we modify <code>org-src-font-lock-fontify-block</code> (the function that fontifies Org
source blocks) as per <a href="https://emacs.stackexchange.com/questions/17283/is-it-possible-to-get-prettified-symbols-in-org-mode-source-blocks/17847">this SE post</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-src-font-lock-fontify-block</span> <span class="p">(</span><span class="nv">lang</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">)</span>
  <span class="s">&#34;Fontify code block.
</span><span class="s">This function is called by emacs automatic fontification, as long
</span><span class="s">as </span><span class="ss">`org-src-fontify-natively&#39;</span><span class="s"> is non-nil.&#34;</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">lang-mode</span> <span class="p">(</span><span class="nv">org-src--get-lang-mode</span> <span class="nv">lang</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="nv">lang-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nf">string</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="nv">start</span> <span class="nv">end</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">modified</span> <span class="p">(</span><span class="nf">buffer-modified-p</span><span class="p">))</span> <span class="p">(</span><span class="nv">org-buffer</span> <span class="p">(</span><span class="nf">current-buffer</span><span class="p">))</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">remove-text-properties</span> <span class="nv">start</span> <span class="nv">end</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">face</span> <span class="no">nil</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">with-current-buffer</span>
        <span class="p">(</span><span class="nf">get-buffer-create</span>
         <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34; org-src-fontification:&#34;</span> <span class="p">(</span><span class="nf">symbol-name</span> <span class="nv">lang-mode</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">delete-region</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="nf">string</span> <span class="s">&#34; &#34;</span><span class="p">)</span> <span class="c1">;; so there&#39;s a final property change</span>
      <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="nv">lang-mode</span><span class="p">)</span> <span class="p">(</span><span class="nf">funcall</span> <span class="nv">lang-mode</span><span class="p">))</span>
      <span class="c1">;; Avoid `font-lock-ensure&#39;, which does not display fonts in</span>
      <span class="c1">;; source block.</span>
      <span class="p">(</span><span class="nf">call-interactively</span> <span class="nf">#&#39;</span><span class="nv">font-lock-fontify-buffer</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nf">next-single-property-change</span> <span class="nv">pos</span> <span class="ss">&#39;face</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">put-text-property</span>
         <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="nv">next</span><span class="p">))</span> <span class="ss">&#39;face</span>
         <span class="p">(</span><span class="nf">get-text-property</span> <span class="nv">pos</span> <span class="ss">&#39;face</span><span class="p">)</span> <span class="nv">org-buffer</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">))</span>
      <span class="c1">;; Addition: also copy &#39;composition info for prettified symbols</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">next</span> <span class="p">(</span><span class="nf">next-single-property-change</span> <span class="nv">pos</span> <span class="ss">&#39;composition</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">put-text-property</span>
         <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">1-</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nf">1-</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">start</span> <span class="nv">next</span><span class="p">))</span> <span class="ss">&#39;composition</span>
         <span class="p">(</span><span class="nf">get-text-property</span> <span class="nv">pos</span> <span class="ss">&#39;composition</span><span class="p">)</span> <span class="nv">org-buffer</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">pos</span> <span class="nv">next</span><span class="p">))</span>
      <span class="c1">;; End addition</span>
      <span class="p">)</span>
    <span class="p">(</span><span class="nf">add-text-properties</span>
     <span class="nv">start</span> <span class="nv">end</span>
     <span class="o">&#39;</span><span class="p">(</span><span class="nv">font-lock-fontified</span> <span class="no">t</span> <span class="nv">fontified</span> <span class="no">t</span> <span class="nv">font-lock-multiline</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">set-buffer-modified-p</span> <span class="nv">modified</span><span class="p">)))))</span></code></pre></div>
<h3 id="babel">Babel</h3>

<p>Set up languages loaded for use in Org source blocks and their respective
default execution commands.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">org-babel-do-load-languages</span>
      <span class="ss">&#39;org-babel-load-languages</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">python</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nv">latex</span> <span class="o">.</span> <span class="no">t</span><span class="p">)</span>
                                  <span class="p">(</span><span class="nv">shell</span> <span class="o">.</span> <span class="no">t</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">setq</span> <span class="nv">org-babel-python-command</span> <span class="s">&#34;python3.6&#34;</span>
      <span class="nv">org-babel-latex-command</span> <span class="s">&#34;pdflatex&#34;</span><span class="p">)</span></code></pre></div>
<p>Make Org Mode source blocks act normally with respect to indentation and syntax
highlighting.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-src-fontify-natively</span> <span class="no">t</span>
      <span class="nv">org-src-tab-acts-natively</span> <span class="no">t</span>
      <span class="nv">org-edit-src-content-indentation</span> <span class="mi">0</span><span class="p">)</span></code></pre></div>
<p>I&rsquo;m generally fine with just evaluating a code block.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-confirm-babel-evaluate</span> <span class="no">nil</span><span class="p">)</span></code></pre></div>
<h4 id="proper-keymaps-in-org-source-blocks">Proper Keymaps in Org Source Blocks</h4>

<p><a href="http://kitchingroup.cheme.cmu.edu/blog/2017/06/10/Adding-keymaps-to-src-blocks-via-org-font-lock-hook/">John Kitchin</a> explains how to get use keybindings from the appropriate language
major mode inside Org source blocks. This heavily reduces the need to activate
special edit mode with <code>C-c '</code>. The idea is that we set up keymaps and apply them
with font-lock by hooking into Org Mode&rsquo;s font-lock. We define the function that
applies the keymap to each block.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/add-keymap-to-src-blocks</span> <span class="p">(</span><span class="nv">limit</span><span class="p">)</span>
  <span class="s">&#34;Add keymaps to src-blocks defined in </span><span class="ss">`gm/src-block-keymaps&#39;</span><span class="s">.&#34;</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="nv">org-babel-src-block-regexp</span> <span class="nv">limit</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">lang</span> <span class="p">(</span><span class="nv">match-string</span> <span class="mi">2</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">beg</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">assoc</span> <span class="p">(</span><span class="nv">org-no-properties</span> <span class="nv">lang</span><span class="p">)</span> <span class="nv">gm/src-block-keymaps</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">progn</span>
              <span class="p">(</span><span class="nf">add-text-properties</span>
               <span class="nv">beg</span> <span class="nv">end</span> <span class="o">`</span><span class="p">(</span><span class="nv">local-map</span> <span class="o">,</span><span class="p">(</span><span class="nf">cdr</span> <span class="p">(</span><span class="nf">assoc</span>
                                          <span class="p">(</span><span class="nv">org-no-properties</span> <span class="nv">lang</span><span class="p">)</span>
                                          <span class="nv">gm/src-block-keymaps</span><span class="p">))))))))))</span></code></pre></div>
<p>To be able to toggle this, we add a minor mode. This is where we add the
relevant hook.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">define-minor-mode</span> <span class="nv">gm/src-keymap-mode</span>
  <span class="s">&#34;Minor mode to add mode keymaps to src-blocks.&#34;</span>
  <span class="nb">:init-value</span> <span class="no">nil</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">gm/src-keymap-mode</span>
      <span class="p">(</span><span class="nb">progn</span>
        <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;elpy</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-font-lock-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/add-keymap-to-src-blocks</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;font-lock-extra-managed-props</span> <span class="ss">&#39;local-map</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;org-font-lock-hook</span> <span class="nf">#&#39;</span><span class="nv">gm/add-keymap-to-src-blocks</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">cursor-sensor-mode</span> <span class="mi">-1</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">call-interactively</span> <span class="nf">#&#39;</span><span class="nv">font-lock-fontify-buffer</span><span class="p">))</span></code></pre></div>
<p>Here are the actual maps.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/src-block-keymaps</span>
      <span class="o">`</span><span class="p">((</span><span class="s">&#34;python&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">map</span> <span class="p">(</span><span class="nv">make-composed-keymap</span>
                                 <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;elpy-mode</span><span class="p">)</span>
                                      <span class="nv">elpy-mode-map</span><span class="p">)</span>
                                   <span class="o">,</span><span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">boundp</span> <span class="ss">&#39;python-mode</span><span class="p">)</span>
                                      <span class="nv">python-mode-map</span><span class="p">))</span>
                                 <span class="nv">org-mode-map</span><span class="p">)))</span>
                       <span class="c1">;; In org-mode I define RET so we redefine</span>
                       <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;RET&#34;</span><span class="p">)</span> <span class="ss">&#39;newline-and-indent</span><span class="p">)</span>
                       <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c C-c&#34;</span><span class="p">)</span> <span class="ss">&#39;org-ctrl-c-ctrl-c</span><span class="p">)</span>
                       <span class="nv">map</span><span class="p">))</span>
        <span class="p">(</span><span class="s">&#34;emacs-lisp&#34;</span> <span class="o">.</span> <span class="o">,</span><span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">map</span> <span class="p">(</span><span class="nv">make-composed-keymap</span>
                                     <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">emacs-lisp-mode-map</span><span class="p">)</span>
                                     <span class="nv">org-mode-map</span><span class="p">)))</span>
                           <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;RET&#34;</span><span class="p">)</span> <span class="ss">&#39;newline-and-indent</span><span class="p">)</span>
                           <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;C-c C-c&#34;</span><span class="p">)</span> <span class="ss">&#39;org-ctrl-c-ctrl-c</span><span class="p">)</span>
                           <span class="nv">map</span><span class="p">))))</span></code></pre></div>
<h3 id="latex">LaTeX</h3>

<p>Highlight LateX inline math in org mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-highlight-latex-and-related</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">latex</span><span class="p">))</span></code></pre></div>
<h4 id="math-mode">Math Mode</h4>

<p>Define a keychord to enter inline math mode. This allows me to get around
messing with making <code>$</code> an electrically paired delimiter.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">key-chord-define</span> <span class="nv">org-mode-map</span> <span class="s">&#34;r4&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/create-or-exit-math-fragment</span><span class="p">)</span></code></pre></div>
<ul>
<li><p>Pretty Math Symbols</p>

<p>I got the source for this from <a href="https://bitbucket.org/mortiferus/latex-pretty-symbols.el">mortiferus</a>. The file I use is not the one from
their Bitbucket repo; I have, for example, removed subscripts and superscripts.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;latex-unicode-simplified</span> <span class="s">&#34;latex-pretty-symbols&#34;</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="don-t-break-paragraph-on-comments">Don&rsquo;t Break Paragraph on Comments&rsquo;</h4>

<p><a href="https://emacs.stackexchange.com/questions/22574/orgmode-export-how-to-prevent-a-new-line-for-comment-lines">John Kitchin</a> tells us how to remove comments from an Org document when exporting
to LaTeX.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">delete-org-comments</span> <span class="p">(</span><span class="nv">backend</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">comment</span> <span class="nv">in</span> <span class="p">(</span><span class="nf">reverse</span> <span class="p">(</span><span class="nv">org-element-map</span> <span class="p">(</span><span class="nv">org-element-parse-buffer</span><span class="p">)</span>
                                    <span class="ss">&#39;comment</span> <span class="ss">&#39;identity</span><span class="p">))</span>
        <span class="nb">do</span> <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nf">buffer-substring</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:begin</span> <span class="nv">comment</span><span class="p">)</span>
                                <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:end</span> <span class="nv">comment</span><span class="p">))</span>
              <span class="s">&#34;&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-export-before-processing-hook</span> <span class="ss">&#39;delete-org-comments</span><span class="p">)</span></code></pre></div>
<h4 id="reformat-math-fragment">Reformat Math Fragment</h4>

<p>For my primary use case of typing math in LaTeX, I don&rsquo;t care about how the
source looks when I&rsquo;m typing it; I&rsquo;m often typing it live, so the main concern
is speed. But later, I want it to look nice and readable, with spacing and so
on.</p>

<p>The idea is pretty simple. We just maintain a list of regexps in
<code>gm/reformat-fragment-alist</code> and run them all on a given LaTeX fragment with
<code>gm/reformat-fragment</code>. The main thing to notice is that the regexp that takes
care of too many spaces goes last. This way, we don&rsquo;t have to worry about
introducing too many spaces in the earlier regexps.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/reformat-fragment-alist</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;\\([^ ]?\\)\\+\\([^ ]?\\)&#34;</span> <span class="s">&#34;\\1 + \\2&#34;</span> <span class="s">&#34;spaces around t&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;[ ]\\(\\^[^\\]\\)&#34;</span> <span class="s">&#34;\\1 &#34;</span> <span class="s">&#34;remove space before e.g ^ in sin ^2&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;\\s-\\s-*&#34;</span> <span class="s">&#34; &#34;</span> <span class="s">&#34;no more than 1 space in a row&#34;</span><span class="p">))</span>
  <span class="s">&#34;Alist of (REGEXP TO DOCSTRING) parsed by </span><span class="ss">`gm/reformat-fragment&#39;</span><span class="s">.
</span><span class="s">Upon reformatting, each REGEXP is replaced with TO. DOCSTRING
</span><span class="s">simply explains what the regexp does.&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/reformat-fragment</span> <span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">fr</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="nv">fr</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">fr</span> <span class="p">(</span><span class="nv">gm/org-curr-fragment</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fr-begin</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">fr</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">fr-end</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:end</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">)))</span>
        <span class="nv">base</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">save-excursion</span>
      <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">fr-begin</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">base</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="nv">fr-begin</span> <span class="nv">fr-end</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">reg</span> <span class="nv">gm/reformat-fragment-alist</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">base</span> <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">reg</span><span class="p">)</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">reg</span><span class="p">)</span> <span class="nv">base</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">delete-region</span> <span class="nv">fr-begin</span> <span class="nv">fr-end</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="nv">base</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:end</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">))))</span></code></pre></div>
<h4 id="equation-auto-preview">Equation Auto Preview</h4>

<p>Not too small.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-format-latex-options</span> <span class="p">(</span><span class="nf">plist-put</span> <span class="nv">org-format-latex-options</span> <span class="nb">:scale</span> <span class="mf">2.75</span><span class="p">))</span></code></pre></div>
<p>Where should it be? Let&rsquo;s put them all in the same place, so that common
fragments (like <code>x^2</code>) are never generated more than once and so that we don&rsquo;t
litter our folders.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-preview-latex-image-directory</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;cache/ltximg/&#34;</span>
                                                          <span class="nv">gmacs-emacs-dir</span><span class="p">))</span></code></pre></div>
<p>Inspired by John Kitchin. I&rsquo;ve modified it to be toggleable and to run a hook on
leaving a math fragment.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;ov</span><span class="p">)</span>
<span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/org-last-fragment</span> <span class="no">nil</span>
  <span class="s">&#34;Holds the type and position of last valid fragment we were on.
</span><span class="s">  Format: (FRAGMENT_TYPE FRAGMENT_POINT_BEGIN)&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/org-valid-fragment-type</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">latex-fragment</span> <span class="nv">latex-environment</span><span class="p">)</span>
  <span class="s">&#34;List of types of fragments that will be previewed by </span><span class="ss">`gm/org-preview-fragment&#39;</span><span class="s">&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-curr-fragment</span> <span class="p">()</span>
  <span class="s">&#34;Returns the type and position of the current fragment available
</span><span class="s">for preview inside org-mode. Returns nil at non-displayable fragments.&#34;</span>
  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">fr</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">fr-type</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">fr</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">fr-type</span> <span class="nv">gm/org-valid-fragment-type</span><span class="p">)</span>
      <span class="c1">;; \(...\)| cursor there should not result in active fragment</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">(</span> <span class="c1">; we only define these things now to optimize</span>
            <span class="p">(</span><span class="nv">fr-begin</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:begin</span> <span class="nv">fr</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">fr-end</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:end</span> <span class="nv">fr</span><span class="p">))</span>
            <span class="c1">;; add one for the space after in \end{equation}</span>
            <span class="p">(</span><span class="nv">fr-post-blank</span> <span class="p">(</span><span class="nf">1+</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:post-blank</span> <span class="nv">fr</span><span class="p">))))</span>
        <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="nv">fr-end</span><span class="p">)</span>
                    <span class="c1">;; gotta fix some weird behaviour with environments</span>
                    <span class="c1">;; make sure that if you&#39;re on the line after</span>
                    <span class="c1">;; \end{equation}, you&#39;re considered out of the fragment</span>
                    <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">fr-type</span> <span class="ss">&#39;latex-environment</span><span class="p">)</span>
                         <span class="c1">;; check if point is between the actual end of the</span>
                         <span class="c1">;; LaTex environment and the &#34;supposed end&#34; extended by blank ;; lines after the environment</span>
                         <span class="p">(</span><span class="nf">&gt;=</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">fr-end</span> <span class="nv">fr-post-blank</span><span class="p">))</span>
                         <span class="p">(</span><span class="nf">&lt;=</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="nv">fr-end</span><span class="p">)</span>
                         <span class="p">))</span>
          <span class="p">(</span><span class="nf">list</span> <span class="nv">fr-type</span> <span class="nv">fr-begin</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-remove-fragment-overlay</span> <span class="p">(</span><span class="nv">fr</span><span class="p">)</span>
  <span class="s">&#34;Remove fragment overlay at fr&#34;</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fr-type</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">fr</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">fr-begin</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">fr</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">fr-begin</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">fr-type</span> <span class="nv">gm/org-valid-fragment-type</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">ov</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">--filter</span>
                      <span class="p">(</span><span class="nb">and</span>
                       <span class="p">(</span><span class="nf">&lt;=</span> <span class="p">(</span><span class="nf">overlay-start</span> <span class="nv">it</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
                       <span class="p">(</span><span class="nf">&gt;=</span> <span class="p">(</span><span class="nf">overlay-end</span> <span class="nv">it</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
                      <span class="p">(</span><span class="nv">org--list-latex-overlays</span><span class="p">)))))</span>
        <span class="p">(</span><span class="nb">when</span> <span class="nv">ov</span>
          <span class="p">(</span><span class="nf">delete-overlay</span> <span class="nv">ov</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-preview-fragment</span> <span class="p">(</span><span class="nv">fr</span><span class="p">)</span>
  <span class="s">&#34;Preview org fragment at fr&#34;</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">fr-type</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">fr</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">fr-begin</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">fr</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">goto-char</span> <span class="nv">fr-begin</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">memq</span> <span class="nv">fr-type</span> <span class="nv">gm/org-valid-fragment-type</span><span class="p">)</span>
               <span class="p">(</span><span class="nv">gm/org-curr-fragment</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">org-toggle-latex-fragment</span><span class="p">))))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-auto-toggle-fragment-display</span> <span class="p">()</span>
  <span class="s">&#34;Automatically toggle a displayable org mode fragment.&#34;</span>
  <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="ss">&#39;org-mode</span> <span class="nv">major-mode</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">curr</span> <span class="p">(</span><span class="nv">gm/org-curr-fragment</span><span class="p">)))</span>
         <span class="p">(</span><span class="nb">cond</span>
          <span class="c1">;; were on a fragment and now on a new fragment</span>
          <span class="p">((</span><span class="nb">and</span>
            <span class="c1">;; fragment we were on</span>
            <span class="nv">gm/org-last-fragment</span>
            <span class="c1">;; and are on a fragment now</span>
            <span class="nv">curr</span>
            <span class="c1">;; but not on the last one this is a little tricky. as you edit the</span>
            <span class="c1">;; fragment, it is not equal to the last one. We use the begin</span>
            <span class="c1">;; property which is less likely to change for the comparison.</span>
            <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">equal</span> <span class="nv">curr</span> <span class="nv">gm/org-last-fragment</span><span class="p">)))</span>

           <span class="c1">;; reformat old fragment</span>
           <span class="c1">;; (gm/reformat-fragment gm/org-last-fragment)</span>

           <span class="c1">;; go back to last one and put image back, provided there is still a fragment there</span>
           <span class="p">(</span><span class="nb">save-excursion</span>
             <span class="p">(</span><span class="nv">gm/org-preview-fragment</span> <span class="nv">gm/org-last-fragment</span><span class="p">)</span>
             <span class="c1">;; now remove current image</span>
             <span class="p">(</span><span class="nv">gm/org-remove-fragment-overlay</span> <span class="nv">curr</span><span class="p">))</span>

           <span class="c1">;; and save new fragment</span>
           <span class="p">(</span><span class="nb">setq</span> <span class="nv">gm/org-last-fragment</span> <span class="nv">curr</span><span class="p">))</span>

          <span class="c1">;; were on a fragment and now are not on a fragment</span>
          <span class="p">((</span><span class="nb">and</span>
            <span class="c1">;; not on a fragment now</span>
            <span class="p">(</span><span class="nv">not</span> <span class="nv">curr</span><span class="p">)</span>
            <span class="c1">;; but we were on one</span>
            <span class="nv">gm/org-last-fragment</span><span class="p">)</span>

           <span class="c1">;; reformat old fragment</span>
           <span class="c1">;; (gm/reformat-fragment gm/org-last-fragment)</span>
           <span class="c1">;; put image back on, provided that there is still a fragment here.</span>
           <span class="p">(</span><span class="nb">save-excursion</span>
             <span class="p">(</span><span class="nv">gm/org-preview-fragment</span> <span class="nv">gm/org-last-fragment</span><span class="p">))</span>
           <span class="c1">;; unset last fragment</span>
           <span class="p">(</span><span class="nb">setq</span> <span class="nv">gm/org-last-fragment</span> <span class="no">nil</span><span class="p">))</span>

          <span class="c1">;; were not on a fragment, and now are</span>
          <span class="p">((</span><span class="nb">and</span>
            <span class="c1">;; we were not one one</span>
            <span class="p">(</span><span class="nv">not</span> <span class="nv">gm/org-last-fragment</span><span class="p">)</span>
            <span class="c1">;; but now we are</span>
            <span class="nv">curr</span><span class="p">)</span>
           <span class="c1">;; remove image</span>
           <span class="p">(</span><span class="nb">save-excursion</span>
             <span class="p">(</span><span class="nv">gm/org-remove-fragment-overlay</span> <span class="nv">curr</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">setq</span> <span class="nv">gm/org-last-fragment</span> <span class="nv">curr</span><span class="p">)</span>
             <span class="p">)</span>
           <span class="c1">;; there is no point being in on the \( or \) part of the math fragment</span>
           <span class="c1">;; this code jumps the point into the actual math part of the fragment</span>
           <span class="p">(</span><span class="nb">cond</span>
            <span class="p">((</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">gm/last-n-chars</span> <span class="mi">-2</span><span class="p">)</span> <span class="s">&#34;\\(&#34;</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">2</span><span class="p">))</span>
            <span class="p">((</span><span class="nb">and</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)</span> <span class="mi">92</span><span class="p">)</span>
                  <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">char-after</span><span class="p">)</span> <span class="mi">41</span><span class="p">))</span>
             <span class="p">(</span><span class="nf">backward-char</span> <span class="mi">1</span><span class="p">))))))))</span></code></pre></div>
<p>Toggle the &ldquo;mode&rdquo; to preview equations.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/eq-preview</span> <span class="no">nil</span><span class="p">)</span>
<span class="c1">;; this is buffer local</span>
<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/toggle-equation-preview</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">gm/eq-preview</span>
      <span class="p">(</span><span class="nb">progn</span>
        <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;post-command-hook</span> <span class="ss">&#39;gm/org-auto-toggle-fragment-display</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Equation preview disabled.&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;post-command-hook</span> <span class="ss">&#39;gm/org-auto-toggle-fragment-display</span> <span class="no">nil</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Equation preview enabled.&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">togglef</span> <span class="nv">gm/eq-preview</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c p&#34;</span> <span class="ss">&#39;gm/toggle-equation-preview</span><span class="p">)</span></code></pre></div>
<p>We can also center equations and (this is useful when equation preview mode is
disabled) add a tooltip to them that lets you edit the equation when you click
on it. This is more John Kitchin code.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-justify-fragment-overlay</span> <span class="p">(</span><span class="nv">beg</span> <span class="nv">end</span> <span class="nv">image</span> <span class="nv">imagetype</span><span class="p">)</span>
  <span class="s">&#34;Adjust the justification of a LaTeX fragment.
</span><span class="s">The justification is set by :justify in
</span><span class="s"></span><span class="ss">`org-format-latex-options&#39;</span><span class="s">. Only equations at the beginning of a
</span><span class="s">line are justified.&#34;</span>
  <span class="p">(</span><span class="nb">when</span>
   <span class="c1">;; Centered justification</span>
   <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">beg</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">string=</span> <span class="s">&#34;\\begin&#34;</span>
                  <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
                   <span class="nv">beg</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">beg</span> <span class="mi">6</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">img</span> <span class="p">(</span><span class="nv">create-image</span> <span class="nv">image</span> <span class="ss">&#39;png</span> <span class="no">t</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">width</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nf">image-size</span> <span class="nv">img</span><span class="p">)))</span>
           <span class="p">(</span><span class="nv">offset</span> <span class="p">(</span><span class="nf">floor</span> <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nf">/</span> <span class="p">(</span><span class="nf">min</span> <span class="p">(</span><span class="nv">window-max-chars-per-line</span><span class="p">)</span> <span class="nv">fill-column</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">/</span> <span class="nv">width</span> <span class="mi">2</span><span class="p">)))))</span>
      <span class="p">(</span><span class="nf">overlay-put</span> <span class="p">(</span><span class="nv">ov-at</span><span class="p">)</span> <span class="ss">&#39;before-string</span> <span class="p">(</span><span class="nf">make-string</span> <span class="nv">offset</span> <span class="sc">? </span><span class="p">)))))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">org-latex-fragment-tooltip</span> <span class="p">(</span><span class="nv">beg</span> <span class="nv">end</span> <span class="nv">image</span> <span class="nv">imagetype</span><span class="p">)</span>
  <span class="s">&#34;Add the fragment tooltip to the overlay and set click function to toggle it.&#34;</span>
  <span class="p">(</span><span class="nf">overlay-put</span> <span class="p">(</span><span class="nv">ov-at</span><span class="p">)</span> <span class="ss">&#39;help-echo</span>
               <span class="p">(</span><span class="nf">concat</span> <span class="p">(</span><span class="nf">buffer-substring</span> <span class="nv">beg</span> <span class="nv">end</span><span class="p">)</span>
                       <span class="s">&#34;\nmouse-1 to toggle.&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">overlay-put</span> <span class="p">(</span><span class="nv">ov-at</span><span class="p">)</span> <span class="ss">&#39;local-map</span> <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">map</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">)))</span>
                                    <span class="p">(</span><span class="nf">define-key</span> <span class="nv">map</span> <span class="p">[</span><span class="nv">mouse-1</span><span class="p">]</span>
                                      <span class="o">`</span><span class="p">())</span>
                                    <span class="nv">map</span><span class="p">)))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org--format-latex-make-overlay</span> <span class="nb">:after</span> <span class="ss">&#39;org-justify-fragment-overlay</span><span class="p">)</span>
<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;org--format-latex-make-overlay</span> <span class="nb">:after</span> <span class="ss">&#39;org-latex-fragment-tooltip</span><span class="p">)</span></code></pre></div>
<h4 id="export">Export</h4>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-latex-export</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">save-excursion</span>
    <span class="p">(</span><span class="nf">search-backward</span> <span class="s">&#34;EXPORT_FILE_NAME&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-latex-export-to-pdf</span> <span class="no">t</span> <span class="no">t</span><span class="p">)))</span></code></pre></div>
<p>Bind this in Org mode.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="s">&#34;C-c b&#34;</span> <span class="o">.</span> <span class="nv">gm/org-latex-export</span><span class="p">)</span></code></pre></div>
<p>Don&rsquo;t use straight quotes when exporting.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-export-with-smart-quotes</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<ul>
<li><p>Math Macros</p>

<p>I have a LaTeX <code>.sty</code> file with macros for math. I want this to be automatically
included in every LaTeX file exported from Org Mode. The optional third argument
makes sure this package is also loaded when compiling LaTeX image previews, such
as equation previews.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-packages-alist</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;&#34;</span> <span class="s">&#34;gm-math&#34;</span> <span class="no">t</span><span class="p">)))</span></code></pre></div></li>

<li><p>Latexmk</p>

<p>The command <code>gm/auto-tex-cmd</code> looks at your Org file. If it finds that <code>xelatex</code> has
been specified as the desired compilation command, then it uses that. Otherwise,
it runs <code>latexmk</code> with normal <code>pdflatex</code>. We don&rsquo;t need to worry about compiling the
correct number of times to include bibliography information, or to render
graphics correctly; <code>latexmk</code> handles all of that.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/auto-tex-cmd</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">texcmd</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">texcmd</span> <span class="s">&#34;latexmk -pdf -quiet %f&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;LATEX_CMD: xelatex&#34;</span> <span class="p">(</span><span class="nf">buffer-string</span><span class="p">))</span>
        <span class="p">(</span><span class="nb">setq</span> <span class="nv">texcmd</span> <span class="s">&#34;latexmk -pdflatex=xelatex -pdf -quiet %f&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-to-pdf-process</span> <span class="p">(</span><span class="nf">list</span> <span class="nv">texcmd</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-export-latex-after-initial-vars-hook</span> <span class="ss">&#39;gm/auto-tex-cmd</span><span class="p">)</span></code></pre></div></li>

<li><p>Command Links</p>

<ul>
<li><p>No Option</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">org-link-set-parameters</span>
 <span class="s">&#34;latex&#34;</span>
 <span class="nb">:follow</span> <span class="no">nil</span>
 <span class="nb">:export</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">path</span> <span class="nv">desc</span> <span class="nf">format</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="nf">format</span> <span class="ss">&#39;latex</span><span class="p">)</span>
             <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\%s{%s}&#34;</span> <span class="nv">path</span> <span class="nv">desc</span><span class="p">))))</span></code></pre></div></li>

<li><p>One Option</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">org-link-set-parameters</span>
 <span class="s">&#34;latex-opt&#34;</span>
 <span class="nb">:follow</span> <span class="no">nil</span>
 <span class="nb">:export</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">path</span> <span class="nv">desc</span> <span class="nf">format</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="nf">format</span> <span class="ss">&#39;latex</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">desc-list</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">desc</span> <span class="s">&#34;;&#34;</span><span class="p">))</span>
                    <span class="p">(</span><span class="nv">opt</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">desc-list</span><span class="p">))</span>
                    <span class="p">(</span><span class="nv">arg</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">desc-list</span><span class="p">)))</span>
               <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\%s%s{%s}&#34;</span> <span class="nv">path</span>
                       <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;&#34;</span> <span class="nv">opt</span><span class="p">)</span> <span class="nv">opt</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;[%s]&#34;</span> <span class="nv">opt</span><span class="p">))</span>
                       <span class="nv">arg</span><span class="p">)))))</span></code></pre></div></li>

<li><p>One Option (After Main)</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">org-link-set-parameters</span>
 <span class="s">&#34;latex-opt-after&#34;</span>
 <span class="nb">:follow</span> <span class="no">nil</span>
 <span class="nb">:export</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">path</span> <span class="nv">desc</span> <span class="nf">format</span><span class="p">)</span>
           <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">eq</span> <span class="nf">format</span> <span class="ss">&#39;latex</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">desc-list</span> <span class="p">(</span><span class="nv">split-string</span> <span class="nv">desc</span> <span class="s">&#34;;&#34;</span><span class="p">))</span>
                    <span class="p">(</span><span class="nv">opt</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="nv">desc-list</span><span class="p">))</span>
                    <span class="p">(</span><span class="nv">arg</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">0</span> <span class="nv">desc-list</span><span class="p">)))</span>
               <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;\\%s{%s}%s&#34;</span> <span class="nv">path</span> <span class="nv">arg</span>
                       <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;&#34;</span> <span class="nv">opt</span><span class="p">)</span> <span class="nv">opt</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;[%s]&#34;</span> <span class="nv">opt</span><span class="p">)))))))</span></code></pre></div></li>
</ul></li>

<li><p>Export Classes</p>

<ul>
<li><p>Tufte-LaTeX</p>

<ul>
<li><p>Class Options</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;tufte-handout&#34;</span>
               <span class="s">&#34;\\documentclass[symmetric,nobib]{gm-tufte-handout}
</span><span class="s">   [NO-DEFAULT-PACKAGES]&#34;</span>
               <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
               <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)))</span></code></pre></div></li>
</ul></li>

<li><p>Assignment</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-latex</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;assignment&#34;</span>
                 <span class="s">&#34;\\documentclass[12pt]{article}
</span><span class="s">\\usepackage{uts-assignment}
</span><span class="s">\\renewcommand{\\maketitle}{}
</span><span class="s">[NO-DEFAULT-PACKAGES]
</span><span class="s">[EXTRA]&#34;</span>
                 <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubection*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\paragraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\paragraph*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subparagraph{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subparagraph*{%s}&#34;</span><span class="p">))))</span></code></pre></div></li>

<li><p>MLA</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-latex</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;gm-mla&#34;</span>
                 <span class="s">&#34;\\documentclass[12pt]{article}
</span><span class="s">\\usepackage{uts-mla}
</span><span class="s">\\renewcommand{\\maketitle}{}
</span><span class="s">\\renewcommand{\\tableofcontents}{}
</span><span class="s">[NO-DEFAULT-PACKAGES]
</span><span class="s">[EXTRA]&#34;</span>
                 <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubection*{%s}&#34;</span><span class="p">))))</span></code></pre></div></li>

<li><p>Notes</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">after!</span> <span class="nv">ox-latex</span> <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;org-latex-classes</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;gm-notes&#34;</span>
                 <span class="s">&#34;\\documentclass{gm-notes}
</span><span class="s">[NO-DEFAULT-PACKAGES]&#34;</span>
                 <span class="p">(</span><span class="s">&#34;\\section{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\section*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsection*{%s}&#34;</span><span class="p">)</span>
                 <span class="p">(</span><span class="s">&#34;\\subsubsection{%s}&#34;</span> <span class="o">.</span> <span class="s">&#34;\\subsubsection*{%s}&#34;</span><span class="p">))))</span></code></pre></div>
<p>We make this our default class.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-latex-default-class</span> <span class="s">&#34;gm-notes&#34;</span><span class="p">)</span></code></pre></div></li>
</ul></li>
</ul>

<h2 id="feeds"><span class="section-num">5</span> Feeds</h2>

<h3 id="mail">Mail</h3>

<p>Set up the requirements.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">notmuch</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">notmuch</span><span class="p">)</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;smtpmail</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;smtpmail-async</span><span class="p">)</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">nms-settings-file</span> <span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;network-security.data&#34;</span> <span class="nv">gmacs-cache-dir</span><span class="p">))</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">message-directory</span> <span class="s">&#34;~/mail/&#34;</span>
        <span class="nv">message-auto-save-directory</span> <span class="s">&#34;~/mail/draft&#34;</span>
        <span class="nv">message-fcc-dirs</span> <span class="s">&#34;~/mail/mbsyncmail/Sent Items&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">mail-user-agent</span> <span class="ss">&#39;message-user-agent</span>
        <span class="nv">user-mail-address</span> <span class="nv">gm/email</span>
        <span class="nf">user-full-name</span> <span class="s">&#34;Gautam Manohar&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">send-mail-function</span> <span class="nf">#&#39;</span><span class="nv">async-smtpmail-send-it</span>
        <span class="nv">message-send-mail-function</span> <span class="nf">#&#39;</span><span class="nv">async-smtpmail-send-it</span>
        <span class="nv">smtpmail-debug-info</span> <span class="no">t</span>
        <span class="nv">smtpmail-debug-verb</span> <span class="no">t</span>
        <span class="nv">smtpmail-stream-type</span> <span class="ss">&#39;starttls</span>
        <span class="nv">smtpmail-smtp-server</span> <span class="nv">gm/send-mail-server</span>
        <span class="nv">smtpmail-smtp-service</span> <span class="mi">587</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">notmuch-saved-searches</span>
        <span class="o">&#39;</span><span class="p">((</span><span class="nb">:name</span> <span class="s">&#34;inbox&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:unread&#34;</span> <span class="nb">:key</span> <span class="s">&#34;i&#34;</span> <span class="nb">:sort-order</span> <span class="nv">oldest-first</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;flagged&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:flagged&#34;</span> <span class="nb">:key</span> <span class="s">&#34;f&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;sent&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:sent&#34;</span> <span class="nb">:key</span> <span class="s">&#34;s&#34;</span> <span class="nb">:sort-order</span> <span class="nv">newest-first</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;drafts&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:draft&#34;</span> <span class="nb">:key</span> <span class="s">&#34;d&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;all mail&#34;</span> <span class="nb">:query</span> <span class="s">&#34;*&#34;</span> <span class="nb">:key</span> <span class="s">&#34;a&#34;</span> <span class="nb">:sort-order</span> <span class="nv">newest-first</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">message-kill-buffer-on-exit</span> <span class="no">t</span>
        <span class="nv">notmuch-address-command</span> <span class="ss">&#39;internal</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/compose-html-org</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="vg">*compose-html-org*</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">auto-fill-mode</span> <span class="mi">-1</span><span class="p">))</span>

  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-m&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/compose-html-org</span> <span class="nv">notmuch-message-mode-map</span><span class="p">))</span></code></pre></div>
<p>Set up the mail directory and draft location.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">message-directory</span> <span class="s">&#34;~/mail/&#34;</span>
      <span class="nv">message-auto-save-directory</span> <span class="s">&#34;~/mail/draft&#34;</span>
      <span class="nv">message-fcc-dirs</span> <span class="s">&#34;~/mail/mbsyncmail/Sent Items&#34;</span><span class="p">)</span></code></pre></div>
<p>Provide my email and name.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">mail-user-agent</span> <span class="ss">&#39;message-user-agent</span>
      <span class="nv">user-mail-address</span> <span class="nv">gm/email</span>
      <span class="nf">user-full-name</span> <span class="s">&#34;Gautam Manohar&#34;</span><span class="p">)</span></code></pre></div>
<p>SMTP for sending mail. The <code>stream-type</code> is important because I want my outgoing
mail to at least use TLS encryption. One day, though, I would like to adopt a
more rigorous system of encryption.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">send-mail-function</span> <span class="nf">#&#39;</span><span class="nv">async-smtpmail-send-it</span>
      <span class="nv">message-send-mail-function</span> <span class="nf">#&#39;</span><span class="nv">async-smtpmail-send-it</span>
      <span class="nv">smtpmail-debug-info</span> <span class="no">t</span>
      <span class="nv">smtpmail-debug-verb</span> <span class="no">t</span>
      <span class="nv">smtpmail-stream-type</span> <span class="ss">&#39;starttls</span>
      <span class="nv">smtpmail-smtp-server</span> <span class="nv">gm/send-mail-server</span>
      <span class="nv">smtpmail-smtp-service</span> <span class="mi">587</span><span class="p">)</span></code></pre></div>
<p>Some commonly used searches.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">notmuch-saved-searches</span>
      <span class="o">&#39;</span><span class="p">((</span><span class="nb">:name</span> <span class="s">&#34;inbox&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:unread&#34;</span> <span class="nb">:key</span> <span class="s">&#34;i&#34;</span> <span class="nb">:sort-order</span> <span class="nv">oldest-first</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;flagged&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:flagged&#34;</span> <span class="nb">:key</span> <span class="s">&#34;f&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;sent&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:sent&#34;</span> <span class="nb">:key</span> <span class="s">&#34;s&#34;</span> <span class="nb">:sort-order</span> <span class="nv">newest-first</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;drafts&#34;</span> <span class="nb">:query</span> <span class="s">&#34;tag:draft&#34;</span> <span class="nb">:key</span> <span class="s">&#34;d&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">:name</span> <span class="s">&#34;all mail&#34;</span> <span class="nb">:query</span> <span class="s">&#34;*&#34;</span> <span class="nb">:key</span> <span class="s">&#34;a&#34;</span> <span class="nb">:sort-order</span> <span class="nv">newest-first</span><span class="p">)))</span></code></pre></div>
<p>Nice stuff to have for sending mail.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">message-kill-buffer-on-exit</span> <span class="no">t</span>
      <span class="nv">notmuch-address-command</span> <span class="ss">&#39;internal</span><span class="p">)</span></code></pre></div>
<p>Most modern mail clients expect mail to be soft-wrapped. That is, the paragraph
conforms to the width of the viewer the person reading the mail is using, not to
the sender&rsquo;s preference of 80 characters or whatever it may be. However, when
sending mail, I still want the buffer to look as if it was hard-wrapped. Enter
<code>visual-fill-column-mode</code>. This mode works with <code>visual-line-mode</code> to wrap the
paragraph not at the window edge but at <code>fill-column</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">visual-fill-column</span>
  <span class="nb">:commands</span> <span class="nv">visual-fill-column-mode</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">notmuch-message-mode</span> <span class="o">.</span> <span class="nv">visual-fill-column-mode</span><span class="p">)</span>
  <span class="nb">:config</span> <span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;text-scale-adjust</span> <span class="nb">:after</span>
                      <span class="nf">#&#39;</span><span class="nv">visual-fill-column-adjust</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;notmuch-message-mode-hook</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span> <span class="p">(</span><span class="nv">auto-fill-mode</span> <span class="mi">-1</span><span class="p">))))</span></code></pre></div>
<p>Accessing mail. When we first open up <code>notmuch</code>, I want to start a system script
that checks for new mail periodically.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/open-mail</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">notmuch</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">notmuch-refresh-this-buffer</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c m&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/open-mail</span><span class="p">)</span></code></pre></div>
<h4 id="html-mail">HTML Mail</h4>

<p>This code from <a href="http://kitchingroup.cheme.cmu.edu/blog/category/orgmode/4/">John Kitchin</a> lets you write mail in Org Mode and send it
formatted as HTML. This is incredibly powerful, because you can include syntax
highlighted code, LaTeX math images, and even the image output of Babel blocks,
all composed in plain text with Org Mode. Unfortunately, when I first set up
this process, I received an error when trying to send HTML mail with LaTeX math
in it (the desired <code>.png</code> was not produced and I had to adjust <code>imagemagick</code> as
apart of <code>org-preview-latex-process-alist</code>). Investigating the <code>.log</code> files showed
that the issue was not with <code>pdflatex</code> (and indeed a proper PDF was
produced). In fact, the issue was with ImageMagick, which did not have the
proper permissions to do its job on PDF files. Here&rsquo;s the fix:</p>

<p>Find <code>/etc/ImageMagick-7/policy.xml</code>. Change</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">policy</span> <span class="na">domain</span><span class="o">=</span><span class="s">&#34;coder&#34;</span> <span class="na">rights</span><span class="o">=</span><span class="s">&#34;none&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;PDF&#34;</span> <span class="p">/&gt;</span></code></pre></div>
<p>to</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">policy</span> <span class="na">domain</span><span class="o">=</span><span class="s">&#34;coder&#34;</span> <span class="na">rights</span><span class="o">=</span><span class="s">&#34;read|write&#34;</span> <span class="na">pattern</span><span class="o">=</span><span class="s">&#34;PDF&#34;</span> <span class="p">/&gt;</span></code></pre></div>
<p>Looking at the <code>rights</code> field makes it clear that the permissions were off.</p>

<p>Now for the Emacs setup. This library converts Org into HTML.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">require</span> <span class="ss">&#39;org-mime</span><span class="p">)</span></code></pre></div>
<p>Then we give ourselves a way to activate Org Mode mail.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/compose-html-org</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="vg">*compose-html-org*</span> <span class="no">t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">org-mode</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">auto-fill-mode</span> <span class="mi">-1</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;M-m&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/compose-html-org</span> <span class="nv">notmuch-message-mode-map</span><span class="p">)</span></code></pre></div>
<p>Let&rsquo;s define a function to send the mail.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/org-htmlize-and-send</span> <span class="p">()</span>
  <span class="s">&#34;When composing an Org HTML message, htmlize and send it.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="vg">*compose-html-org*</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="vg">*compose-html-org*</span> <span class="no">nil</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">notmuch-message-mode</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">org-mime-htmlize</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">notmuch-mua-send-and-exit</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-ctrl-c-ctrl-c-hook</span> <span class="ss">&#39;gm/org-htmlize-and-send</span> <span class="no">t</span><span class="p">)</span></code></pre></div>
<p>If we&rsquo;re sending HTML, we might as well make it pretty. Let&rsquo;s nicely offset
block quotes.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-mime-html-hook</span>
          <span class="p">(</span><span class="nb">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">org-mime-change-element-style</span>
             <span class="s">&#34;blockquote&#34;</span> <span class="s">&#34;border-left: 2px solid gray; padding-left: 4px;&#34;</span><span class="p">)))</span></code></pre></div>
<p>We definitely don&rsquo;t want to export the table of contents or section numbers.
It&rsquo;s an email, not an essay.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">org-mime-export-options</span> <span class="o">&#39;</span><span class="p">(</span><span class="nb">:section-numbers</span> <span class="no">nil</span>
                                <span class="nb">:with-author</span> <span class="no">nil</span>
                                <span class="nb">:with-toc</span> <span class="no">nil</span><span class="p">))</span></code></pre></div>
<h3 id="elfeed">Elfeed</h3>

<p>Elfeed is a feed manager for Emacs. It lets me manage YouTube subscriptions and
other forms of media, such as blogs. I plan to also use it for academic articles
when the need arises. Many of the snippets (tagged <code>bjm/</code>) I use here was written
by the author of <a href="http://pragmaticemacs.com">Pragmatic Emacs</a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;elfeed</span> <span class="s">&#34;elfeed&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;elfeed-db-load</span> <span class="s">&#34;elfeed&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">elfeed-db-directory</span> <span class="s">&#34;~/.emacs.d/.elfeed&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">after!</span> <span class="nv">elfeed</span>
  <span class="p">(</span><span class="nv">bind-keys</span> <span class="nb">:map</span> <span class="nv">elfeed-search-mode-map</span>
             <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="o">.</span> <span class="nv">bjm/elfeed-save-db-and-bury</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="o">.</span> <span class="nv">gm/elfeed-hydra/body</span><span class="p">)</span>
             <span class="p">(</span><span class="s">&#34;*&#34;</span> <span class="o">.</span> <span class="nv">gm/elfeed-toggle-star</span><span class="p">)</span>
             <span class="p">([</span><span class="nv">remap</span> <span class="nv">elfeed-search-live-filter</span><span class="p">]</span>
              <span class="o">.</span> <span class="nv">bjm/elfeed-search-live-filter-space</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">push</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">starred</span> <span class="nv">elfeed-search-starred-title-face</span><span class="p">)</span> <span class="nv">elfeed-search-face-alist</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/elfeed-visit-or-play-with-mpv</span> <span class="nv">elfeed-show-mode-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/elfeed-visit-or-play-with-mpv</span> <span class="nv">elfeed-search-mode-map</span><span class="p">))</span></code></pre></div>
<p>By default, <code>elfeed</code> stores the feeds it should compile in an elisp file. But Org
is easier.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">autoload</span> <span class="ss">&#39;elfeed-org</span> <span class="s">&#34;elfeed-org&#34;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">elfeed-org</span><span class="p">)</span>
<span class="p">(</span><span class="nb">setq</span> <span class="nv">rmh-elfeed-org-files</span>
      <span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="nf">expand-file-name</span> <span class="s">&#34;elfeed.org&#34;</span> <span class="nv">org-directory</span><span class="p">)))</span></code></pre></div>
<h4 id="launching">Launching</h4>

<p>We want to make sure <code>elfeed</code> reads from the disk before it launches. This makes
our <code>.elfeed</code> easier to synchronize across machines.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/elfeed-load-db-and-open</span> <span class="p">()</span>
  <span class="s">&#34;Wrapper to load the elfeed db from disk before opening&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elfeed-db-load</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elfeed</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elfeed-search-update--force</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/elfeed-save-db-and-bury</span> <span class="p">()</span>
  <span class="s">&#34;Wrapper to save the elfeed db to disk before burying buffer&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elfeed-db-save</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">quit-window</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;C-c e&#34;</span> <span class="nf">#&#39;</span><span class="nv">bjm/elfeed-load-db-and-open</span><span class="p">)</span></code></pre></div>
<h4 id="improvements">Improvements</h4>

<p>It&rsquo;s nice to have a way to star content for future reference.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/elfeed-toggle-star</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">elfeed-search-toggle-all</span> <span class="ss">&#39;starred</span><span class="p">))</span></code></pre></div>
<p>Then we add a visual indicator.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defface</span> <span class="nv">elfeed-search-starred-title-face</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="no">t</span> <span class="nb">:foreground</span> <span class="s">&#34;#f77&#34;</span><span class="p">))</span>
  <span class="s">&#34;Marks a starred Elfeed entry.&#34;</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">push</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">starred</span> <span class="nv">elfeed-search-starred-title-face</span><span class="p">)</span> <span class="nv">elfeed-search-face-alist</span><span class="p">)</span></code></pre></div>
<p><a href="http://pragmaticemacs.com/emacs/a-tweak-to-elfeed-filtering/">Life is too short to type extra spaces.</a></p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">bjm/elfeed-search-live-filter-space</span> <span class="p">()</span>
  <span class="s">&#34;Insert space when running elfeed filter&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">elfeed-search-filter</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">elfeed-search-filter</span> <span class="s">&#34; &#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">elfeed-search-live-filter</span><span class="p">)))</span></code></pre></div>
<h4 id="consuming-media">Consuming Media</h4>

<p>When reading articles in <code>elfeed-show-mode</code>, the content spans the entire buffer.
I like to read my content hard-wrapped at 80 chars, so I customize the built-in
<code>shr-width</code> (&ldquo;Simple HTML Renderer,&rdquo; which is what Elfeed uses).</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">setq</span> <span class="nv">shr-width</span> <span class="mi">80</span><span class="p">)</span></code></pre></div>
<p>For YouTube videos, I like to play them right from Emacs with <code>mpv</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/elfeed-mpv-patterns</span>
  <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;youtu\\.?be&#34;</span><span class="p">)</span>
  <span class="s">&#34;List of regexp to match against elfeed entry link to know
</span><span class="s">whether to use mpv to visit the link.&#34;</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/elfeed-play-with-mpv</span> <span class="p">()</span>
  <span class="s">&#34;Play entry link with mpv.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">entry</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;elfeed-show-mode</span><span class="p">)</span>
                   <span class="nv">elfeed-show-entry</span>
                 <span class="p">(</span><span class="nv">elfeed-search-selected</span> <span class="nb">:single</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">message</span> <span class="s">&#34;Opening %s with mpv...&#34;</span> <span class="p">(</span><span class="nv">elfeed-entry-link</span> <span class="nv">entry</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">start-process</span> <span class="s">&#34;elfeed-mpv&#34;</span> <span class="no">nil</span> <span class="s">&#34;mpv&#34;</span> <span class="s">&#34;--fs&#34;</span> <span class="p">(</span><span class="nv">elfeed-entry-link</span> <span class="nv">entry</span><span class="p">))))</span></code></pre></div>
<p>We make a multi-purpose function to open the link with <code>mpv</code> if it is a video,
otherwise with the browser.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/elfeed-visit-or-play-with-mpv</span> <span class="p">()</span>
  <span class="s">&#34;Play in mpv if entry link matches </span><span class="ss">`gm/elfeed-mpv-patterns&#39;</span><span class="s">, visit otherwise.
</span><span class="s">See </span><span class="ss">`gm/elfeed-play-with-mpv&#39;</span><span class="s">.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">entry</span> <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;elfeed-show-mode</span><span class="p">)</span>
                   <span class="nv">elfeed-show-entry</span>
                 <span class="p">(</span><span class="nv">elfeed-search-selected</span> <span class="nb">:single</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">patterns</span> <span class="nv">gm/elfeed-mpv-patterns</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nb">and</span> <span class="nv">patterns</span>
                <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">string-match</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">gm/elfeed-mpv-patterns</span><span class="p">)</span>
                                   <span class="p">(</span><span class="nv">elfeed-entry-link</span> <span class="nv">entry</span><span class="p">))))</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">patterns</span> <span class="p">(</span><span class="nf">cdr</span> <span class="nv">patterns</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">if</span> <span class="nv">patterns</span>
        <span class="p">(</span><span class="nv">gm/elfeed-play-with-mpv</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;elfeed-search-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">elfeed-search-browse-url</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">elfeed-show-visit</span><span class="p">)))))</span></code></pre></div>
<p>I don&rsquo;t want Firefox stealing the focus, because I like opening many links from
Emacs, then switching to Firefox to read them all. To fix this, I toggle
<code>browser.tabs.loadDivertedInBackground</code> to <code>true</code>, as per <a href="https://stackoverflow.com/questions/10506496/run-browse-url-in-emacs-without-giving-focus-to-the-browser">this SO post</a>.
We bind it to <code>o</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/elfeed-visit-or-play-with-mpv</span> <span class="nv">elfeed-show-mode-map</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;o&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/elfeed-visit-or-play-with-mpv</span> <span class="nv">elfeed-search-mode-map</span><span class="p">)</span></code></pre></div>
<h4 id="hydra-1">Hydra</h4>

<p>I use a hydra to easily navigate between groups of feeds.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">gm/elfeed-hydra</span> <span class="p">()</span>
  <span class="s">&#34;filter&#34;</span>
  <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago&#34;</span><span class="p">)</span> <span class="s">&#34;All&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;c&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +cs&#34;</span><span class="p">)</span> <span class="s">&#34;CS&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +emacs&#34;</span><span class="p">)</span> <span class="s">&#34;Emacs&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;*&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@6-months-ago +starred&#34;</span><span class="p">)</span> <span class="s">&#34;Starred&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="p">(</span><span class="nv">elfeed-search-set-filter</span> <span class="s">&#34;@1-day-ago&#34;</span><span class="p">)</span> <span class="s">&#34;Today&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;M&#34;</span> <span class="nv">gm/elfeed-toggle-star</span> <span class="s">&#34;Mark&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;Q&#34;</span> <span class="nv">bjm/elfeed-save-db-and-bury</span> <span class="s">&#34;Quit Elfeed&#34;</span> <span class="nb">:color</span> <span class="nv">blue</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="no">nil</span> <span class="s">&#34;quit&#34;</span> <span class="nb">:color</span> <span class="nv">blue</span><span class="p">))</span></code></pre></div>
<h2 id="snippets"><span class="section-num">6</span> Snippets</h2>

<p>I use <code>SPC</code> instead of the default <code>TAB</code> to expand snippets. I find this more
convenient, because it makes typing a snippet more like typing a word. This
works fine apart from one hiccup. We need to bind <code>TAB</code> to <code>org-cycle</code> (even though
that is the default in Org Mode). Otherwise, binding <code>TAB</code> to <code>nil</code> in
<code>yas-minor-mode</code> overrides the default behaviour.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">use-package</span> <span class="nv">yasnippet</span>
  <span class="nb">:commands</span> <span class="p">(</span><span class="nv">yas-minor-mode</span> <span class="nv">yas-global-mode</span><span class="p">)</span>
  <span class="nb">:config</span>
  <span class="p">(</span><span class="nv">yas-global-mode</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;&lt;tab&gt;&#34;</span> <span class="no">nil</span> <span class="nv">yas-minor-mode-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">bind-key</span> <span class="s">&#34;TAB&#34;</span> <span class="no">nil</span> <span class="nv">yas-minor-mode-map</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">define-key</span> <span class="nv">yas-minor-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;SPC&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">bound-and-true-p</span> <span class="nv">yas-maybe-expand</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">yas-expand</span><span class="p">))</span>
  <span class="nb">:custom</span>
  <span class="p">(</span><span class="nv">yas-triggers-in-field</span> <span class="no">t</span><span class="p">)</span> <span class="c1">; expand snippets within snippets</span>
  <span class="p">(</span><span class="nv">yas-snippet-dirs</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;~/.emacs.d/snippets&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">yas-global-mode</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">diminish</span> <span class="ss">&#39;yas-minor-mode</span> <span class="s">&#34; ✂&#34;</span><span class="p">)</span></code></pre></div>
<h3 id="quickmath">QuickMath</h3>

<p>I use a hydra for snippets that just insert/replace text in math mode and thus
don&rsquo;t require the use of <code>yasnippets</code>.</p>

<h4 id="math-symbols">Math Symbols</h4>

<ul>
<li><p>Main Math Snippets</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/math-snippets</span>
  <span class="o">&#39;</span><span class="p">((</span><span class="s">&#34;==&#34;</span> <span class="s">&#34;&amp;= &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;=&gt;&#34;</span> <span class="s">&#34;\\implies &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;CC&#34;</span> <span class="s">&#34;\\C&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;LL&#34;</span> <span class="s">&#34;\\mathcal{L}&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;MM&#34;</span> <span class="s">&#34;\\mathcal{M}&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;NN&#34;</span> <span class="s">&#34;\\N&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;QQ&#34;</span> <span class="s">&#34;\\Q&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;RR&#34;</span> <span class="s">&#34;\\R&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ZZ&#34;</span> <span class="s">&#34;\\Z&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;[&#34;</span> <span class="s">&#34;square-brackets&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;^&#34;</span> <span class="s">&#34;superscript&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;_&#34;</span> <span class="s">&#34;subscript&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;abs&#34;</span> <span class="s">&#34;abs&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;acos&#34;</span> <span class="s">&#34;\\arccos &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;acot&#34;</span> <span class="s">&#34;\\arccot&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;aleph&#34;</span> <span class="s">&#34;\\aleph&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;asin&#34;</span> <span class="s">&#34;\\arcsin &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;atan&#34;</span> <span class="s">&#34;\\arctan &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;bigop&#34;</span> <span class="s">&#34;big-operator&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;binom&#34;</span> <span class="s">&#34;choose&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;bol&#34;</span> <span class="s">&#34;bol&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cb&#34;</span> <span class="s">&#34;^3&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cc&#34;</span> <span class="s">&#34;\\subset &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ceil&#34;</span> <span class="s">&#34;ceiling&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cong&#34;</span> <span class="s">&#34;\\equiv&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cos&#34;</span> <span class="s">&#34;\\cos &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cot&#34;</span> <span class="s">&#34;\\cot &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;cu&#34;</span> <span class="s">&#34;\\Curl &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;dd&#34;</span> <span class="s">&#34;derivative-one-term&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;del&#34;</span> <span class="s">&#34;partial&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;det&#34;</span> <span class="s">&#34;determinant&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;dim&#34;</span> <span class="s">&#34;\\Dim &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;dint&#34;</span> <span class="s">&#34;dintegral&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;div&#34;</span> <span class="s">&#34;\\Div &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;dv&#34;</span> <span class="s">&#34;derivative&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;eq&#34;</span> <span class="s">&#34; = &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;exp&#34;</span> <span class="s">&#34;\\exp &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;fa&#34;</span> <span class="s">&#34;\\forall &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;fl&#34;</span> <span class="s">&#34;floor&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;fr&#34;</span> <span class="s">&#34;frac&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;fun&#34;</span> <span class="s">&#34;function&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ge&#34;</span> <span class="s">&#34;\\ge &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;gr&#34;</span> <span class="s">&#34;\\Grad &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;iint&#34;</span> <span class="s">&#34;iintegral&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;im&#34;</span> <span class="s">&#34;\\Image &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;inf&#34;</span> <span class="s">&#34;\\Inf &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;inn&#34;</span> <span class="s">&#34;in&#34;</span> <span class="s">&#34;\\in &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;int&#34;</span> <span class="s">&#34;integral&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;inv&#34;</span> <span class="s">&#34;inverse&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;iso&#34;</span> <span class="s">&#34;\\Iso &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ker&#34;</span> <span class="s">&#34;\\Ker &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;lap&#34;</span> <span class="s">&#34;laplacian&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;le&#34;</span> <span class="s">&#34;\\le &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;lim&#34;</span> <span class="s">&#34;limit&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;list&#34;</span> <span class="s">&#34;list&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ln&#34;</span> <span class="s">&#34;\\ln &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;log&#34;</span> <span class="s">&#34;\\log &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;lr9&#34;</span> <span class="s">&#34;parentheses&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;lr[&#34;</span> <span class="s">&#34;brackets&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;lr{&#34;</span> <span class="s">&#34;set&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;mp&#34;</span> <span class="s">&#34;\\mp &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;nabl&#34;</span> <span class="s">&#34;\\nabla &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ndd&#34;</span> <span class="s">&#34;nth-derivative&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ndv&#34;</span> <span class="s">&#34;nth-differential&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;neq&#34;</span> <span class="s">&#34;neq&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;norm&#34;</span> <span class="s">&#34;norm&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;npd&#34;</span> <span class="s">&#34;nth-pderivative&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;npv&#34;</span> <span class="s">&#34;nth-pdifferential&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;nsq&#34;</span> <span class="s">&#34;nsqrt&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;o+&#34;</span> <span class="s">&#34;\\oplus &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;oint&#34;</span> <span class="s">&#34;ointegral&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;oo&#34;</span> <span class="s">&#34;\\infty&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;opl&#34;</span> <span class="s">&#34;\\oplus &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ox&#34;</span> <span class="s">&#34;\\otimes &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;part&#34;</span> <span class="s">&#34;partial&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;pd&#34;</span> <span class="s">&#34;partial&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;pm&#34;</span> <span class="s">&#34;\\pm &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;prod&#34;</span> <span class="s">&#34;product&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;prop&#34;</span> <span class="s">&#34;\\propto &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;ps&#34;</span> <span class="s">&#34;pairsum&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;psum&#34;</span> <span class="s">&#34;pairsum&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;pv&#34;</span> <span class="s">&#34;partial-derivative&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sec&#34;</span> <span class="s">&#34;\\sec &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;seq&#34;</span> <span class="s">&#34;sequence&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;set&#34;</span> <span class="s">&#34;set&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sim&#34;</span> <span class="s">&#34;\\sim &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sin&#34;</span> <span class="s">&#34;\\sin &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;span&#34;</span> <span class="s">&#34;\\Span&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sq&#34;</span> <span class="s">&#34;sqrt&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sr&#34;</span> <span class="s">&#34;^2&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;st&#34;</span> <span class="s">&#34;: &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;star&#34;</span> <span class="s">&#34;^\\star &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sum&#34;</span> <span class="s">&#34;sum&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;sup&#34;</span> <span class="s">&#34;\\Sup &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;tan&#34;</span> <span class="s">&#34;\\tan &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;then&#34;</span> <span class="s">&#34;\\implies &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;to&#34;</span> <span class="s">&#34;\\to &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;tr&#34;</span> <span class="s">&#34;trace&#34;</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;vv&#34;</span> <span class="s">&#34;\\vec &#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;xi&#34;</span> <span class="s">&#34;x_i&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&#34;xx&#34;</span> <span class="s">&#34;\\times &#34;</span><span class="p">)))</span></code></pre></div></li>

<li><p>Hydras</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-semicolon-a</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:idle</span> <span class="mf">1.0</span> <span class="nb">:columns</span> <span class="mi">8</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;;&#34;</span> <span class="nv">hydra-semicolon-b/body</span> <span class="s">&#34;Level 2&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;SPC&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;; &#34;</span><span class="p">)</span> <span class="s">&#34;;&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;a&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\alpha&#34;</span><span class="p">)</span> <span class="s">&#34;α&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\forall &#34;</span><span class="p">)</span> <span class="s">&#34;∀&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;b&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\beta&#34;</span><span class="p">)</span> <span class="s">&#34;β&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;C&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{C}&#34;</span><span class="p">)</span> <span class="s">&#34;ℂ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;d&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\delta&#34;</span><span class="p">)</span> <span class="s">&#34;δ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;D&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Delta&#34;</span><span class="p">)</span> <span class="s">&#34;Δ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\epsilon&#34;</span><span class="p">)</span> <span class="s">&#34;ε&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;E&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\exists &#34;</span><span class="p">)</span> <span class="s">&#34;∃&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varphi&#34;</span><span class="p">)</span> <span class="s">&#34;φ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;F&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Phi&#34;</span><span class="p">)</span> <span class="s">&#34;Φ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;g&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\gamma&#34;</span><span class="p">)</span> <span class="s">&#34;γ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;G&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Gamma&#34;</span><span class="p">)</span> <span class="s">&#34;Γ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;h&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\eta&#34;</span><span class="p">)</span> <span class="s">&#34;η&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;k&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\kappa&#34;</span><span class="p">)</span> <span class="s">&#34;κ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\lambda&#34;</span><span class="p">)</span> <span class="s">&#34;λ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;L&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Lambda&#34;</span><span class="p">)</span> <span class="s">&#34;Λ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;m&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mu&#34;</span><span class="p">)</span> <span class="s">&#34;µ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;n&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\nu&#34;</span><span class="p">)</span> <span class="s">&#34;ν&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;N&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\nabla &#34;</span><span class="p">)</span> <span class="s">&#34;∇&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;o&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\omega&#34;</span><span class="p">)</span> <span class="s">&#34;ω&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;O&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Omega&#34;</span><span class="p">)</span> <span class="s">&#34;Ω&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;p&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\pi&#34;</span><span class="p">)</span> <span class="s">&#34;π&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;P&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Pi&#34;</span><span class="p">)</span> <span class="s">&#34;Π&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\theta&#34;</span><span class="p">)</span> <span class="s">&#34;θ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;Q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{Q}&#34;</span><span class="p">)</span> <span class="s">&#34;ℚ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\rho&#34;</span><span class="p">)</span> <span class="s">&#34;ρ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;R&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{R}&#34;</span><span class="p">)</span> <span class="s">&#34;ℝ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;s&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\sigma&#34;</span><span class="p">)</span> <span class="s">&#34;σ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;t&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\tau&#34;</span><span class="p">)</span> <span class="s">&#34;τ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;u&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\upsilon&#34;</span><span class="p">)</span> <span class="s">&#34;υ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;U&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cup &#34;</span><span class="p">)</span> <span class="s">&#34;∪&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;v&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\vec &#34;</span><span class="p">)</span> <span class="s">&#34;v&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;w&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\xi&#34;</span><span class="p">)</span> <span class="s">&#34;ξ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;W&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Xi&#34;</span><span class="p">)</span> <span class="s">&#34;Ξ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;x&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\chi&#34;</span><span class="p">)</span> <span class="s">&#34;χ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;y&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\psi&#34;</span><span class="p">)</span> <span class="s">&#34;ψ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;Y&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Psi&#34;</span><span class="p">)</span> <span class="s">&#34;Ψ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;z&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\zeta&#34;</span><span class="p">)</span> <span class="s">&#34;ζ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;Z&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{Z}&#34;</span><span class="p">)</span> <span class="s">&#34;ℤ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;0&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\emptyset&#34;</span><span class="p">)</span> <span class="s">&#34;∅&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;8&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\infinity&#34;</span><span class="p">)</span> <span class="s">&#34;∞&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;!&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\neg&#34;</span><span class="p">)</span> <span class="s">&#34;¬&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;*&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\star&#34;</span><span class="p">)</span> <span class="s">&#34;⋆&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;\\&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\setminus &#34;</span><span class="p">)</span> <span class="s">&#34;∖&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;&#39;&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\prime &#34;</span><span class="p">)</span> <span class="s">&#34;′&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;,&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;,\\ldots,&#34;</span><span class="p">)</span> <span class="s">&#34;.&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cdot &#34;</span><span class="p">)</span> <span class="s">&#34;·&#34;</span><span class="p">))</span>

<span class="p">(</span><span class="nv">defhydra</span> <span class="nv">hydra-semicolon-b</span> <span class="p">(</span><span class="nb">:color</span> <span class="nv">blue</span> <span class="nb">:idle</span> <span class="mf">1.0</span> <span class="nb">:columns</span> <span class="mi">8</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;;&#34;</span> <span class="nv">hydra-semicolon-a/body</span> <span class="s">&#34;base&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34; &#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;; &#34;</span> <span class="s">&#34;semicolon&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="s">&#34;A&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\aleph&#34;</span><span class="p">)</span> <span class="s">&#34;ℵ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;e&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varepsilon&#34;</span><span class="p">)</span> <span class="s">&#34;ε&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;f&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\phi&#34;</span><span class="p">)</span> <span class="s">&#34;φ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;F&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\mathbb{F}&#34;</span><span class="p">)</span> <span class="s">&#34;𝔽&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;l&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\ell&#34;</span><span class="p">)</span> <span class="s">&#34;ℓ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;q&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\Theta&#34;</span><span class="p">)</span> <span class="s">&#34;Θ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;r&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\varrho&#34;</span><span class="p">)</span> <span class="s">&#34;ρ&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;U&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\cap &#34;</span><span class="p">)</span> <span class="s">&#34;∩&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;x&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\times &#34;</span><span class="p">)</span> <span class="s">&#34;×&#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="s">&#34;.&#34;</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\cdots &#34;</span><span class="p">)</span> <span class="s">&#34;···&#34;</span><span class="p">))</span></code></pre></div>
<p>Then we bind this to semicolon.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;;&#34;</span> <span class="nf">#&#39;</span><span class="nv">hydra-semicolon-a/body</span><span class="p">)</span></code></pre></div></li>
</ul>

<h4 id="helper-functions">Helper Functions</h4>

<ul>
<li><p>QuickMath Minor Mode</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/math-mode-map</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">map</span> <span class="p">(</span><span class="nf">make-sparse-keymap</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">set-keymap-parent</span> <span class="nv">map</span> <span class="nv">org-mode-map</span><span class="p">)</span>
    <span class="nv">map</span><span class="p">))</span>

<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;;&#34;</span> <span class="nf">#&#39;</span><span class="nv">hydra-semicolon-a/body</span><span class="p">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">quick-math--add-keymap-to-math-fragments</span> <span class="p">(</span><span class="nv">limit</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">case-fold-search</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="p">(</span><span class="nf">nth</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">assoc</span> <span class="s">&#34;\\(&#34;</span> <span class="nv">org-latex-regexps</span><span class="p">))</span> <span class="nv">limit</span> <span class="no">t</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">beg</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">progn</span>
          <span class="p">(</span><span class="nf">add-text-properties</span>
           <span class="nv">beg</span> <span class="nv">end</span> <span class="o">`</span><span class="p">(</span><span class="nv">local-map</span> <span class="o">,</span><span class="nv">gm/math-mode-map</span><span class="p">)))))))</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">define-minor-mode</span> <span class="nv">quick-math-mode</span>
  <span class="s">&#34;Minor mode for math&#34;</span>
  <span class="nb">:init-value</span> <span class="no">nil</span>
  <span class="p">(</span><span class="nb">if</span> <span class="nv">quick-math-mode</span>
      <span class="p">(</span><span class="nb">progn</span>
        <span class="p">(</span><span class="nv">gm/math-setup</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;org-font-lock-hook</span> <span class="nf">#&#39;</span><span class="nv">quick-math--add-keymap-to-math-fragments</span> <span class="no">t</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">&#39;font-lock-extra-managed-props</span> <span class="ss">&#39;local-map</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">remove-hook</span> <span class="ss">&#39;org-font-lock-hook</span> <span class="nf">#&#39;</span><span class="nv">quick-math--add-keymap-to-math-fragments</span><span class="p">))</span>
  <span class="p">(</span><span class="nf">call-interactively</span> <span class="nf">#&#39;</span><span class="nv">font-lock-fontify-buffer</span><span class="p">))</span></code></pre></div></li>

<li><p>Simpler <code>texmathp</code></p>

<p>The default <code>texmathp</code> function assumes that you are writing valid LaTeX code.
This is all well and good when you are actually writing LaTeX, where things like
the dollar sign have only one meaning, but I write documents almost entirely in
Org Mode (I export them to LaTeX). Here the function easily gets confused. So I
make my own for checking if you are in math mode, which just looks at the
surrounding paragraph. We first make a list of math environments that our
function will look for.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/math-environments</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&#34;equation&#34;</span> <span class="s">&#34;align&#34;</span><span class="p">)</span>
  <span class="s">&#34;The environments </span><span class="ss">`gm/in-math-p&#39;</span><span class="s"> assumes as valid math environments.&#34;</span><span class="p">)</span></code></pre></div>
<p>The idea is that we search the region from the beginning of the paragraph to the
point for delimiters for inline math (<code>\(</code> and <code>\)</code>) and display math (<code>\begin{ENV}</code>
and <code>\end{ENV}</code>, where <code>ENV</code> is an element of <code>gm/math-environments</code>). The one
subtlety is that we also look at the starred versions of <code>ENV</code>. If there are more
open delimiters than closed delimiters, then the point must be inside a math
block, and so we return true.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/in-math-p</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/--in-math-p</span> <span class="p">(</span><span class="nv">begin-delim</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">concat</span> <span class="nv">begin-delim</span> <span class="p">(</span><span class="nv">regexp-opt</span> <span class="nv">gm/math-environments</span><span class="p">)</span> <span class="s">&#34;[\\*]?}&#34;</span><span class="p">))</span>
  <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">begin</span> <span class="p">(</span><span class="nb">save-excursion</span>
                  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;org-mode</span><span class="p">)</span>
                      <span class="p">(</span><span class="nv">org-backward-paragraph</span><span class="p">)</span>
                    <span class="p">(</span><span class="nv">backward-paragraph</span><span class="p">))</span>
                  <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
         <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">inline-open</span> <span class="p">(</span><span class="nv">how-many</span> <span class="s">&#34;\\\\(&#34;</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">inline-close</span> <span class="p">(</span><span class="nv">how-many</span> <span class="s">&#34;\\\\)&#34;</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">env-open</span> <span class="p">(</span><span class="nv">how-many</span> <span class="p">(</span><span class="nv">gm/--in-math-p</span> <span class="s">&#34;\\\\begin{&#34;</span><span class="p">)</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">))</span>
         <span class="p">(</span><span class="nv">env-close</span> <span class="p">(</span><span class="nv">how-many</span> <span class="p">(</span><span class="nv">gm/--in-math-p</span> <span class="s">&#34;\\\\end{&#34;</span><span class="p">)</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">inline-open</span> <span class="nv">inline-close</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">env-open</span> <span class="nv">env-close</span><span class="p">)</span> <span class="mi">0</span><span class="p">))))</span></code></pre></div></li>

<li><p>Enter Math Mode</p>

<p>Enter a math fragment if inside one, exit otherwise. We keep track of the number
of blank lines that follow the fragment, because according to Org, an <code>equation</code>
environment doesn&rsquo;t end until the first non-newline character that follows. This
makes for some awkward timing for activating previews.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/create-or-exit-math-fragment</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">gm/in-math-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">fr</span> <span class="p">(</span><span class="nv">org-element-context</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:end</span> <span class="nv">fr</span><span class="p">))</span>
            <span class="p">(</span><span class="nv">post-blank</span> <span class="p">(</span><span class="nv">org-element-property</span> <span class="nb">:post-blank</span> <span class="nv">fr</span><span class="p">)))</span>
        <span class="p">(</span><span class="nf">goto-char</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">end</span> <span class="nv">post-blank</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\(&#34;</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">save-excursion</span> <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\\)&#34;</span><span class="p">))))</span></code></pre></div></li>

<li><p>Last n Characters Before Point</p>

<p>Return the last n characters before the point, or <code>loc</code> if provided.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/last-n-chars</span> <span class="p">(</span><span class="nv">n</span> <span class="kp">&amp;optional</span> <span class="nv">loc</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="nv">loc</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">loc</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">start</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">loc</span> <span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">&gt;=</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">))</span>
               <span class="p">(</span><span class="nf">&lt;=</span> <span class="nv">start</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">loc</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">loc</span><span class="p">))))</span></code></pre></div></li>

<li><p>Test if LaTeX Needs to Be Wrapped in Brackets</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-expression-p</span> <span class="p">(</span><span class="nv">math</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="nv">math</span>
    <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">eq</span> <span class="p">(</span><span class="nf">length</span> <span class="nv">math</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">;; match one single latex command, with opt-args and args</span>
        <span class="c1">;; such as \command[1][2]{3}{4}</span>
        <span class="c1">;; only validate if this is the entire string</span>
        <span class="p">(</span><span class="nf">string-match</span> <span class="s">&#34;\\`\\\\[[:alpha:]]+\\(\\[[^\\]]*]\\)*\\({[^}]*}\\)*\\&#39;&#34;</span> <span class="nv">math</span><span class="p">))))</span></code></pre></div></li>

<li><p>Increment Snippet Fields</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/increment-snippet-fields</span> <span class="p">(</span><span class="nf">string</span> <span class="kp">&amp;optional</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="nv">n</span> <span class="p">(</span><span class="nb">setq</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">replace-regexp-in-string</span> <span class="s">&#34;[1-9]+&#34;</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%d&#34;</span> <span class="p">(</span><span class="nf">+</span> <span class="nv">n</span> <span class="p">(</span><span class="nf">string-to-number</span> <span class="nv">x</span><span class="p">))))</span> <span class="nf">string</span><span class="p">))</span></code></pre></div></li>

<li><p>Generate Snippets</p>

<p>I wrote this to reduce the amount of redundant code needed to set up the
snippets. First, we create a suffix tree of all the math snippets.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defvar</span> <span class="nv">gm/longest-snippet</span><span class="p">)</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-setup</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">setq</span> <span class="nv">gm/longest-snippet</span>
        <span class="p">(</span><span class="nf">cons</span> <span class="p">(</span><span class="nv">-max</span> <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">it</span><span class="p">))</span> <span class="nv">gm/math-snippets</span><span class="p">))</span>
              <span class="p">(</span><span class="nv">-max</span> <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">it</span><span class="p">))</span> <span class="nv">gm/math-snippets</span><span class="p">))))</span>
  <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">unique-suffixes</span>
         <span class="p">(</span><span class="nv">delete-dups</span> <span class="p">(</span><span class="nv">--map</span> <span class="p">(</span><span class="nv">s-right</span> <span class="mi">1</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">it</span><span class="p">))</span> <span class="nv">gm/math-snippets</span><span class="p">))))</span>
    <span class="p">(</span><span class="nv">seq-do</span> <span class="p">(</span><span class="nb">lambda</span> <span class="p">(</span><span class="nv">key</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">eval</span> <span class="o">`</span><span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span>
                       <span class="o">,</span><span class="nv">key</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-snippet-expand</span> <span class="o">,</span><span class="nv">key</span><span class="p">)))))</span>
            <span class="nv">unique-suffixes</span><span class="p">)))</span></code></pre></div>
<p>We make a function to get the possible completion candidates from the buffer.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/buff-cand</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">i</span> <span class="nv">from</span> <span class="mi">0</span> <span class="nv">to</span> <span class="nv">n</span>
        <span class="nv">collect</span> <span class="p">(</span><span class="nv">gm/last-n-chars</span> <span class="nv">i</span><span class="p">)))</span></code></pre></div>
<p>Then, we set up the creation of an actual snippet (note that its length is
capped at a certain number of characters, defined by <code>gm/longest-snippet</code>). The
longest snippet is currently <code>binom</code>, for the binomial coefficient (choose
function).</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-snippet-expand</span> <span class="p">(</span><span class="nv">key</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">insert</span> <span class="nv">key</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">-when-let*</span> <span class="p">((</span><span class="nv">buff-cand</span> <span class="p">(</span><span class="nv">gm/buff-cand</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">gm/longest-snippet</span><span class="p">)))</span>
               <span class="p">(</span><span class="nv">completions</span> <span class="p">(</span><span class="nv">--keep</span> <span class="p">(</span><span class="nf">assoc</span> <span class="nv">it</span> <span class="nv">gm/math-snippets</span><span class="p">)</span> <span class="nv">buff-cand</span><span class="p">))</span>
               <span class="p">(</span><span class="nv">snippet</span> <span class="p">(</span><span class="nv">--max-by</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">it</span><span class="p">))</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">other</span><span class="p">)))</span>
                                  <span class="nv">completions</span><span class="p">)))</span>
    <span class="c1">;; this has to be negative, we&#39;re deleting back</span>
    <span class="p">(</span><span class="nf">delete-char</span> <span class="p">(</span><span class="nf">-</span> <span class="mi">0</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">snippet</span><span class="p">))))</span>
    <span class="c1">;; this is so we don&#39;t have two backslashes after something like \sim</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)</span> <span class="sc">?\\</span><span class="p">)</span> <span class="p">(</span><span class="nf">delete-char</span> <span class="mi">-1</span><span class="p">))</span>
    <span class="c1">;; is this a snippet expansion or just a text insertion?</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">expand</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">snippet</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">cddr</span> <span class="nv">snippet</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">yas-expand-snippet</span> <span class="p">(</span><span class="nv">yas-lookup-snippet</span> <span class="nv">expand</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">insert</span> <span class="nv">expand</span><span class="p">)))))</span></code></pre></div>
<p>Now we give the user a way to easily add snippets.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/new-math-snippet</span> <span class="p">(</span><span class="nv">key</span> <span class="nv">name</span><span class="p">)</span>
  <span class="s">&#34;Creates a new math snippet. Adds the cons (KEY . NAME) to
</span><span class="s"></span><span class="ss">`gm/math-snippets&#39;</span><span class="s">. If no snippet with the name NAME exists in
</span><span class="s">the yasnippet directory for latex-mode, then the such a file is
</span><span class="s">created. The user can then write the code into which te snippet
</span><span class="s">should expand.&#34;</span>
  <span class="p">(</span><span class="nb">interactive</span> <span class="s">&#34;sSnippet key: \nSnippet name: &#34;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nv">s-blank-str?</span> <span class="nv">key</span><span class="p">)</span>
              <span class="p">(</span><span class="nv">s-blank-str?</span> <span class="nv">name</span><span class="p">))</span>
    <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nf">cons</span> <span class="nv">key</span> <span class="nv">name</span><span class="p">)</span> <span class="nv">gm/math-snippets</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">setq</span> <span class="nv">file-cand</span> <span class="p">(</span><span class="nf">expand-file-name</span>
                     <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s/latex-mode/%s&#34;</span> <span class="p">(</span><span class="nf">car</span> <span class="p">(</span><span class="nv">yas-snippet-dirs</span><span class="p">))</span> <span class="nv">name</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nf">file-exists-p</span> <span class="nv">file-cand</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">find-file</span> <span class="nv">file-cand</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">yas-expand-snippet</span> <span class="p">(</span><span class="nv">yas-lookup-snippet</span> <span class="s">&#34;new-math-snippet&#34;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">gm/math-setup</span><span class="p">)))</span></code></pre></div>
<p>A very rudimentary command to see all current snippet keys and expansions.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/view-snippets</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">with-output-to-temp-buffer</span> <span class="s">&#34;*QuickMath Expansions*&#34;</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">key-len</span> <span class="p">(</span><span class="nf">+</span> <span class="mi">4</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">gm/longest-snippet</span><span class="p">)))</span>
          <span class="p">(</span><span class="nv">snip-len</span> <span class="p">(</span><span class="nv">cadr</span> <span class="nv">gm/longest-snippet</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">princ</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;Key%s  Snippet%s\n%s%s\n&#34;</span>
                     <span class="p">(</span><span class="nf">make-string</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">key-len</span> <span class="mi">4</span><span class="p">)</span> <span class="sc">? </span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">make-string</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">snip-len</span> <span class="mi">8</span><span class="p">)</span> <span class="sc">? </span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">make-string</span> <span class="nv">key-len</span> <span class="sc">?-</span><span class="p">)</span>
                     <span class="p">(</span><span class="nf">make-string</span> <span class="p">(</span><span class="nf">1+</span> <span class="nv">snip-len</span><span class="p">)</span> <span class="sc">?-</span><span class="p">)))</span>
      <span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">snippet</span> <span class="nv">gm/math-snippets</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">princ</span> <span class="p">(</span><span class="nf">format</span> <span class="s">&#34;%s %s\n&#34;</span>
                       <span class="p">(</span><span class="nf">concat</span>
                        <span class="p">(</span><span class="nf">car</span> <span class="nv">snippet</span><span class="p">)</span>
                        <span class="p">(</span><span class="nf">make-string</span> <span class="p">(</span><span class="nf">-</span> <span class="nv">key-len</span> <span class="p">(</span><span class="nf">length</span> <span class="p">(</span><span class="nf">car</span> <span class="nv">snippet</span><span class="p">)))</span> <span class="sc">? </span><span class="p">))</span>
                       <span class="p">(</span><span class="nv">cadr</span> <span class="nv">snippet</span><span class="p">)))))))</span></code></pre></div></li>

<li><p>Tab Jump to Next LaTeX Position</p>

<p>Modified from the <code>cdlatex-tab</code> function in <code>cdlatex.el</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">math-tab</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">gm/in-math-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">catch</span> <span class="ss">&#39;stop</span>
        <span class="p">(</span><span class="nb">cond</span>
         <span class="p">((</span><span class="nf">looking-at</span> <span class="s">&#34;}\\|\\]\\|)&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;\\\\&#34;</span><span class="p">)</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;[^_\\^({\\[]&#34;</span><span class="p">))</span>
              <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">)))</span>
         <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?$</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?$</span><span class="p">)</span> <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">))</span>
          <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">))</span>
         <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?\ </span><span class="p">)</span>
          <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&#34;[^ ]&#34;</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">/=</span> <span class="p">(</span><span class="nf">preceding-char</span><span class="p">)</span> <span class="sc">?\n</span><span class="p">)</span> <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">-1</span><span class="p">)))</span>
         <span class="p">(</span><span class="no">t</span>
          <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">(</span><span class="nb">while</span> <span class="p">(</span><span class="nf">re-search-forward</span> <span class="s">&#34;[ )}\n]\\|\\]&#34;</span> <span class="p">(</span><span class="nf">point-max</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
          <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">-1</span><span class="p">)</span>
          <span class="p">(</span><span class="nb">cond</span>
           <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?\ </span><span class="p">)</span>
            <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">))</span> <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">))</span>
           <span class="p">((</span><span class="nf">=</span> <span class="p">(</span><span class="nf">following-char</span><span class="p">)</span> <span class="sc">?\n</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nf">bolp</span><span class="p">)</span> <span class="p">(</span><span class="nv">not</span> <span class="p">(</span><span class="nf">eobp</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="s">&#34;\\\\&#34;</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
                                 <span class="p">(</span><span class="nf">-</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">point</span><span class="p">)))</span>
                  <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">))))</span>
           <span class="p">(</span><span class="no">t</span>
            <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">char-syntax</span> <span class="p">(</span><span class="nf">preceding-char</span><span class="p">))</span> <span class="sc">?\(</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">char-syntax</span> <span class="p">(</span><span class="nf">preceding-char</span><span class="p">))</span> <span class="sc">?\)</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">=</span> <span class="p">(</span><span class="nf">preceding-char</span><span class="p">)</span> <span class="sc">?-</span><span class="p">))</span>
                <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">forward-char</span> <span class="mi">1</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="s">&#34;[^_\\^({\\[]&#34;</span><span class="p">)</span>
                  <span class="p">(</span><span class="nb">throw</span> <span class="ss">&#39;stop</span> <span class="no">t</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="nv">org-cycle</span><span class="p">)))</span></code></pre></div>
<p>Bind to tab.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nv">bind-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;&lt;tab&gt;&#34;</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">math-tab</span> <span class="nv">org-mode-map</span><span class="p">)</span>
<span class="p">(</span><span class="nv">bind-key</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;TAB&#34;</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">math-tab</span> <span class="nv">org-mode-map</span><span class="p">)</span></code></pre></div></li>

<li><p>Subscripts/Indices</p>

<p>This function eases the entry of subscripts such as \(x_0\) or \(a_{18}\). When a
digit is pressed, if the last character is a letter, then a subscript is
created. If this subscript is extended to a number with more than 1 digit,
brackets are added to ensure proper LaTeX rendering. I also rarely enter a
numbered subscript of more than two digits, so I also exit the brackets after
creating them.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-number-subscript</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cond</span> <span class="p">((</span><span class="nf">string-match</span> <span class="s">&#34;[a-zA-Z]&#34;</span> <span class="p">(</span><span class="nv">gm/last-n-chars</span> <span class="mi">1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&#34;_&#34;</span> <span class="nv">n</span><span class="p">)))</span>
        <span class="p">((</span><span class="nf">string-match</span> <span class="s">&#34;\_[0-9]&#34;</span> <span class="p">(</span><span class="nv">gm/last-n-chars</span> <span class="mi">2</span><span class="p">))</span>
         <span class="p">(</span><span class="nb">save-excursion</span>
           <span class="p">(</span><span class="nf">backward-char</span><span class="p">)</span>
           <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34;\{&#34;</span><span class="p">))</span>
           <span class="p">(</span><span class="nf">insert</span> <span class="p">(</span><span class="nf">concat</span> <span class="nv">n</span> <span class="s">&#34;\}&#34;</span><span class="p">))</span>
        <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nf">insert</span> <span class="nv">n</span><span class="p">)))))</span></code></pre></div>
<p>Add subscript bindings to each of the ten digits.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;0&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;0&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;1&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;1&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;2&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;2&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;3&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;3&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;4&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;4&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;5&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;5&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;6&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;6&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;7&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;7&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;8&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;8&#34;</span><span class="p">)))</span>
<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;9&#34;</span> <span class="p">(</span><span class="nv">lambda!</span> <span class="p">()</span> <span class="p">(</span><span class="nv">gm/math-number-subscript</span> <span class="s">&#34;9&#34;</span><span class="p">)))</span></code></pre></div></li>

<li><p>Fraction</p>

<p>Typing <code>/</code> after an appropriate block (a number or a balanced set of parentheses)
creates a fraction with this block in the numerator and the point in the
denominator. The outside parentheses will be removed; for example, <code>(\sin x)</code> and
then <code>/</code> will result in <code>\frac{\sin x}{|}</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-insert-frac-match</span> <span class="p">(</span><span class="nv">match</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="nv">match</span>
    <span class="p">(</span><span class="nv">yas-expand-snippet</span> <span class="p">(</span><span class="nv">yas-lookup-snippet</span> <span class="s">&#34;frac&#34;</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">insert</span> <span class="nv">match</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">yas-next-field</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-frac-helper</span> <span class="p">(</span><span class="nv">regexp</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">looking-back</span> <span class="nv">regexp</span> <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">let*</span> <span class="p">((</span><span class="nv">begin</span> <span class="p">(</span><span class="nf">match-beginning</span> <span class="mi">0</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">end</span> <span class="p">(</span><span class="nf">match-end</span> <span class="mi">0</span><span class="p">))</span>
           <span class="p">(</span><span class="nv">match</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">)))</span>
      <span class="p">(</span><span class="nf">delete-region</span> <span class="nv">begin</span> <span class="nv">end</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">gm/math-insert-frac-match</span> <span class="nv">match</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-frac</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">cond</span>
   <span class="p">((</span><span class="nf">string-match</span> <span class="s">&#34;[\])]&#34;</span> <span class="p">(</span><span class="nf">char-to-string</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)))</span>
    <span class="p">(</span><span class="nb">let</span> <span class="p">((</span><span class="nv">end</span> <span class="p">(</span><span class="nf">point</span><span class="p">))</span>
          <span class="nv">match</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">backward-sexp</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">setq</span> <span class="nv">match</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="nv">end</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">delete-region</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="nv">end</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">gm/math-insert-frac-match</span> <span class="p">(</span><span class="nf">substring</span> <span class="nv">match</span> <span class="mi">1</span> <span class="mi">-1</span><span class="p">))))</span>
   <span class="p">((</span><span class="nf">string-match</span> <span class="s">&#34;}&#34;</span> <span class="p">(</span><span class="nf">char-to-string</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">gm/math-frac-helper</span> <span class="s">&#34;[\\][a-z]*[\[{].*[\]}]&#34;</span><span class="p">))</span>
   <span class="p">((</span><span class="nf">string-match</span> <span class="s">&#34;[[:alnum:]!]&#34;</span> <span class="p">(</span><span class="nf">char-to-string</span> <span class="p">(</span><span class="nf">char-before</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">gm/math-frac-helper</span> <span class="s">&#34;[\\]?[[:alnum:]_^!]*&#34;</span><span class="p">))</span>
   <span class="p">(</span><span class="no">t</span> <span class="p">(</span><span class="nv">yas-expand-snippet</span> <span class="p">(</span><span class="nv">yas-lookup-snippet</span> <span class="s">&#34;frac&#34;</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">define-key</span> <span class="nv">gm/math-mode-map</span> <span class="s">&#34;/&#34;</span> <span class="nf">#&#39;</span><span class="nv">gm/math-frac</span><span class="p">)</span></code></pre></div></li>

<li><p>Easy Split Environments</p>

<p>I wanted to make writing environments like <code>split</code> and <code>align</code> easier, so that I
wouldn&rsquo;t have to manually add the newline (<code>\\</code>) at the end of each line required
to make LaTeX happy.</p>
<div class="highlight"><pre class="chroma"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/math-split-p</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nv">gm/in-math-p</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">save-excursion</span>
      <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">eq</span> <span class="nv">major-mode</span> <span class="ss">&#39;org-mode</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">org-backward-paragraph</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">backward-paragraph</span><span class="p">))</span>
      <span class="p">(</span><span class="nf">forward-line</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
              <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span>
             <span class="s">&#34;\\begin{split}&#34;</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">gm/tex-newline</span> <span class="p">()</span>
  <span class="p">(</span><span class="nb">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nf">buffer-substring-no-properties</span>
              <span class="p">(</span><span class="nf">line-beginning-position</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">line-end-position</span><span class="p">))</span>
             <span class="s">&#34;\\begin{split}&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">newline</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">end-of-line</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">if</span> <span class="p">(</span><span class="nf">equal</span> <span class="p">(</span><span class="nv">gm/last-n-chars</span> <span class="mi">2</span><span class="p">)</span> <span class="s">&#34;\\\\&#34;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">forward-line</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">insert</span> <span class="s">&#34; \\\\&#34;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">newline</span><span class="p">))))</span>

<span class="p">(</span><span class="nv">define-conditional-key</span> <span class="nv">gm/math-mode-map</span> <span class="p">(</span><span class="nv">kbd</span> <span class="s">&#34;RET&#34;</span><span class="p">)</span> <span class="nf">#&#39;</span><span class="nv">gm/tex-newline</span> <span class="p">(</span><span class="nv">gm/math-split-p</span><span class="p">))</span></code></pre></div></li>
</ul>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
  $('.title a').html(function(index, value) {
	return value.replace(/(\d+)/g, '<span style="font-size: 1.5em;">$1</span>');
  });
</script>
</article>
</div>
    <script defer="" src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
	</body>
</html>
